/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var dn=Object.create;var me=Object.defineProperty;var un=Object.getOwnPropertyDescriptor;var hn=Object.getOwnPropertyNames;var gn=Object.getPrototypeOf,mn=Object.prototype.hasOwnProperty;var yn=(e,t)=>{for(var n in t)me(e,n,{get:t[n],enumerable:!0})},ut=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of hn(t))!mn.call(e,r)&&r!==n&&me(e,r,{get:()=>t[r],enumerable:!(i=un(t,r))||i.enumerable});return e};var z=(e,t,n)=>(n=e!=null?dn(gn(e)):{},ut(t||!e||!e.__esModule?me(n,"default",{value:e,enumerable:!0}):n,e)),Cn=e=>ut(me({},"__esModule",{value:!0}),e);var zi={};yn(zi,{default:()=>Ke});module.exports=Cn(zi);var cn=require("obsidian");var ht={projectRoot:"",configFilePath:"",contentTypes:[],frontmatterProperties:{},preset:"vanilla",enableWYSIWYG:!1,enabledPlugins:[],disabledPlugins:[],theme:"",basesCMSConfig:{views:[]},astroComposerConfig:{customContentTypes:[],defaultTemplate:"",configFilePath:"",terminalProjectRootPath:""},seoConfig:{titleProperty:"title",descriptionProperty:void 0,scanDirectories:"",useFilenameAsTitle:!1,useFilenameAsSlug:!0},commanderConfig:{pageHeaderCommands:[]},propertyOverFileName:{propertyKey:"title"},imageInserter:{valueFormat:"[[attachments/{image-url}]]",insertFormat:"[[attachments/{image-url}]]"},runWizardOnStartup:!0,wizardCompleted:!1};var ge=require("obsidian");var sn=require("obsidian");var T=class{constructor(t,n,i,r,s,o){this.app=t,this.containerEl=n,this.state=i,this.onNext=r,this.onBack=s,this.onCancel=o}};var ye=class extends T{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Welcome to Vault CMS Setup"}),t.createEl("p",{text:"This wizard will help you configure your Vault CMS setup. We'll guide you through:"});let n=t.createEl("ul");n.createEl("li",{text:"Detecting your Astro project structure"}),n.createEl("li",{text:"Identifying your content types"}),n.createEl("li",{text:"Mapping frontmatter properties"}),n.createEl("li",{text:"Configuring plugins and themes"}),n.createEl("li",{text:"Setting up Bases CMS views"}),n.createEl("li",{text:"Configuring Astro Composer and SEO plugins"}),t.createEl("p",{text:'Click "Next" to begin the setup process.'})}validate(){return!0}getTitle(){return"Welcome"}getDescription(){return"Introduction to Vault CMS setup"}};var H=require("obsidian"),w=z(require("path")),X=z(require("fs"));var E=z(require("path")),Y=z(require("fs")),Ce=class{constructor(t){this.app=t}async detectProject(){let n=this.app.vault.adapter,i=n.basePath||n.path;if(!i)return null;let r=await this.searchUpwardForConfig(i);if(!r)return null;let s=this.detectVaultLocation(i,r.projectRoot);return{projectRoot:r.projectRoot,configFilePath:r.configFilePath,vaultLocation:s}}async searchUpwardForConfig(t){let n=["astro.config.mjs","astro.config.ts","astro.config.js","astro.config.mts","astro.config.cjs"],i="src/config.ts",r=E.resolve(t),s=E.parse(r).root;for(;r!==s;){for(let l of n){let c=E.join(r,l);try{if(Y.existsSync(c)&&Y.statSync(c).isFile())return{projectRoot:r,configFilePath:c}}catch(p){}}let o=E.join(r,i);try{Y.existsSync(o)&&Y.statSync(o).isFile()}catch(l){}let a=E.dirname(r);if(a===r)break;r=a}for(r=E.resolve(t);r!==s;){let o=E.join(r,i);try{if(Y.existsSync(o)&&Y.statSync(o).isFile())return{projectRoot:r,configFilePath:o}}catch(l){}let a=E.dirname(r);if(a===r)break;r=a}return null}detectVaultLocation(t,n){let i=E.normalize(t),r=E.normalize(n);if(!i.startsWith(r))return"root";let o=E.relative(r,i).split(E.sep).filter(c=>c.length>0),a=o.findIndex(c=>c.toLowerCase()==="content");if(a>0){let c=a-1;if(c>=0&&o[c].toLowerCase()==="src")return"content"}let l=o.findIndex(c=>c.toLowerCase()==="src");return l>=0&&l<o.length-1&&o[l+1].toLowerCase()==="content"?"nested-content":"root"}};var ve=class extends T{constructor(n,i,r,s,o,a){super(n,i,r,s,o,a);this.detected=!1;this.projectRootDisplay=null;this.configFileDisplay=null;this.projectDetector=new Ce(n)}async display(){var r,s;let{containerEl:n}=this;n.empty();let i=((r=this.state.projectDetection)==null?void 0:r.projectRoot)&&((s=this.state.projectDetection)==null?void 0:s.configFilePath);if(i)this.detected=!0;else{n.createEl("h2",{text:"Project Detection"}),n.createEl("p",{text:"Detecting your Astro project structure..."});let o=await this.projectDetector.detectProject();if(o){let a=this.toRelativePath(o.projectRoot),l=this.toRelativePath(o.configFilePath);this.state.projectDetection={projectRoot:a,configFilePath:l,vaultLocation:o.vaultLocation},this.detected=!0}else this.detected=!1}if(this.state.projectDetection&&(this.detected||i)){await new Promise(l=>setTimeout(l,500)),n.empty(),n.createEl("h2",{text:"Project Detected"}),n.createEl("p",{text:'Project structure detected successfully. You can modify the paths below if needed, then click "Next" to continue.'});let o=new H.Setting(n).setName("Project Root").setDesc("Select the folder containing your Astro project root");this.projectRootDisplay=o.descEl.createDiv({text:this.state.projectDetection.projectRoot||"No folder selected",cls:"vault-cms-path-display"}),this.projectRootDisplay.style.color="var(--text-normal)",o.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{let c=await this.selectFolder();c&&(this.state.projectDetection.projectRoot=c,this.projectRootDisplay&&(this.projectRootDisplay.textContent=c,this.projectRootDisplay.style.color="var(--text-normal)"),this.detected=!1)}));let a=new H.Setting(n).setName("Config File").setDesc("Select your Astro config file (astro.config.mjs, astro.config.js, src/config.ts, etc.)");this.configFileDisplay=a.descEl.createDiv({text:this.state.projectDetection.configFilePath||"No file selected",cls:"vault-cms-path-display"}),this.configFileDisplay.style.color="var(--text-normal)",a.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{var d;let c=((d=this.state.projectDetection)==null?void 0:d.projectRoot)||this.getVaultPath(),p=await this.selectConfigFile(c);p&&(this.state.projectDetection.configFilePath=p,this.configFileDisplay&&(this.configFileDisplay.textContent=p,this.configFileDisplay.style.color="var(--text-normal)"),this.detected=!1)}))}else{n.empty(),n.createEl("h2",{text:"Project Detection Failed"}),n.createEl("p",{text:"Could not detect Astro project structure. Please select your Astro project root and config file manually."}),this.state.projectDetection||(this.state.projectDetection={projectRoot:"",configFilePath:"",vaultLocation:"root"});let o=new H.Setting(n).setName("Project Root").setDesc("Select the folder containing your Astro project root");this.projectRootDisplay=o.descEl.createDiv({text:this.state.projectDetection.projectRoot||"No folder selected",cls:"vault-cms-path-display"}),this.state.projectDetection.projectRoot?this.projectRootDisplay.style.color="var(--text-normal)":this.projectRootDisplay.style.color="var(--text-muted)",o.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{let c=await this.selectFolder();c&&(this.state.projectDetection.projectRoot=c,this.projectRootDisplay&&(this.projectRootDisplay.textContent=c,this.projectRootDisplay.style.color="var(--text-normal)"))}));let a=new H.Setting(n).setName("Config File").setDesc("Select your Astro config file (astro.config.mjs, astro.config.js, src/config.ts, etc.)");this.configFileDisplay=a.descEl.createDiv({text:this.state.projectDetection.configFilePath||"No file selected",cls:"vault-cms-path-display"}),this.state.projectDetection.configFilePath?this.configFileDisplay.style.color="var(--text-normal)":this.configFileDisplay.style.color="var(--text-muted)",a.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{var d;let c=((d=this.state.projectDetection)==null?void 0:d.projectRoot)||this.getVaultPath(),p=await this.selectConfigFile(c);p&&(this.state.projectDetection.configFilePath=p,this.configFileDisplay&&(this.configFileDisplay.textContent=p,this.configFileDisplay.style.color="var(--text-normal)"))}))}}async selectFolder(){var n,i,r;try{let s=null;try{let c=require("@electron/remote");s=c==null?void 0:c.dialog}catch(c){}if(!s)try{let c=((n=window.require)==null?void 0:n.call(window,"electron"))||require("electron");s=(i=c==null?void 0:c.remote)==null?void 0:i.dialog}catch(c){}if(!s)try{let c=require("electron");s=c==null?void 0:c.dialog}catch(c){}if(!s||typeof s.showOpenDialogSync!="function")throw new Error("Electron dialog API not available");let o=this.getVaultPath(),a=((r=this.state.projectDetection)==null?void 0:r.projectRoot)||o;a&&!w.isAbsolute(a)&&(a=w.resolve(o,a));let l=s.showOpenDialogSync({title:"Select Astro Project Root Folder",defaultPath:a,properties:["openDirectory"]});if(l&&l.length>0){let c=w.normalize(l[0]);return this.toRelativePath(c)}}catch(s){console.error("Error opening folder picker:",s),new H.Notice("Unable to open folder picker. Please ensure you are using Obsidian on desktop.")}return null}async selectConfigFile(n){var i,r,s;try{let o=null;try{let p=require("@electron/remote");o=p==null?void 0:p.dialog}catch(p){}if(!o)try{let p=((i=window.require)==null?void 0:i.call(window,"electron"))||require("electron");o=(r=p==null?void 0:p.remote)==null?void 0:r.dialog}catch(p){}if(!o)try{let p=require("electron");o=p==null?void 0:p.dialog}catch(p){}if(!o||typeof o.showOpenDialogSync!="function")throw new Error("Electron dialog API not available");let a=this.getVaultPath(),l=n||a;if(!n&&((s=this.state.projectDetection)!=null&&s.configFilePath)){let p=this.state.projectDetection.configFilePath;w.isAbsolute(p)?l=w.dirname(p):l=w.dirname(w.resolve(a,p))}else n&&!w.isAbsolute(n)?(l=w.resolve(a,n),w.extname(l)&&(l=w.dirname(l))):n&&w.isAbsolute(n)&&(w.extname(n)?l=w.dirname(n):l=n);let c=o.showOpenDialogSync({title:"Select Astro Config File",defaultPath:l,filters:[{name:"Astro Config Files",extensions:["ts","mjs","js","mts","cjs"]},{name:"All Files",extensions:["*"]}],properties:["openFile"]});if(c&&c.length>0){let p=w.normalize(c[0]);return this.toRelativePath(p)}}catch(o){console.error("Error opening file picker:",o),new H.Notice("Unable to open file picker. Please ensure you are using Obsidian on desktop.")}return null}getVaultPath(){let n=this.app.vault.adapter,i=n.basePath||n.path;return i?w.resolve(i):process.cwd()}toRelativePath(n){let i=this.app.vault.adapter,r=i.basePath||i.path;if(!r)return n;let s=w.normalize(r),o=w.normalize(n);if(o.startsWith(s)){let a=o.slice(s.length);return a.startsWith(w.sep)?a.slice(1):a}try{return w.relative(s,o).split(w.sep).join("/")}catch(a){return n}}validate(){var r,s;if(this.detected)return!0;let n=(r=this.state.projectDetection)==null?void 0:r.projectRoot,i=(s=this.state.projectDetection)==null?void 0:s.configFilePath;if(!n||!i)return!1;try{let o=this.getVaultPath(),a=w.isAbsolute(n)?n:w.join(o,n),l=w.isAbsolute(i)?i:w.join(o,i);return!(!X.existsSync(a)||!X.statSync(a).isDirectory()||!X.existsSync(l)||!X.statSync(l).isFile())}catch(o){return!1}}getTitle(){return"Project Detection"}getDescription(){return"Detect Astro project structure"}};var O=require("obsidian"),te=z(require("path"));var Z=require("obsidian"),_=z(require("path")),xe=z(require("fs")),be=class{constructor(t){this.app=t}async detectContentTypes(t){let n=await this.findContentDirectory(t);if(!n)return this.detectContentTypesFromVaultRoot();let i=[],r=this.getTopLevelFolders(n);for(let s of r){let o=this.detectContentType(s);o&&i.push(o)}return i}async findContentDirectory(t){if(!t||!t.projectRoot)return null;let n=this.app.vault,i=n.adapter,r=i.basePath||i.path;if(!r)return null;let s;_.isAbsolute(t.projectRoot)?s=t.projectRoot:s=_.resolve(r,t.projectRoot);let o=_.join(s,"src","content");if(!xe.existsSync(o)||!xe.statSync(o).isDirectory())return null;let a=n.getRoot();if(!(a instanceof Z.TFolder))return null;let l=_.normalize(r),c=_.normalize(o);if(c.startsWith(l)){let d=_.relative(l,c).split(_.sep).filter(h=>h.length>0);if(d.length===0)return a;let f=a;for(let h of d){if(!f.children)return null;let u=f.children.find(g=>g instanceof Z.TFolder&&g.name===h);if(!(u instanceof Z.TFolder))return null;f=u}return f}return null}detectContentTypesFromVaultRoot(){let n=this.app.vault.getRoot();if(!(n instanceof Z.TFolder))return[];let i=[],r=this.getTopLevelFolders(n);for(let s of r){let o=this.detectContentType(s);o&&i.push(o)}return i}getTopLevelFolders(t){let n=[];if(!t.children)return n;for(let i of t.children)i instanceof Z.TFolder&&!i.name.startsWith(".")&&i.name!=="bases"&&i.name!=="_bases"&&i.name!=="node_modules"&&i.name!==".obsidian"&&n.push(i);return n}detectContentType(t){let n=t.name.toLowerCase(),i;return n==="posts"||n==="post"||n==="blog"?i="Posts":n==="pages"||n==="page"?i="Pages":i=this.capitalizeFirst(t.name),{id:`content-type-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:i,folder:t.name,fileOrganization:"file",enabled:!0,indexFileName:"index"}}capitalizeFirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}};var Je=require("obsidian"),K=z(require("path"));var B=z(require("path")),V=class{constructor(t){this.app=t}getFolderPathFromVaultRoot(t,n){if(!n||!n.projectRoot)return t;let i=this.app.vault.adapter,r=i.basePath||i.path;if(!r)return t;let s=B.isAbsolute(n.projectRoot)?n.projectRoot:B.resolve(r,n.projectRoot),o=B.join(s,"src","content",t),a=B.normalize(r),l=B.normalize(o);return l.startsWith(a)?B.relative(a,l).split(B.sep).join("/"):t}getFolderPathFromProjectRoot(t){return`src/content/${t}`}getAstroComposerFolderPath(t,n){return this.getFolderPathFromVaultRoot(t,n)}getBasesCMSFolderPath(t,n){return this.getFolderPathFromVaultRoot(t,n)}};var ee=class{constructor(t){this.app=t,this.pathResolver=new V(t)}async configureAstroComposer(t,n,i,r,s,o){this.frontmatterProperties=n,this.contentTypes=t;let a={customContentTypes:[],defaultTemplate:"",configFilePath:this.relativePath(r),terminalProjectRootPath:this.relativePath(i)},l=t.find(f=>f.name==="Posts"&&f.enabled),c=t.find(f=>f.name==="Pages"&&f.enabled);if(l){let f=n[l.id];a.postsFolder=this.pathResolver.getAstroComposerFolderPath(l.folder,o),a.postsCreationMode=l.fileOrganization,a.postsIndexFileName=l.indexFileName||"index",a.defaultTemplate=(f==null?void 0:f.template)||this.generateTemplate(f,!0)}if(c){let f=n[c.id];a.enablePages=!0,a.pagesFolder=this.pathResolver.getAstroComposerFolderPath(c.folder,o),a.pagesCreationMode=c.fileOrganization,a.pagesIndexFileName=c.indexFileName||"index",a.pageTemplate=(f==null?void 0:f.template)||this.generateTemplate(f,!1)}let p=s?t.find(f=>f.id===s&&f.enabled):null,d=t.filter(f=>f.enabled&&(!s||f.id!==s));if(p){let f=n[p.id],h=p.linkBasePath;(h===void 0||h==="")&&(h=`/${p.folder}/`);let u=this.pathResolver.getAstroComposerFolderPath(p.folder,o);a.customContentTypes.push({id:p.id,name:p.name,folder:u,template:(f==null?void 0:f.template)||this.generateTemplate(f,p.name==="Posts"||p.name==="Pages"),enabled:!0,linkBasePath:h,creationMode:p.fileOrganization,indexFileName:p.indexFileName||"index"})}for(let f of d){let h=n[f.id],u=f.linkBasePath;(u===void 0||u==="")&&(u=`/${f.folder}/`);let g=this.pathResolver.getAstroComposerFolderPath(f.folder,o);a.customContentTypes.push({id:f.id,name:f.name,folder:g,template:(h==null?void 0:h.template)||this.generateTemplate(h,f.name==="Posts"||f.name==="Pages"),enabled:!0,linkBasePath:u,creationMode:f.fileOrganization,indexFileName:f.indexFileName||"index"})}return a}generateTemplate(t,n){if(t!=null&&t.template)return t.template;if(!t)return`---
title: "{{title}}"
---
`;let i=`---
`;return i+=`${t.titleProperty}: "{{title}}"
`,n&&(i+=`${t.dateProperty}: {{date}}
`),t.descriptionProperty&&(i+=`${t.descriptionProperty}: ""
`),i+=`tags: []
`,i+=`draft: true
`,i+=`---
`,i}getCreationModeFromAttachmentHandling(t){return t==="same-folder"?"folder":"file"}relativePath(t){if(!K.isAbsolute(t))return t;let n=this.app.vault.adapter,i=n.basePath||n.path;if(!i)return t;let r=K.normalize(i),s=K.normalize(t);if(s.startsWith(r)){let o=s.slice(r.length);return o.startsWith(K.sep)?o.slice(1):o}return t}async saveConfig(t){var n,i;try{let r=this.app.plugins,s=(n=r==null?void 0:r.plugins)==null?void 0:n["astro-composer"];if(!s){console.warn("AstroComposerConfig: Astro Composer plugin not found, using fallback file method"),await this.saveConfigFallback(t);return}if(!s.settings){console.warn("AstroComposerConfig: Astro Composer plugin settings not available, using fallback file method"),await this.saveConfigFallback(t);return}let o=s.settings;t.defaultTemplate&&(o.defaultTemplate=t.defaultTemplate),t.pageTemplate&&(o.pageTemplate=t.pageTemplate),t.postsFolder&&(o.postsFolder=t.postsFolder),t.postsCreationMode&&(o.creationMode=t.postsCreationMode),t.postsIndexFileName&&(o.indexFileName=t.postsIndexFileName),t.enablePages!==void 0&&(o.enablePages=t.enablePages),t.pagesFolder&&(o.pagesFolder=t.pagesFolder),t.pagesCreationMode&&(o.pagesCreationMode=t.pagesCreationMode),t.pagesIndexFileName&&(o.pagesIndexFileName=t.pagesIndexFileName),t.configFilePath&&(o.configFilePath=t.configFilePath),t.terminalProjectRootPath&&(o.terminalProjectRootPath=t.terminalProjectRootPath),Array.isArray(o.contentTypes)||(o.contentTypes=[]);for(let a of t.customContentTypes){let l=(i=this.contentTypes)==null?void 0:i.find(f=>f.id===a.id),c=l&&this.frontmatterProperties?this.frontmatterProperties[l.id]:void 0,p=(c==null?void 0:c.hasDraftStatus)===!0&&!(c!=null&&c.draftProperty),d=o.contentTypes.findIndex(f=>f.name===a.name&&f.folder===a.folder);d>=0?o.contentTypes[d]={...o.contentTypes[d],name:a.name,folder:a.folder,linkBasePath:a.linkBasePath,template:a.template,enabled:a.enabled,creationMode:a.creationMode,indexFileName:a.indexFileName,enableUnderscorePrefix:p}:o.contentTypes.push({id:a.id,name:a.name,folder:a.folder,linkBasePath:a.linkBasePath,template:a.template,enabled:a.enabled,creationMode:a.creationMode,indexFileName:a.indexFileName,ignoreSubfolders:!1,enableUnderscorePrefix:p})}o.customContentTypes=this.mergeCustomContentTypes(o.customContentTypes||[],t.customContentTypes||[]),typeof s.saveSettings=="function"?(await s.saveSettings(),console.log("AstroComposerConfig: Successfully saved via plugin.saveSettings()")):(console.warn("AstroComposerConfig: Plugin saveSettings not available, using fallback"),await this.saveConfigFallback(t))}catch(r){console.error("Failed to save Astro Composer config via plugin method:",r),await this.saveConfigFallback(t)}}async saveConfigFallback(t){var o;let n="astro-composer",i=`.obsidian/plugins/${n}/data.json`,r={},s=this.app.vault.getAbstractFileByPath(i);if(s&&s instanceof Je.TFile)try{r=JSON.parse(await this.app.vault.read(s))}catch(a){console.warn("Failed to parse existing Astro Composer data.json, starting fresh:",a),r={}}t.defaultTemplate&&(r.defaultTemplate=t.defaultTemplate),t.pageTemplate&&(r.pageTemplate=t.pageTemplate),t.postsFolder&&(r.postsFolder=t.postsFolder),t.postsCreationMode&&(r.creationMode=t.postsCreationMode),t.postsIndexFileName&&(r.indexFileName=t.postsIndexFileName),t.enablePages!==void 0&&(r.enablePages=t.enablePages),t.pagesFolder&&(r.pagesFolder=t.pagesFolder),t.pagesCreationMode&&(r.pagesCreationMode=t.pagesCreationMode),t.pagesIndexFileName&&(r.pagesIndexFileName=t.pagesIndexFileName),t.configFilePath&&(r.configFilePath=t.configFilePath),t.terminalProjectRootPath&&(r.terminalProjectRootPath=t.terminalProjectRootPath),Array.isArray(r.contentTypes)||(r.contentTypes=[]);for(let a of t.customContentTypes){let l=(o=this.contentTypes)==null?void 0:o.find(f=>f.id===a.id),c=l&&this.frontmatterProperties?this.frontmatterProperties[l.id]:void 0,p=(c==null?void 0:c.hasDraftStatus)===!0&&!(c!=null&&c.draftProperty),d=r.contentTypes.findIndex(f=>f.name===a.name&&f.folder===a.folder);d>=0?r.contentTypes[d]={...r.contentTypes[d],name:a.name,folder:a.folder,linkBasePath:a.linkBasePath,template:a.template,enabled:a.enabled,creationMode:a.creationMode,indexFileName:a.indexFileName,enableUnderscorePrefix:p}:r.contentTypes.push({id:a.id,name:a.name,folder:a.folder,linkBasePath:a.linkBasePath,template:a.template,enabled:a.enabled,creationMode:a.creationMode,indexFileName:a.indexFileName,ignoreSubfolders:!1,enableUnderscorePrefix:p})}if(r.customContentTypes=this.mergeCustomContentTypes(r.customContentTypes||[],t.customContentTypes||[]),s&&s instanceof Je.TFile)await this.app.vault.modify(s,JSON.stringify(r,null,2));else{let a=`.obsidian/plugins/${n}`;this.app.vault.getAbstractFileByPath(a)||await this.app.vault.createFolder(a),await this.app.vault.create(i,JSON.stringify(r,null,2))}}mergeCustomContentTypes(t,n){let i=[...t];for(let r of n){let s=i.findIndex(o=>o.id===r.id);s>=0?i[s]={...i[s],...r}:i.push(r)}return i}};var Qe=class extends O.AbstractInputSuggest{constructor(n,i,r){super(n,i);this.inputEl=i,this.mode=r}getSuggestions(n){let i=[],r=n.toLowerCase();if(this.mode==="subfolder"){"attachments".toLowerCase().includes(r)&&i.push("attachments");let s=this.app.vault.getAllLoadedFiles(),o=new Set;for(let a of s)if(a instanceof O.TFolder){let l=a.name;l.toLowerCase().includes(r)&&l!=="attachments"&&o.add(l)}i.push(...Array.from(o).slice(0,10))}else{let s=this.app.vault.getAllLoadedFiles(),o=new Set;for(let a of s)if(a instanceof O.TFolder){let l=a.path;l.toLowerCase().includes(r)&&o.add(l)}i.push(...Array.from(o).slice(0,10))}return i}renderSuggestion(n,i){i.setText(n)}selectSuggestion(n){this.inputEl.value=n,this.inputEl.trigger("input"),this.close()}},Pe=class extends T{constructor(n,i,r,s,o,a){super(n,i,r,s,o,a);this.detected=!1;this.contentTypeDetector=new be(n),this.astroComposerConfigurator=new ee(n)}async importFromAstroComposer(){var n;try{let i=this.app.plugins;if(console.log("ContentTypeStep: Checking plugins API:",!!i),i){let c=(n=i.plugins)==null?void 0:n["astro-composer"];if(console.log("ContentTypeStep: Astro Composer plugin found:",!!c),c&&(console.log("ContentTypeStep: Plugin settings available:",!!c.settings),console.log("ContentTypeStep: Plugin settings keys:",c.settings?Object.keys(c.settings):"none"),c.settings)){let p=c.settings.contentTypes;if(console.log("ContentTypeStep: contentTypes from plugin:",p?`Array with ${p.length} items`:"not found"),Array.isArray(p)&&p.length>0)return console.log("ContentTypeStep: Importing",p.length,"content types from Astro Composer (via plugin API)"),p.map(f=>({id:f.id||`content-type-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:f.name||this.capitalizeFirst(f.folder),folder:f.folder,fileOrganization:f.creationMode==="folder"?"folder":"file",indexFileName:f.indexFileName||"index",linkBasePath:f.linkBasePath,enabled:f.enabled!==!1}))}}let r=".obsidian/plugins/astro-composer/data.json";console.log("ContentTypeStep: Trying to read file:",r);let s=this.app.vault.getAbstractFileByPath(r);if(console.log("ContentTypeStep: File found:",!!s,s?`Type: ${s.constructor.name}`:"not found"),!s||!(s instanceof O.TFile)){let c=[".obsidian/plugins/astro-composer/data.json","obsidian/plugins/astro-composer/data.json",".obsidian/plugins/astro-composer/data.json"];for(let p of c){let d=this.app.vault.getAbstractFileByPath(p);if(d&&d instanceof O.TFile){console.log("ContentTypeStep: Found file at alternative path:",p);let f=await this.app.vault.read(d),h=JSON.parse(f);if(h.contentTypes&&Array.isArray(h.contentTypes))return console.log("ContentTypeStep: Importing",h.contentTypes.length,"content types from Astro Composer (via file at",p,")"),h.contentTypes.map(g=>({id:g.id||`content-type-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:g.name||this.capitalizeFirst(g.folder),folder:g.folder,fileOrganization:g.creationMode==="folder"?"folder":"file",indexFileName:g.indexFileName||"index",linkBasePath:g.linkBasePath,enabled:g.enabled!==!1}))}}return console.log("ContentTypeStep: No Astro Composer data.json found, will scan folders"),[]}let o=await this.app.vault.read(s),a=JSON.parse(o);return!a.contentTypes||!Array.isArray(a.contentTypes)?(console.log("ContentTypeStep: Astro Composer data.json has no contentTypes array. Data keys:",Object.keys(a)),[]):(console.log("ContentTypeStep: Importing",a.contentTypes.length,"content types from Astro Composer (via file)"),a.contentTypes.map(c=>({id:c.id||`content-type-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:c.name||this.capitalizeFirst(c.folder),folder:c.folder,fileOrganization:c.creationMode==="folder"?"folder":"file",indexFileName:c.indexFileName||"index",linkBasePath:c.linkBasePath,enabled:c.enabled!==!1})))}catch(i){return console.error("ContentTypeStep: Failed to import from Astro Composer:",i),[]}}async display(){let{containerEl:n}=this,i=n.querySelector(".content-type-step-content");if(i?i.empty():(n.empty(),i=n.createDiv({cls:"content-type-step-content"})),i.createEl("h2",{text:"Content Types"}),i.createEl("p",{text:"Detecting content types in your vault..."}),!this.detected){let s=this.state.contentTypes||[],o=new Map(s.map(y=>[y.folder,y])),a=await this.importFromAstroComposer(),l=await this.contentTypeDetector.detectContentTypes(this.state.projectDetection),c=new Set(a.map(y=>y.folder)),p=l.filter(y=>!c.has(y.folder)),d=[...a,...p],f=new Map(d.map(y=>[y.folder,y])),h=[],u=new Set,g=new Set([...s.map(y=>y.folder),...d.map(y=>y.folder)]);for(let y of g){if(u.has(y))continue;let P=o.get(y),b=f.get(y);P?b?h.push({...P,folder:P.folder,name:P.name||b.name}):h.push(P):b&&h.push(b),u.add(y)}h.sort((y,P)=>y.name.localeCompare(P.name)),this.state.contentTypes=h,this.detected=!0}if(i.empty(),i.createEl("h2",{text:"Content Types"}),i.createEl("p",{text:"Select and configure your content types:"}),i.createEl("h3",{text:"Attachment Handling",cls:"vault-cms-section-header"}),i.createEl("p",{text:"How should attachments be stored globally?",cls:"vault-cms-section-desc"}),new O.Setting(i).setName("How are attachments handled?").setDesc("Choose how attachments are stored for all content types").addDropdown(s=>s.addOption("same-folder","Same folder as current file").addOption("specified-folder","In the specified folder").addOption("subfolder","In subfolder under current folder").setValue(this.state.attachmentHandlingMode||"subfolder").onChange(o=>{this.state.attachmentHandlingMode=o,o==="same-folder"&&(this.state.attachmentFolderName=void 0),this.display()})),this.state.attachmentHandlingMode==="specified-folder"||this.state.attachmentHandlingMode==="subfolder"){let s=this.state.attachmentHandlingMode==="specified-folder"?'Enter the exact path to the folder for attachments (e.g., "attachments" or "images/attachments"). Leave blank to use "attachments" as default.':'Enter the name of the subfolder for attachments (e.g., "attachments"). Leave blank to use "attachments" as default.';new O.Setting(i).setName("Attachment Folder").setDesc(s).addText(a=>{a.setPlaceholder("attachments").setValue(this.state.attachmentFolderName||"").onChange(l=>{this.state.attachmentFolderName=l||void 0}),this.state.attachmentHandlingMode!=="same-folder"&&new Qe(this.app,a.inputEl,this.state.attachmentHandlingMode)})}i.createEl("hr",{cls:"vault-cms-divider"}),i.createEl("h3",{text:"Content Types",cls:"vault-cms-section-header"});for(let s of this.state.contentTypes){let o=new O.Setting(i).setName(s.name).setDesc(`Folder: ${s.folder}`).addToggle(l=>l.setValue(s.enabled).onChange(c=>{s.enabled=c}));new O.Setting(i).setName(`${s.name} - File Organization`).setDesc("Choose how content is organized for this content type").addDropdown(l=>l.addOption("file","File-based").addOption("folder","Folder-based").setValue(s.fileOrganization||"file").onChange(c=>{s.fileOrganization=c,this.display()})),s.fileOrganization==="folder"&&new O.Setting(i).setName(`${s.name} - Index File Name`).setDesc("Name of the index file in folder-based organization").addText(l=>l.setValue(s.indexFileName||"index").onChange(c=>{s.indexFileName=c||"index"}));let a=`/${s.folder}/`;new O.Setting(i).setName(`${s.name} - Link Base Path`).setDesc(`URL path for this content type (e.g., "/posts/" or "/" for root). Leave blank to use default: ${a}`).addText(l=>l.setPlaceholder(a).setValue(s.linkBasePath||"").onChange(c=>{s.linkBasePath=c||void 0}))}let r=i.createEl("button",{text:"Add Additional Content Type",cls:"mod-cta"});r.style.marginTop="20px",r.style.marginBottom="30px",r.addEventListener("click",async()=>{let s=await this.selectContentTypeFolder();if(s){let o=te.basename(s),a={id:`content-type-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:this.capitalizeFirst(o),folder:o,fileOrganization:"file",enabled:!1,indexFileName:"index"};this.state.contentTypes.push(a),this.display()}})}async selectContentTypeFolder(){var n,i;try{let r=null;try{let a=require("@electron/remote");r=a==null?void 0:a.dialog}catch(a){}if(!r)try{let a=((n=window.require)==null?void 0:n.call(window,"electron"))||require("electron");r=(i=a==null?void 0:a.remote)==null?void 0:i.dialog}catch(a){}if(!r)try{let a=require("electron");r=a==null?void 0:a.dialog}catch(a){}if(!r||typeof r.showOpenDialogSync!="function")throw new Error("Electron dialog API not available");let s=this.getVaultPath(),o=r.showOpenDialogSync({title:"Select Content Type Folder",defaultPath:s,properties:["openDirectory"]});if(o&&o.length>0)return te.normalize(o[0])}catch(r){console.error("Error opening folder picker:",r),new O.Notice("Unable to open folder picker. Please ensure you are using Obsidian on desktop.")}return null}getVaultPath(){let n=this.app.vault.adapter,i=n.basePath||n.path;return i?te.resolve(i):process.cwd()}capitalizeFirst(n){return n.charAt(0).toUpperCase()+n.slice(1)}validate(){return this.state.contentTypes.some(n=>n.enabled)}getTitle(){return"Content Types"}getDescription(){return"Configure content types"}};var gt=require("obsidian");var we=class extends T{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Default Content Type"}),t.createEl("p",{text:"Select which content type should be used as the default. This will:"});let n=t.createEl("ul");n.createEl("li",{text:"Set as the default Bases CMS view"}),n.createEl("li",{text:`Configure Obsidian's "Default location for new notes" to that folder`});let i=this.state.contentTypes.filter(s=>s.enabled);if(i.length===0){t.createEl("p",{text:"No enabled content types found. Please go back and enable at least one content type."});return}(!this.state.defaultContentTypeId||i.findIndex(s=>s.id===this.state.defaultContentTypeId)===-1)&&(this.state.defaultContentTypeId=i[0].id);let r=this.state.defaultContentTypeId;new gt.Setting(t).setName("Default Content Type").setDesc("Choose the default content type for new notes").addDropdown(s=>{i.forEach(o=>{s.addOption(o.id,o.name)}),s.setValue(r),s.onChange(o=>{this.state.defaultContentTypeId=o})})}validate(){return!!this.state.defaultContentTypeId}getTitle(){return"Default Content Type"}getDescription(){return"Select default content type"}};var N=require("obsidian");var ae=require("obsidian");function Ot(e){return typeof e=="undefined"||e===null}function vn(e){return typeof e=="object"&&e!==null}function bn(e){return Array.isArray(e)?e:Ot(e)?[]:[e]}function xn(e,t){var n,i,r,s;if(t)for(s=Object.keys(t),n=0,i=s.length;n<i;n+=1)r=s[n],e[r]=t[r];return e}function Pn(e,t){var n="",i;for(i=0;i<t;i+=1)n+=e;return n}function wn(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var Fn=Ot,Tn=vn,An=bn,Sn=Pn,En=wn,Dn=xn,D={isNothing:Fn,isObject:Tn,toArray:An,repeat:Sn,isNegativeZero:En,extend:Dn};function It(e,t){var n="",i=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(n+='in "'+e.mark.name+'" '),n+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!t&&e.mark.snippet&&(n+=`

`+e.mark.snippet),i+" "+n):i}function ce(e,t){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=t,this.message=It(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}ce.prototype=Object.create(Error.prototype);ce.prototype.constructor=ce;ce.prototype.toString=function(t){return this.name+": "+It(this,t)};var M=ce;function Xe(e,t,n,i,r){var s="",o="",a=Math.floor(r/2)-1;return i-t>a&&(s=" ... ",t=i-a+s.length),n-i>a&&(o=" ...",n=i+a-o.length),{str:s+e.slice(t,n).replace(/\t/g,"\u2192")+o,pos:i-t+s.length}}function Ze(e,t){return D.repeat(" ",t-e.length)+e}function Nn(e,t){if(t=Object.create(t||null),!e.buffer)return null;t.maxLength||(t.maxLength=79),typeof t.indent!="number"&&(t.indent=1),typeof t.linesBefore!="number"&&(t.linesBefore=3),typeof t.linesAfter!="number"&&(t.linesAfter=2);for(var n=/\r?\n|\r|\0/g,i=[0],r=[],s,o=-1;s=n.exec(e.buffer);)r.push(s.index),i.push(s.index+s[0].length),e.position<=s.index&&o<0&&(o=i.length-2);o<0&&(o=i.length-1);var a="",l,c,p=Math.min(e.line+t.linesAfter,r.length).toString().length,d=t.maxLength-(t.indent+p+3);for(l=1;l<=t.linesBefore&&!(o-l<0);l++)c=Xe(e.buffer,i[o-l],r[o-l],e.position-(i[o]-i[o-l]),d),a=D.repeat(" ",t.indent)+Ze((e.line-l+1).toString(),p)+" | "+c.str+`
`+a;for(c=Xe(e.buffer,i[o],r[o],e.position,d),a+=D.repeat(" ",t.indent)+Ze((e.line+1).toString(),p)+" | "+c.str+`
`,a+=D.repeat("-",t.indent+p+3+c.pos)+`^
`,l=1;l<=t.linesAfter&&!(o+l>=r.length);l++)c=Xe(e.buffer,i[o+l],r[o+l],e.position-(i[o]-i[o+l]),d),a+=D.repeat(" ",t.indent)+Ze((e.line+l+1).toString(),p)+" | "+c.str+`
`;return a.replace(/\n$/,"")}var On=Nn,In=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],kn=["scalar","sequence","mapping"];function jn(e){var t={};return e!==null&&Object.keys(e).forEach(function(n){e[n].forEach(function(i){t[String(i)]=n})}),t}function Mn(e,t){if(t=t||{},Object.keys(t).forEach(function(n){if(In.indexOf(n)===-1)throw new M('Unknown option "'+n+'" is met in definition of "'+e+'" YAML type.')}),this.options=t,this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(n){return n},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.representName=t.representName||null,this.defaultStyle=t.defaultStyle||null,this.multi=t.multi||!1,this.styleAliases=jn(t.styleAliases||null),kn.indexOf(this.kind)===-1)throw new M('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var k=Mn;function mt(e,t){var n=[];return e[t].forEach(function(i){var r=n.length;n.forEach(function(s,o){s.tag===i.tag&&s.kind===i.kind&&s.multi===i.multi&&(r=o)}),n[r]=i}),n}function Ln(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},t,n;function i(r){r.multi?(e.multi[r.kind].push(r),e.multi.fallback.push(r)):e[r.kind][r.tag]=e.fallback[r.tag]=r}for(t=0,n=arguments.length;t<n;t+=1)arguments[t].forEach(i);return e}function tt(e){return this.extend(e)}tt.prototype.extend=function(t){var n=[],i=[];if(t instanceof k)i.push(t);else if(Array.isArray(t))i=i.concat(t);else if(t&&(Array.isArray(t.implicit)||Array.isArray(t.explicit)))t.implicit&&(n=n.concat(t.implicit)),t.explicit&&(i=i.concat(t.explicit));else throw new M("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");n.forEach(function(s){if(!(s instanceof k))throw new M("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(s.loadKind&&s.loadKind!=="scalar")throw new M("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(s.multi)throw new M("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),i.forEach(function(s){if(!(s instanceof k))throw new M("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var r=Object.create(tt.prototype);return r.implicit=(this.implicit||[]).concat(n),r.explicit=(this.explicit||[]).concat(i),r.compiledImplicit=mt(r,"implicit"),r.compiledExplicit=mt(r,"explicit"),r.compiledTypeMap=Ln(r.compiledImplicit,r.compiledExplicit),r};var Rn=tt,_n=new k("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),Bn=new k("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),$n=new k("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),zn=new Rn({explicit:[_n,Bn,$n]});function Wn(e){if(e===null)return!0;var t=e.length;return t===1&&e==="~"||t===4&&(e==="null"||e==="Null"||e==="NULL")}function Yn(){return null}function Hn(e){return e===null}var Vn=new k("tag:yaml.org,2002:null",{kind:"scalar",resolve:Wn,construct:Yn,predicate:Hn,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function Un(e){if(e===null)return!1;var t=e.length;return t===4&&(e==="true"||e==="True"||e==="TRUE")||t===5&&(e==="false"||e==="False"||e==="FALSE")}function Gn(e){return e==="true"||e==="True"||e==="TRUE"}function qn(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var Kn=new k("tag:yaml.org,2002:bool",{kind:"scalar",resolve:Un,construct:Gn,predicate:qn,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function Jn(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function Qn(e){return 48<=e&&e<=55}function Xn(e){return 48<=e&&e<=57}function Zn(e){if(e===null)return!1;var t=e.length,n=0,i=!1,r;if(!t)return!1;if(r=e[n],(r==="-"||r==="+")&&(r=e[++n]),r==="0"){if(n+1===t)return!0;if(r=e[++n],r==="b"){for(n++;n<t;n++)if(r=e[n],r!=="_"){if(r!=="0"&&r!=="1")return!1;i=!0}return i&&r!=="_"}if(r==="x"){for(n++;n<t;n++)if(r=e[n],r!=="_"){if(!Jn(e.charCodeAt(n)))return!1;i=!0}return i&&r!=="_"}if(r==="o"){for(n++;n<t;n++)if(r=e[n],r!=="_"){if(!Qn(e.charCodeAt(n)))return!1;i=!0}return i&&r!=="_"}}if(r==="_")return!1;for(;n<t;n++)if(r=e[n],r!=="_"){if(!Xn(e.charCodeAt(n)))return!1;i=!0}return!(!i||r==="_")}function er(e){var t=e,n=1,i;if(t.indexOf("_")!==-1&&(t=t.replace(/_/g,"")),i=t[0],(i==="-"||i==="+")&&(i==="-"&&(n=-1),t=t.slice(1),i=t[0]),t==="0")return 0;if(i==="0"){if(t[1]==="b")return n*parseInt(t.slice(2),2);if(t[1]==="x")return n*parseInt(t.slice(2),16);if(t[1]==="o")return n*parseInt(t.slice(2),8)}return n*parseInt(t,10)}function tr(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!D.isNegativeZero(e)}var nr=new k("tag:yaml.org,2002:int",{kind:"scalar",resolve:Zn,construct:er,predicate:tr,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),rr=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function ir(e){return!(e===null||!rr.test(e)||e[e.length-1]==="_")}function or(e){var t,n;return t=e.replace(/_/g,"").toLowerCase(),n=t[0]==="-"?-1:1,"+-".indexOf(t[0])>=0&&(t=t.slice(1)),t===".inf"?n===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t===".nan"?NaN:n*parseFloat(t,10)}var ar=/^[-+]?[0-9]+e/;function sr(e,t){var n;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(D.isNegativeZero(e))return"-0.0";return n=e.toString(10),ar.test(n)?n.replace("e",".e"):n}function lr(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||D.isNegativeZero(e))}var cr=new k("tag:yaml.org,2002:float",{kind:"scalar",resolve:ir,construct:or,predicate:lr,represent:sr,defaultStyle:"lowercase"}),pr=zn.extend({implicit:[Vn,Kn,nr,cr]}),fr=pr,kt=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),jt=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function dr(e){return e===null?!1:kt.exec(e)!==null||jt.exec(e)!==null}function ur(e){var t,n,i,r,s,o,a,l=0,c=null,p,d,f;if(t=kt.exec(e),t===null&&(t=jt.exec(e)),t===null)throw new Error("Date resolve error");if(n=+t[1],i=+t[2]-1,r=+t[3],!t[4])return new Date(Date.UTC(n,i,r));if(s=+t[4],o=+t[5],a=+t[6],t[7]){for(l=t[7].slice(0,3);l.length<3;)l+="0";l=+l}return t[9]&&(p=+t[10],d=+(t[11]||0),c=(p*60+d)*6e4,t[9]==="-"&&(c=-c)),f=new Date(Date.UTC(n,i,r,s,o,a,l)),c&&f.setTime(f.getTime()-c),f}function hr(e){return e.toISOString()}var gr=new k("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:dr,construct:ur,instanceOf:Date,represent:hr});function mr(e){return e==="<<"||e===null}var yr=new k("tag:yaml.org,2002:merge",{kind:"scalar",resolve:mr}),at=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function Cr(e){if(e===null)return!1;var t,n,i=0,r=e.length,s=at;for(n=0;n<r;n++)if(t=s.indexOf(e.charAt(n)),!(t>64)){if(t<0)return!1;i+=6}return i%8===0}function vr(e){var t,n,i=e.replace(/[\r\n=]/g,""),r=i.length,s=at,o=0,a=[];for(t=0;t<r;t++)t%4===0&&t&&(a.push(o>>16&255),a.push(o>>8&255),a.push(o&255)),o=o<<6|s.indexOf(i.charAt(t));return n=r%4*6,n===0?(a.push(o>>16&255),a.push(o>>8&255),a.push(o&255)):n===18?(a.push(o>>10&255),a.push(o>>2&255)):n===12&&a.push(o>>4&255),new Uint8Array(a)}function br(e){var t="",n=0,i,r,s=e.length,o=at;for(i=0;i<s;i++)i%3===0&&i&&(t+=o[n>>18&63],t+=o[n>>12&63],t+=o[n>>6&63],t+=o[n&63]),n=(n<<8)+e[i];return r=s%3,r===0?(t+=o[n>>18&63],t+=o[n>>12&63],t+=o[n>>6&63],t+=o[n&63]):r===2?(t+=o[n>>10&63],t+=o[n>>4&63],t+=o[n<<2&63],t+=o[64]):r===1&&(t+=o[n>>2&63],t+=o[n<<4&63],t+=o[64],t+=o[64]),t}function xr(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var Pr=new k("tag:yaml.org,2002:binary",{kind:"scalar",resolve:Cr,construct:vr,predicate:xr,represent:br}),wr=Object.prototype.hasOwnProperty,Fr=Object.prototype.toString;function Tr(e){if(e===null)return!0;var t=[],n,i,r,s,o,a=e;for(n=0,i=a.length;n<i;n+=1){if(r=a[n],o=!1,Fr.call(r)!=="[object Object]")return!1;for(s in r)if(wr.call(r,s))if(!o)o=!0;else return!1;if(!o)return!1;if(t.indexOf(s)===-1)t.push(s);else return!1}return!0}function Ar(e){return e!==null?e:[]}var Sr=new k("tag:yaml.org,2002:omap",{kind:"sequence",resolve:Tr,construct:Ar}),Er=Object.prototype.toString;function Dr(e){if(e===null)return!0;var t,n,i,r,s,o=e;for(s=new Array(o.length),t=0,n=o.length;t<n;t+=1){if(i=o[t],Er.call(i)!=="[object Object]"||(r=Object.keys(i),r.length!==1))return!1;s[t]=[r[0],i[r[0]]]}return!0}function Nr(e){if(e===null)return[];var t,n,i,r,s,o=e;for(s=new Array(o.length),t=0,n=o.length;t<n;t+=1)i=o[t],r=Object.keys(i),s[t]=[r[0],i[r[0]]];return s}var Or=new k("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:Dr,construct:Nr}),Ir=Object.prototype.hasOwnProperty;function kr(e){if(e===null)return!0;var t,n=e;for(t in n)if(Ir.call(n,t)&&n[t]!==null)return!1;return!0}function jr(e){return e!==null?e:{}}var Mr=new k("tag:yaml.org,2002:set",{kind:"mapping",resolve:kr,construct:jr}),Mt=fr.extend({implicit:[gr,yr],explicit:[Pr,Sr,Or,Mr]}),G=Object.prototype.hasOwnProperty,Fe=1,Lt=2,Rt=3,Te=4,et=1,Lr=2,yt=3,Rr=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,_r=/[\x85\u2028\u2029]/,Br=/[,\[\]\{\}]/,_t=/^(?:!|!!|![a-z\-]+!)$/i,Bt=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function Ct(e){return Object.prototype.toString.call(e)}function $(e){return e===10||e===13}function Q(e){return e===9||e===32}function L(e){return e===9||e===32||e===10||e===13}function re(e){return e===44||e===91||e===93||e===123||e===125}function $r(e){var t;return 48<=e&&e<=57?e-48:(t=e|32,97<=t&&t<=102?t-97+10:-1)}function zr(e){return e===120?2:e===117?4:e===85?8:0}function Wr(e){return 48<=e&&e<=57?e-48:-1}function vt(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function Yr(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}function $t(e,t,n){t==="__proto__"?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,writable:!0,value:n}):e[t]=n}var zt=new Array(256),Wt=new Array(256);for(J=0;J<256;J++)zt[J]=vt(J)?1:0,Wt[J]=vt(J);var J;function Hr(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||Mt,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function Yt(e,t){var n={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return n.snippet=On(n),new M(t,n)}function C(e,t){throw Yt(e,t)}function Ae(e,t){e.onWarning&&e.onWarning.call(null,Yt(e,t))}var bt={YAML:function(t,n,i){var r,s,o;t.version!==null&&C(t,"duplication of %YAML directive"),i.length!==1&&C(t,"YAML directive accepts exactly one argument"),r=/^([0-9]+)\.([0-9]+)$/.exec(i[0]),r===null&&C(t,"ill-formed argument of the YAML directive"),s=parseInt(r[1],10),o=parseInt(r[2],10),s!==1&&C(t,"unacceptable YAML version of the document"),t.version=i[0],t.checkLineBreaks=o<2,o!==1&&o!==2&&Ae(t,"unsupported YAML version of the document")},TAG:function(t,n,i){var r,s;i.length!==2&&C(t,"TAG directive accepts exactly two arguments"),r=i[0],s=i[1],_t.test(r)||C(t,"ill-formed tag handle (first argument) of the TAG directive"),G.call(t.tagMap,r)&&C(t,'there is a previously declared suffix for "'+r+'" tag handle'),Bt.test(s)||C(t,"ill-formed tag prefix (second argument) of the TAG directive");try{s=decodeURIComponent(s)}catch(o){C(t,"tag prefix is malformed: "+s)}t.tagMap[r]=s}};function U(e,t,n,i){var r,s,o,a;if(t<n){if(a=e.input.slice(t,n),i)for(r=0,s=a.length;r<s;r+=1)o=a.charCodeAt(r),o===9||32<=o&&o<=1114111||C(e,"expected valid JSON character");else Rr.test(a)&&C(e,"the stream contains non-printable characters");e.result+=a}}function xt(e,t,n,i){var r,s,o,a;for(D.isObject(n)||C(e,"cannot merge mappings; the provided source object is unacceptable"),r=Object.keys(n),o=0,a=r.length;o<a;o+=1)s=r[o],G.call(t,s)||($t(t,s,n[s]),i[s]=!0)}function ie(e,t,n,i,r,s,o,a,l){var c,p;if(Array.isArray(r))for(r=Array.prototype.slice.call(r),c=0,p=r.length;c<p;c+=1)Array.isArray(r[c])&&C(e,"nested arrays are not supported inside keys"),typeof r=="object"&&Ct(r[c])==="[object Object]"&&(r[c]="[object Object]");if(typeof r=="object"&&Ct(r)==="[object Object]"&&(r="[object Object]"),r=String(r),t===null&&(t={}),i==="tag:yaml.org,2002:merge")if(Array.isArray(s))for(c=0,p=s.length;c<p;c+=1)xt(e,t,s[c],n);else xt(e,t,s,n);else!e.json&&!G.call(n,r)&&G.call(t,r)&&(e.line=o||e.line,e.lineStart=a||e.lineStart,e.position=l||e.position,C(e,"duplicated mapping key")),$t(t,r,s),delete n[r];return t}function st(e){var t;t=e.input.charCodeAt(e.position),t===10?e.position++:t===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):C(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function S(e,t,n){for(var i=0,r=e.input.charCodeAt(e.position);r!==0;){for(;Q(r);)r===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),r=e.input.charCodeAt(++e.position);if(t&&r===35)do r=e.input.charCodeAt(++e.position);while(r!==10&&r!==13&&r!==0);if($(r))for(st(e),r=e.input.charCodeAt(e.position),i++,e.lineIndent=0;r===32;)e.lineIndent++,r=e.input.charCodeAt(++e.position);else break}return n!==-1&&i!==0&&e.lineIndent<n&&Ae(e,"deficient indentation"),i}function De(e){var t=e.position,n;return n=e.input.charCodeAt(t),!!((n===45||n===46)&&n===e.input.charCodeAt(t+1)&&n===e.input.charCodeAt(t+2)&&(t+=3,n=e.input.charCodeAt(t),n===0||L(n)))}function lt(e,t){t===1?e.result+=" ":t>1&&(e.result+=D.repeat(`
`,t-1))}function Vr(e,t,n){var i,r,s,o,a,l,c,p,d=e.kind,f=e.result,h;if(h=e.input.charCodeAt(e.position),L(h)||re(h)||h===35||h===38||h===42||h===33||h===124||h===62||h===39||h===34||h===37||h===64||h===96||(h===63||h===45)&&(r=e.input.charCodeAt(e.position+1),L(r)||n&&re(r)))return!1;for(e.kind="scalar",e.result="",s=o=e.position,a=!1;h!==0;){if(h===58){if(r=e.input.charCodeAt(e.position+1),L(r)||n&&re(r))break}else if(h===35){if(i=e.input.charCodeAt(e.position-1),L(i))break}else{if(e.position===e.lineStart&&De(e)||n&&re(h))break;if($(h))if(l=e.line,c=e.lineStart,p=e.lineIndent,S(e,!1,-1),e.lineIndent>=t){a=!0,h=e.input.charCodeAt(e.position);continue}else{e.position=o,e.line=l,e.lineStart=c,e.lineIndent=p;break}}a&&(U(e,s,o,!1),lt(e,e.line-l),s=o=e.position,a=!1),Q(h)||(o=e.position+1),h=e.input.charCodeAt(++e.position)}return U(e,s,o,!1),e.result?!0:(e.kind=d,e.result=f,!1)}function Ur(e,t){var n,i,r;if(n=e.input.charCodeAt(e.position),n!==39)return!1;for(e.kind="scalar",e.result="",e.position++,i=r=e.position;(n=e.input.charCodeAt(e.position))!==0;)if(n===39)if(U(e,i,e.position,!0),n=e.input.charCodeAt(++e.position),n===39)i=e.position,e.position++,r=e.position;else return!0;else $(n)?(U(e,i,r,!0),lt(e,S(e,!1,t)),i=r=e.position):e.position===e.lineStart&&De(e)?C(e,"unexpected end of the document within a single quoted scalar"):(e.position++,r=e.position);C(e,"unexpected end of the stream within a single quoted scalar")}function Gr(e,t){var n,i,r,s,o,a;if(a=e.input.charCodeAt(e.position),a!==34)return!1;for(e.kind="scalar",e.result="",e.position++,n=i=e.position;(a=e.input.charCodeAt(e.position))!==0;){if(a===34)return U(e,n,e.position,!0),e.position++,!0;if(a===92){if(U(e,n,e.position,!0),a=e.input.charCodeAt(++e.position),$(a))S(e,!1,t);else if(a<256&&zt[a])e.result+=Wt[a],e.position++;else if((o=zr(a))>0){for(r=o,s=0;r>0;r--)a=e.input.charCodeAt(++e.position),(o=$r(a))>=0?s=(s<<4)+o:C(e,"expected hexadecimal character");e.result+=Yr(s),e.position++}else C(e,"unknown escape sequence");n=i=e.position}else $(a)?(U(e,n,i,!0),lt(e,S(e,!1,t)),n=i=e.position):e.position===e.lineStart&&De(e)?C(e,"unexpected end of the document within a double quoted scalar"):(e.position++,i=e.position)}C(e,"unexpected end of the stream within a double quoted scalar")}function qr(e,t){var n=!0,i,r,s,o=e.tag,a,l=e.anchor,c,p,d,f,h,u=Object.create(null),g,y,P,b;if(b=e.input.charCodeAt(e.position),b===91)p=93,h=!1,a=[];else if(b===123)p=125,h=!0,a={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=a),b=e.input.charCodeAt(++e.position);b!==0;){if(S(e,!0,t),b=e.input.charCodeAt(e.position),b===p)return e.position++,e.tag=o,e.anchor=l,e.kind=h?"mapping":"sequence",e.result=a,!0;n?b===44&&C(e,"expected the node content, but found ','"):C(e,"missed comma between flow collection entries"),y=g=P=null,d=f=!1,b===63&&(c=e.input.charCodeAt(e.position+1),L(c)&&(d=f=!0,e.position++,S(e,!0,t))),i=e.line,r=e.lineStart,s=e.position,oe(e,t,Fe,!1,!0),y=e.tag,g=e.result,S(e,!0,t),b=e.input.charCodeAt(e.position),(f||e.line===i)&&b===58&&(d=!0,b=e.input.charCodeAt(++e.position),S(e,!0,t),oe(e,t,Fe,!1,!0),P=e.result),h?ie(e,a,u,y,g,P,i,r,s):d?a.push(ie(e,null,u,y,g,P,i,r,s)):a.push(g),S(e,!0,t),b=e.input.charCodeAt(e.position),b===44?(n=!0,b=e.input.charCodeAt(++e.position)):n=!1}C(e,"unexpected end of the stream within a flow collection")}function Kr(e,t){var n,i,r=et,s=!1,o=!1,a=t,l=0,c=!1,p,d;if(d=e.input.charCodeAt(e.position),d===124)i=!1;else if(d===62)i=!0;else return!1;for(e.kind="scalar",e.result="";d!==0;)if(d=e.input.charCodeAt(++e.position),d===43||d===45)et===r?r=d===43?yt:Lr:C(e,"repeat of a chomping mode identifier");else if((p=Wr(d))>=0)p===0?C(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):o?C(e,"repeat of an indentation width identifier"):(a=t+p-1,o=!0);else break;if(Q(d)){do d=e.input.charCodeAt(++e.position);while(Q(d));if(d===35)do d=e.input.charCodeAt(++e.position);while(!$(d)&&d!==0)}for(;d!==0;){for(st(e),e.lineIndent=0,d=e.input.charCodeAt(e.position);(!o||e.lineIndent<a)&&d===32;)e.lineIndent++,d=e.input.charCodeAt(++e.position);if(!o&&e.lineIndent>a&&(a=e.lineIndent),$(d)){l++;continue}if(e.lineIndent<a){r===yt?e.result+=D.repeat(`
`,s?1+l:l):r===et&&s&&(e.result+=`
`);break}for(i?Q(d)?(c=!0,e.result+=D.repeat(`
`,s?1+l:l)):c?(c=!1,e.result+=D.repeat(`
`,l+1)):l===0?s&&(e.result+=" "):e.result+=D.repeat(`
`,l):e.result+=D.repeat(`
`,s?1+l:l),s=!0,o=!0,l=0,n=e.position;!$(d)&&d!==0;)d=e.input.charCodeAt(++e.position);U(e,n,e.position,!1)}return!0}function Pt(e,t){var n,i=e.tag,r=e.anchor,s=[],o,a=!1,l;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=s),l=e.input.charCodeAt(e.position);l!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,C(e,"tab characters must not be used in indentation")),!(l!==45||(o=e.input.charCodeAt(e.position+1),!L(o))));){if(a=!0,e.position++,S(e,!0,-1)&&e.lineIndent<=t){s.push(null),l=e.input.charCodeAt(e.position);continue}if(n=e.line,oe(e,t,Rt,!1,!0),s.push(e.result),S(e,!0,-1),l=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>t)&&l!==0)C(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break}return a?(e.tag=i,e.anchor=r,e.kind="sequence",e.result=s,!0):!1}function Jr(e,t,n){var i,r,s,o,a,l,c=e.tag,p=e.anchor,d={},f=Object.create(null),h=null,u=null,g=null,y=!1,P=!1,b;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=d),b=e.input.charCodeAt(e.position);b!==0;){if(!y&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,C(e,"tab characters must not be used in indentation")),i=e.input.charCodeAt(e.position+1),s=e.line,(b===63||b===58)&&L(i))b===63?(y&&(ie(e,d,f,h,u,null,o,a,l),h=u=g=null),P=!0,y=!0,r=!0):y?(y=!1,r=!0):C(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,b=i;else{if(o=e.line,a=e.lineStart,l=e.position,!oe(e,n,Lt,!1,!0))break;if(e.line===s){for(b=e.input.charCodeAt(e.position);Q(b);)b=e.input.charCodeAt(++e.position);if(b===58)b=e.input.charCodeAt(++e.position),L(b)||C(e,"a whitespace character is expected after the key-value separator within a block mapping"),y&&(ie(e,d,f,h,u,null,o,a,l),h=u=g=null),P=!0,y=!1,r=!1,h=e.tag,u=e.result;else if(P)C(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=c,e.anchor=p,!0}else if(P)C(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=c,e.anchor=p,!0}if((e.line===s||e.lineIndent>t)&&(y&&(o=e.line,a=e.lineStart,l=e.position),oe(e,t,Te,!0,r)&&(y?u=e.result:g=e.result),y||(ie(e,d,f,h,u,g,o,a,l),h=u=g=null),S(e,!0,-1),b=e.input.charCodeAt(e.position)),(e.line===s||e.lineIndent>t)&&b!==0)C(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return y&&ie(e,d,f,h,u,null,o,a,l),P&&(e.tag=c,e.anchor=p,e.kind="mapping",e.result=d),P}function Qr(e){var t,n=!1,i=!1,r,s,o;if(o=e.input.charCodeAt(e.position),o!==33)return!1;if(e.tag!==null&&C(e,"duplication of a tag property"),o=e.input.charCodeAt(++e.position),o===60?(n=!0,o=e.input.charCodeAt(++e.position)):o===33?(i=!0,r="!!",o=e.input.charCodeAt(++e.position)):r="!",t=e.position,n){do o=e.input.charCodeAt(++e.position);while(o!==0&&o!==62);e.position<e.length?(s=e.input.slice(t,e.position),o=e.input.charCodeAt(++e.position)):C(e,"unexpected end of the stream within a verbatim tag")}else{for(;o!==0&&!L(o);)o===33&&(i?C(e,"tag suffix cannot contain exclamation marks"):(r=e.input.slice(t-1,e.position+1),_t.test(r)||C(e,"named tag handle cannot contain such characters"),i=!0,t=e.position+1)),o=e.input.charCodeAt(++e.position);s=e.input.slice(t,e.position),Br.test(s)&&C(e,"tag suffix cannot contain flow indicator characters")}s&&!Bt.test(s)&&C(e,"tag name cannot contain such characters: "+s);try{s=decodeURIComponent(s)}catch(a){C(e,"tag name is malformed: "+s)}return n?e.tag=s:G.call(e.tagMap,r)?e.tag=e.tagMap[r]+s:r==="!"?e.tag="!"+s:r==="!!"?e.tag="tag:yaml.org,2002:"+s:C(e,'undeclared tag handle "'+r+'"'),!0}function Xr(e){var t,n;if(n=e.input.charCodeAt(e.position),n!==38)return!1;for(e.anchor!==null&&C(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),t=e.position;n!==0&&!L(n)&&!re(n);)n=e.input.charCodeAt(++e.position);return e.position===t&&C(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function Zr(e){var t,n,i;if(i=e.input.charCodeAt(e.position),i!==42)return!1;for(i=e.input.charCodeAt(++e.position),t=e.position;i!==0&&!L(i)&&!re(i);)i=e.input.charCodeAt(++e.position);return e.position===t&&C(e,"name of an alias node must contain at least one character"),n=e.input.slice(t,e.position),G.call(e.anchorMap,n)||C(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],S(e,!0,-1),!0}function oe(e,t,n,i,r){var s,o,a,l=1,c=!1,p=!1,d,f,h,u,g,y;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,s=o=a=Te===n||Rt===n,i&&S(e,!0,-1)&&(c=!0,e.lineIndent>t?l=1:e.lineIndent===t?l=0:e.lineIndent<t&&(l=-1)),l===1)for(;Qr(e)||Xr(e);)S(e,!0,-1)?(c=!0,a=s,e.lineIndent>t?l=1:e.lineIndent===t?l=0:e.lineIndent<t&&(l=-1)):a=!1;if(a&&(a=c||r),(l===1||Te===n)&&(Fe===n||Lt===n?g=t:g=t+1,y=e.position-e.lineStart,l===1?a&&(Pt(e,y)||Jr(e,y,g))||qr(e,g)?p=!0:(o&&Kr(e,g)||Ur(e,g)||Gr(e,g)?p=!0:Zr(e)?(p=!0,(e.tag!==null||e.anchor!==null)&&C(e,"alias node should not have any properties")):Vr(e,g,Fe===n)&&(p=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):l===0&&(p=a&&Pt(e,y))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&C(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),d=0,f=e.implicitTypes.length;d<f;d+=1)if(u=e.implicitTypes[d],u.resolve(e.result)){e.result=u.construct(e.result),e.tag=u.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(G.call(e.typeMap[e.kind||"fallback"],e.tag))u=e.typeMap[e.kind||"fallback"][e.tag];else for(u=null,h=e.typeMap.multi[e.kind||"fallback"],d=0,f=h.length;d<f;d+=1)if(e.tag.slice(0,h[d].tag.length)===h[d].tag){u=h[d];break}u||C(e,"unknown tag !<"+e.tag+">"),e.result!==null&&u.kind!==e.kind&&C(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+u.kind+'", not "'+e.kind+'"'),u.resolve(e.result,e.tag)?(e.result=u.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):C(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||p}function ei(e){var t=e.position,n,i,r,s=!1,o;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(o=e.input.charCodeAt(e.position))!==0&&(S(e,!0,-1),o=e.input.charCodeAt(e.position),!(e.lineIndent>0||o!==37));){for(s=!0,o=e.input.charCodeAt(++e.position),n=e.position;o!==0&&!L(o);)o=e.input.charCodeAt(++e.position);for(i=e.input.slice(n,e.position),r=[],i.length<1&&C(e,"directive name must not be less than one character in length");o!==0;){for(;Q(o);)o=e.input.charCodeAt(++e.position);if(o===35){do o=e.input.charCodeAt(++e.position);while(o!==0&&!$(o));break}if($(o))break;for(n=e.position;o!==0&&!L(o);)o=e.input.charCodeAt(++e.position);r.push(e.input.slice(n,e.position))}o!==0&&st(e),G.call(bt,i)?bt[i](e,i,r):Ae(e,'unknown document directive "'+i+'"')}if(S(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,S(e,!0,-1)):s&&C(e,"directives end mark is expected"),oe(e,e.lineIndent-1,Te,!1,!0),S(e,!0,-1),e.checkLineBreaks&&_r.test(e.input.slice(t,e.position))&&Ae(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&De(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,S(e,!0,-1));return}if(e.position<e.length-1)C(e,"end of the stream or a document separator is expected");else return}function Ht(e,t){e=String(e),t=t||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var n=new Hr(e,t),i=e.indexOf("\0");for(i!==-1&&(n.position=i,C(n,"null byte is not allowed in input")),n.input+="\0";n.input.charCodeAt(n.position)===32;)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)ei(n);return n.documents}function ti(e,t,n){t!==null&&typeof t=="object"&&typeof n=="undefined"&&(n=t,t=null);var i=Ht(e,n);if(typeof t!="function")return i;for(var r=0,s=i.length;r<s;r+=1)t(i[r])}function ni(e,t){var n=Ht(e,t);if(n.length!==0){if(n.length===1)return n[0];throw new M("expected a single document in the stream, but found more")}}var ri=ti,ii=ni,Vt={loadAll:ri,load:ii},Ut=Object.prototype.toString,Gt=Object.prototype.hasOwnProperty,ct=65279,oi=9,pe=10,ai=13,si=32,li=33,ci=34,nt=35,pi=37,fi=38,di=39,ui=42,qt=44,hi=45,Se=58,gi=61,mi=62,yi=63,Ci=64,Kt=91,Jt=93,vi=96,Qt=123,bi=124,Xt=125,j={};j[0]="\\0";j[7]="\\a";j[8]="\\b";j[9]="\\t";j[10]="\\n";j[11]="\\v";j[12]="\\f";j[13]="\\r";j[27]="\\e";j[34]='\\"';j[92]="\\\\";j[133]="\\N";j[160]="\\_";j[8232]="\\L";j[8233]="\\P";var xi=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],Pi=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function wi(e,t){var n,i,r,s,o,a,l;if(t===null)return{};for(n={},i=Object.keys(t),r=0,s=i.length;r<s;r+=1)o=i[r],a=String(t[o]),o.slice(0,2)==="!!"&&(o="tag:yaml.org,2002:"+o.slice(2)),l=e.compiledTypeMap.fallback[o],l&&Gt.call(l.styleAliases,a)&&(a=l.styleAliases[a]),n[o]=a;return n}function Fi(e){var t,n,i;if(t=e.toString(16).toUpperCase(),e<=255)n="x",i=2;else if(e<=65535)n="u",i=4;else if(e<=4294967295)n="U",i=8;else throw new M("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+n+D.repeat("0",i-t.length)+t}var Ti=1,fe=2;function Ai(e){this.schema=e.schema||Mt,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=D.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=wi(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?fe:Ti,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function wt(e,t){for(var n=D.repeat(" ",t),i=0,r=-1,s="",o,a=e.length;i<a;)r=e.indexOf(`
`,i),r===-1?(o=e.slice(i),i=a):(o=e.slice(i,r+1),i=r+1),o.length&&o!==`
`&&(s+=n),s+=o;return s}function rt(e,t){return`
`+D.repeat(" ",e.indent*t)}function Si(e,t){var n,i,r;for(n=0,i=e.implicitTypes.length;n<i;n+=1)if(r=e.implicitTypes[n],r.resolve(t))return!0;return!1}function Ee(e){return e===si||e===oi}function de(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==ct||65536<=e&&e<=1114111}function Ft(e){return de(e)&&e!==ct&&e!==ai&&e!==pe}function Tt(e,t,n){var i=Ft(e),r=i&&!Ee(e);return(n?i:i&&e!==qt&&e!==Kt&&e!==Jt&&e!==Qt&&e!==Xt)&&e!==nt&&!(t===Se&&!r)||Ft(t)&&!Ee(t)&&e===nt||t===Se&&r}function Ei(e){return de(e)&&e!==ct&&!Ee(e)&&e!==hi&&e!==yi&&e!==Se&&e!==qt&&e!==Kt&&e!==Jt&&e!==Qt&&e!==Xt&&e!==nt&&e!==fi&&e!==ui&&e!==li&&e!==bi&&e!==gi&&e!==mi&&e!==di&&e!==ci&&e!==pi&&e!==Ci&&e!==vi}function Di(e){return!Ee(e)&&e!==Se}function le(e,t){var n=e.charCodeAt(t),i;return n>=55296&&n<=56319&&t+1<e.length&&(i=e.charCodeAt(t+1),i>=56320&&i<=57343)?(n-55296)*1024+i-56320+65536:n}function Zt(e){var t=/^\n* /;return t.test(e)}var en=1,it=2,tn=3,nn=4,ne=5;function Ni(e,t,n,i,r,s,o,a){var l,c=0,p=null,d=!1,f=!1,h=i!==-1,u=-1,g=Ei(le(e,0))&&Di(le(e,e.length-1));if(t||o)for(l=0;l<e.length;c>=65536?l+=2:l++){if(c=le(e,l),!de(c))return ne;g=g&&Tt(c,p,a),p=c}else{for(l=0;l<e.length;c>=65536?l+=2:l++){if(c=le(e,l),c===pe)d=!0,h&&(f=f||l-u-1>i&&e[u+1]!==" ",u=l);else if(!de(c))return ne;g=g&&Tt(c,p,a),p=c}f=f||h&&l-u-1>i&&e[u+1]!==" "}return!d&&!f?g&&!o&&!r(e)?en:s===fe?ne:it:n>9&&Zt(e)?ne:o?s===fe?ne:it:f?nn:tn}function Oi(e,t,n,i,r){e.dump=function(){if(t.length===0)return e.quotingType===fe?'""':"''";if(!e.noCompatMode&&(xi.indexOf(t)!==-1||Pi.test(t)))return e.quotingType===fe?'"'+t+'"':"'"+t+"'";var s=e.indent*Math.max(1,n),o=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-s),a=i||e.flowLevel>-1&&n>=e.flowLevel;function l(c){return Si(e,c)}switch(Ni(t,a,e.indent,o,l,e.quotingType,e.forceQuotes&&!i,r)){case en:return t;case it:return"'"+t.replace(/'/g,"''")+"'";case tn:return"|"+At(t,e.indent)+St(wt(t,s));case nn:return">"+At(t,e.indent)+St(wt(Ii(t,o),s));case ne:return'"'+ki(t)+'"';default:throw new M("impossible error: invalid scalar style")}}()}function At(e,t){var n=Zt(e)?String(t):"",i=e[e.length-1]===`
`,r=i&&(e[e.length-2]===`
`||e===`
`),s=r?"+":i?"":"-";return n+s+`
`}function St(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function Ii(e,t){for(var n=/(\n+)([^\n]*)/g,i=function(){var c=e.indexOf(`
`);return c=c!==-1?c:e.length,n.lastIndex=c,Et(e.slice(0,c),t)}(),r=e[0]===`
`||e[0]===" ",s,o;o=n.exec(e);){var a=o[1],l=o[2];s=l[0]===" ",i+=a+(!r&&!s&&l!==""?`
`:"")+Et(l,t),r=s}return i}function Et(e,t){if(e===""||e[0]===" ")return e;for(var n=/ [^ ]/g,i,r=0,s,o=0,a=0,l="";i=n.exec(e);)a=i.index,a-r>t&&(s=o>r?o:a,l+=`
`+e.slice(r,s),r=s+1),o=a;return l+=`
`,e.length-r>t&&o>r?l+=e.slice(r,o)+`
`+e.slice(o+1):l+=e.slice(r),l.slice(1)}function ki(e){for(var t="",n=0,i,r=0;r<e.length;n>=65536?r+=2:r++)n=le(e,r),i=j[n],!i&&de(n)?(t+=e[r],n>=65536&&(t+=e[r+1])):t+=i||Fi(n);return t}function ji(e,t,n){var i="",r=e.tag,s,o,a;for(s=0,o=n.length;s<o;s+=1)a=n[s],e.replacer&&(a=e.replacer.call(n,String(s),a)),(W(e,t,a,!1,!1)||typeof a=="undefined"&&W(e,t,null,!1,!1))&&(i!==""&&(i+=","+(e.condenseFlow?"":" ")),i+=e.dump);e.tag=r,e.dump="["+i+"]"}function Dt(e,t,n,i){var r="",s=e.tag,o,a,l;for(o=0,a=n.length;o<a;o+=1)l=n[o],e.replacer&&(l=e.replacer.call(n,String(o),l)),(W(e,t+1,l,!0,!0,!1,!0)||typeof l=="undefined"&&W(e,t+1,null,!0,!0,!1,!0))&&((!i||r!=="")&&(r+=rt(e,t)),e.dump&&pe===e.dump.charCodeAt(0)?r+="-":r+="- ",r+=e.dump);e.tag=s,e.dump=r||"[]"}function Mi(e,t,n){var i="",r=e.tag,s=Object.keys(n),o,a,l,c,p;for(o=0,a=s.length;o<a;o+=1)p="",i!==""&&(p+=", "),e.condenseFlow&&(p+='"'),l=s[o],c=n[l],e.replacer&&(c=e.replacer.call(n,l,c)),W(e,t,l,!1,!1)&&(e.dump.length>1024&&(p+="? "),p+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),W(e,t,c,!1,!1)&&(p+=e.dump,i+=p));e.tag=r,e.dump="{"+i+"}"}function Li(e,t,n,i){var r="",s=e.tag,o=Object.keys(n),a,l,c,p,d,f;if(e.sortKeys===!0)o.sort();else if(typeof e.sortKeys=="function")o.sort(e.sortKeys);else if(e.sortKeys)throw new M("sortKeys must be a boolean or a function");for(a=0,l=o.length;a<l;a+=1)f="",(!i||r!=="")&&(f+=rt(e,t)),c=o[a],p=n[c],e.replacer&&(p=e.replacer.call(n,c,p)),W(e,t+1,c,!0,!0,!0)&&(d=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,d&&(e.dump&&pe===e.dump.charCodeAt(0)?f+="?":f+="? "),f+=e.dump,d&&(f+=rt(e,t)),W(e,t+1,p,!0,d)&&(e.dump&&pe===e.dump.charCodeAt(0)?f+=":":f+=": ",f+=e.dump,r+=f));e.tag=s,e.dump=r||"{}"}function Nt(e,t,n){var i,r,s,o,a,l;for(r=n?e.explicitTypes:e.implicitTypes,s=0,o=r.length;s<o;s+=1)if(a=r[s],(a.instanceOf||a.predicate)&&(!a.instanceOf||typeof t=="object"&&t instanceof a.instanceOf)&&(!a.predicate||a.predicate(t))){if(n?a.multi&&a.representName?e.tag=a.representName(t):e.tag=a.tag:e.tag="?",a.represent){if(l=e.styleMap[a.tag]||a.defaultStyle,Ut.call(a.represent)==="[object Function]")i=a.represent(t,l);else if(Gt.call(a.represent,l))i=a.represent[l](t,l);else throw new M("!<"+a.tag+'> tag resolver accepts not "'+l+'" style');e.dump=i}return!0}return!1}function W(e,t,n,i,r,s,o){e.tag=null,e.dump=n,Nt(e,n,!1)||Nt(e,n,!0);var a=Ut.call(e.dump),l=i,c;i&&(i=e.flowLevel<0||e.flowLevel>t);var p=a==="[object Object]"||a==="[object Array]",d,f;if(p&&(d=e.duplicates.indexOf(n),f=d!==-1),(e.tag!==null&&e.tag!=="?"||f||e.indent!==2&&t>0)&&(r=!1),f&&e.usedDuplicates[d])e.dump="*ref_"+d;else{if(p&&f&&!e.usedDuplicates[d]&&(e.usedDuplicates[d]=!0),a==="[object Object]")i&&Object.keys(e.dump).length!==0?(Li(e,t,e.dump,r),f&&(e.dump="&ref_"+d+e.dump)):(Mi(e,t,e.dump),f&&(e.dump="&ref_"+d+" "+e.dump));else if(a==="[object Array]")i&&e.dump.length!==0?(e.noArrayIndent&&!o&&t>0?Dt(e,t-1,e.dump,r):Dt(e,t,e.dump,r),f&&(e.dump="&ref_"+d+e.dump)):(ji(e,t,e.dump),f&&(e.dump="&ref_"+d+" "+e.dump));else if(a==="[object String]")e.tag!=="?"&&Oi(e,e.dump,t,s,l);else{if(a==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new M("unacceptable kind of an object to dump "+a)}e.tag!==null&&e.tag!=="?"&&(c=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?c="!"+c:c.slice(0,18)==="tag:yaml.org,2002:"?c="!!"+c.slice(18):c="!<"+c+">",e.dump=c+" "+e.dump)}return!0}function Ri(e,t){var n=[],i=[],r,s;for(ot(e,n,i),r=0,s=i.length;r<s;r+=1)t.duplicates.push(n[i[r]]);t.usedDuplicates=new Array(s)}function ot(e,t,n){var i,r,s;if(e!==null&&typeof e=="object")if(r=t.indexOf(e),r!==-1)n.indexOf(r)===-1&&n.push(r);else if(t.push(e),Array.isArray(e))for(r=0,s=e.length;r<s;r+=1)ot(e[r],t,n);else for(i=Object.keys(e),r=0,s=i.length;r<s;r+=1)ot(e[i[r]],t,n)}function _i(e,t){t=t||{};var n=new Ai(t);n.noRefs||Ri(e,n);var i=e;return n.replacer&&(i=n.replacer.call({"":i},"",i)),W(n,0,i,!0,!0)?n.dump+`
`:""}var Bi=_i,$i={dump:Bi};function pt(e,t){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+t+" instead, which is now safe by default.")}}var Ne=Vt.load,uo=Vt.loadAll,ho=$i.dump;var go=pt("safeLoad","load"),mo=pt("safeLoadAll","loadAll"),yo=pt("safeDump","dump");var Oe=class{constructor(t){this.app=t}async findExampleFile(t){let n=this.app.vault.getAbstractFileByPath(t);if(!n)return null;if(n instanceof ae.TFile&&n.extension==="md")return await this.parseFrontmatter(n);let i=this.getMarkdownFiles(n,!1);i.length===0&&n instanceof ae.TFolder&&(i=this.getMarkdownFiles(n,!0,1),i.length===0&&(i=this.getMarkdownFiles(n,!0,2)),i.length===0&&(i=this.getMarkdownFiles(n,!0)));for(let r of i){let s=await this.parseFrontmatter(r);if(s)return s}return null}getMarkdownFiles(t,n=!0,i,r=0){let s=[];if(!t.children||i!==void 0&&r>=i)return s;for(let o of t.children)o instanceof ae.TFile&&o.extension==="md"?s.push(o):n&&o instanceof ae.TFolder&&o.children&&s.push(...this.getMarkdownFiles(o,n,i,r+1));return s}async parseFrontmatter(t){try{let n=await this.app.vault.read(t),i=/^---\s*\n([\s\S]*?)\n---\s*\n/,r=n.match(i);if(!r)return null;let s=r[1],o=Ne(s);return!o||typeof o!="object"?null:{file:t.path,frontmatter:o,rawYaml:s}}catch(n){return null}}autoDetectDateProperty(t){let n=["date","pubDate","publishedDate","publishDate"];for(let i of n)if(t.hasOwnProperty(i))return i;return null}autoDetectDescriptionProperty(t){let n=["description","summary","excerpt","intro","snippet","blurb"];for(let i of n)if(t.hasOwnProperty(i))return i;return null}autoDetectTagsProperty(t){return t.hasOwnProperty("tags")?"tags":null}autoDetectDraftProperty(t){return t.hasOwnProperty("draft")?{property:"draft",logic:"true-draft"}:t.hasOwnProperty("published")?{property:"published",logic:"false-draft"}:null}autoDetectImageProperty(t){let n=["image","cover","coverImage","thumbnail","featuredImage"];for(let i of n)if(t.hasOwnProperty(i))return i;return null}};var Ie=class extends T{constructor(n,i,r,s,o,a){super(n,i,r,s,o,a);this.examples={};this.frontmatterAnalyzer=new Oe(n)}async display(){let{containerEl:n}=this,i=n.querySelector(".frontmatter-step-content");i&&i.remove();let r=n.createDiv({cls:"frontmatter-step-content"});r.createEl("h2",{text:"Frontmatter Properties"}),r.createEl("p",{text:"Map frontmatter properties for each content type. We'll find example files to help you."});for(let s of this.state.contentTypes){if(!s.enabled)continue;let o=r.createDiv({cls:"content-type-settings"});if(!this.examples[s.id]){let v=new V(this.app).getFolderPathFromVaultRoot(s.folder,this.state.projectDetection),x=await this.frontmatterAnalyzer.findExampleFile(v);x&&(this.examples[s.id]=x)}let a=this.examples[s.id];if(o.createEl("h3",{text:s.name}),a){o.createEl("p",{text:`Example file: ${a.file}`});let m=o.createEl("pre",{text:a.rawYaml,cls:"frontmatter-example"});m.style.fontFamily="var(--font-monospace)",m.style.fontSize="0.85em",m.style.whiteSpace="pre-wrap",m.style.wordWrap="break-word",m.style.overflowWrap="break-word",m.style.maxWidth="100%",m.style.padding="10px",m.style.backgroundColor="var(--background-secondary)",m.style.borderRadius="4px",m.style.border="1px solid var(--background-modifier-border)";let v=this.frontmatterAnalyzer.autoDetectDateProperty(a.frontmatter),x=this.frontmatterAnalyzer.autoDetectDescriptionProperty(a.frontmatter)}if(!this.state.frontmatterProperties[s.id]){let m=a?this.frontmatterAnalyzer.autoDetectDraftProperty(a.frontmatter):null,v=a?this.frontmatterAnalyzer.autoDetectTagsProperty(a.frontmatter):null,x=a?this.frontmatterAnalyzer.autoDetectImageProperty(a.frontmatter):null,F=a?this.frontmatterAnalyzer.autoDetectDescriptionProperty(a.frontmatter):null,I=a&&a.frontmatter.hasOwnProperty("title")?"title":null,A=a?this.frontmatterAnalyzer.autoDetectDateProperty(a.frontmatter):null;this.state.frontmatterProperties[s.id]={titleProperty:I||void 0,dateProperty:A||void 0,descriptionProperty:F||void 0,tagsProperty:v||void 0,draftProperty:m==null?void 0:m.property,draftLogic:(m==null?void 0:m.property)==="published"?"false-draft":m?"true-draft":void 0,hasDraftStatus:!!(m!=null&&m.property),imageProperty:x||void 0}}let l=this.state.frontmatterProperties[s.id];new N.Setting(o).setName("Title Property").setDesc("The frontmatter property that contains the title (e.g., title, name, heading). Leave blank to use file name instead.").addText(m=>{let v="title";m.setPlaceholder(v).setValue(l.titleProperty||"").onChange(x=>{l.titleProperty=x.trim()||void 0})}),new N.Setting(o).setName("Date Property").setDesc("The frontmatter property that contains the date (e.g., date, pubDate, publishedDate, publishDate). Leave blank to use file created date instead.").addText(m=>{let v=a?this.frontmatterAnalyzer.autoDetectDateProperty(a.frontmatter):null;m.setPlaceholder(v||"date").setValue(l.dateProperty||"").onChange(x=>{l.dateProperty=x.trim()||void 0})});let c=new N.Setting(o).setName("Has Description/Summary?").setDesc("Does this content type have a description or summary field?"),p=null;c.addToggle(m=>m.setValue(!!l.descriptionProperty).onChange(v=>{v&&!l.descriptionProperty?(l.descriptionProperty=a&&this.frontmatterAnalyzer.autoDetectDescriptionProperty(a.frontmatter)||"description",p||(p=new N.Setting(o).setName("Description Property").setDesc("The frontmatter property that contains the description (e.g., description, summary, excerpt, intro, snippet, blurb)").addText(x=>x.setValue(l.descriptionProperty||"").onChange(F=>{l.descriptionProperty=F.trim()||void 0})),p.settingEl.remove(),c.settingEl.insertAdjacentElement("afterend",p.settingEl))):v||(l.descriptionProperty=void 0,p&&(p.settingEl.remove(),p=null))})),l.descriptionProperty&&(p=new N.Setting(o).setName("Description Property").setDesc("The frontmatter property that contains the description (e.g., description, summary, excerpt, intro, snippet, blurb)").addText(m=>m.setValue(l.descriptionProperty||"").onChange(v=>{l.descriptionProperty=v.trim()||void 0})),p.settingEl.remove(),c.settingEl.insertAdjacentElement("afterend",p.settingEl));let d=new N.Setting(o).setName("Has Tags?").setDesc("Does this content type have tags?"),f=null;d.addToggle(m=>m.setValue(!!l.tagsProperty).onChange(v=>{if(v&&!l.tagsProperty){let x=a?this.frontmatterAnalyzer.autoDetectTagsProperty(a.frontmatter):null;l.tagsProperty=x||"tags",f||(f=new N.Setting(o).setName("Tags Property").setDesc("The frontmatter property that contains tags (e.g., tags, tag, categories, category). Leave blank if not applicable.").addText(F=>{let I=a?this.frontmatterAnalyzer.autoDetectTagsProperty(a.frontmatter):null;F.setPlaceholder(I||"tags").setValue(l.tagsProperty||"").onChange(A=>{l.tagsProperty=A.trim()||void 0})}),f.settingEl.remove(),d.settingEl.insertAdjacentElement("afterend",f.settingEl))}else v||(l.tagsProperty=void 0,f&&(f.settingEl.remove(),f=null))})),l.tagsProperty&&(f=new N.Setting(o).setName("Tags Property").setDesc("The frontmatter property that contains tags (e.g., tags, tag, categories, category). Leave blank if not applicable.").addText(m=>{let v=a?this.frontmatterAnalyzer.autoDetectTagsProperty(a.frontmatter):null;m.setPlaceholder(v||"tags").setValue(l.tagsProperty||"").onChange(x=>{l.tagsProperty=x.trim()||void 0})}),f.settingEl.remove(),d.settingEl.insertAdjacentElement("afterend",f.settingEl));let h=new N.Setting(o).setName("Has Draft Status?").setDesc("Does this content type have draft status?"),u=null,g=null;l.hasDraftStatus===void 0&&(l.hasDraftStatus=!!l.draftProperty),h.addToggle(m=>{var v;return m.setValue((v=l.hasDraftStatus)!=null?v:!!l.draftProperty).onChange(x=>{if(l.hasDraftStatus=x,x&&!l.draftProperty){let F=a?this.frontmatterAnalyzer.autoDetectDraftProperty(a.frontmatter):null;l.draftProperty=(F==null?void 0:F.property)||"draft",(F==null?void 0:F.property)==="published"?l.draftLogic="false-draft":l.draftLogic="true-draft",u||(u=new N.Setting(o).setName("Draft Property").setDesc("The frontmatter property that contains draft status. Leave blank to use an underscore prefix instead.").addText(I=>{let A=a?this.frontmatterAnalyzer.autoDetectDraftProperty(a.frontmatter):null;I.setPlaceholder((A==null?void 0:A.property)||"draft").setValue(l.draftProperty||"").onChange(R=>{l.draftProperty=R.trim()||void 0,R==="published"?l.draftLogic="false-draft":R&&(l.draftLogic="true-draft"),R&&!g?(g=new N.Setting(o).setName("Draft Logic").setDesc("How draft status is represented").addDropdown(pn=>pn.addOption("true-draft","true = draft").addOption("false-draft","false = draft").setValue(l.draftLogic||"true-draft").onChange(fn=>{l.draftLogic=fn})),g.settingEl.remove(),u&&u.settingEl.insertAdjacentElement("afterend",g.settingEl)):!R&&g&&(g.settingEl.remove(),g=null)})}),u.settingEl.remove(),h.settingEl.insertAdjacentElement("afterend",u.settingEl)),l.draftProperty&&!g&&(g=new N.Setting(o).setName("Draft Logic").setDesc("How draft status is represented").addDropdown(I=>I.addOption("true-draft","true = draft").addOption("false-draft","false = draft").setValue(l.draftLogic||"true-draft").onChange(A=>{l.draftLogic=A})),g.settingEl.remove(),u&&u.settingEl.insertAdjacentElement("afterend",g.settingEl))}else x||(l.draftProperty=void 0,l.draftLogic=void 0,l.hasDraftStatus=!1,u&&(u.settingEl.remove(),u=null),g&&(g.settingEl.remove(),g=null))})}),l.hasDraftStatus&&(u=new N.Setting(o).setName("Draft Property").setDesc("The frontmatter property that contains draft status. Leave blank to use an underscore prefix instead.").addText(m=>{let v=a?this.frontmatterAnalyzer.autoDetectDraftProperty(a.frontmatter):null;m.setPlaceholder((v==null?void 0:v.property)||"draft").setValue(l.draftProperty||"").onChange(x=>{l.draftProperty=x.trim()||void 0,x==="published"?l.draftLogic="false-draft":x&&(l.draftLogic="true-draft"),x&&!g?(g=new N.Setting(o).setName("Draft Logic").setDesc("How draft status is represented").addDropdown(F=>F.addOption("true-draft","true = draft").addOption("false-draft","false = draft").setValue(l.draftLogic||"true-draft").onChange(I=>{l.draftLogic=I})),g.settingEl.remove(),u&&u.settingEl.insertAdjacentElement("afterend",g.settingEl)):!x&&g&&(g.settingEl.remove(),g=null)})}),u.settingEl.remove(),h.settingEl.insertAdjacentElement("afterend",u.settingEl),l.draftProperty&&(g=new N.Setting(o).setName("Draft Logic").setDesc("How draft status is represented").addDropdown(m=>m.addOption("true-draft","true = draft").addOption("false-draft","false = draft").setValue(l.draftLogic||"true-draft").onChange(v=>{l.draftLogic=v})),g.settingEl.remove(),u&&u.settingEl.insertAdjacentElement("afterend",g.settingEl)));let y=new N.Setting(o).setName("Has Image/Cover Property?").setDesc("Does this content type have an image or cover property? Used for Bases CMS cover images, Simple Banner, and Image Inserter."),P=null;if(y.addToggle(m=>m.setValue(!!l.imageProperty).onChange(v=>{if(v&&!l.imageProperty){let x=a?this.frontmatterAnalyzer.autoDetectImageProperty(a.frontmatter):null;l.imageProperty=x||"image",P||(P=new N.Setting(o).setName("Image Property").setDesc("The frontmatter property that contains the image/cover (e.g., image, cover, coverImage, thumbnail, featuredImage). Leave blank if not applicable.").addText(F=>{let I=a?this.frontmatterAnalyzer.autoDetectImageProperty(a.frontmatter):null;F.setPlaceholder(I||"image").setValue(l.imageProperty||"").onChange(A=>{l.imageProperty=A.trim()||void 0})}),P.settingEl.remove(),y.settingEl.insertAdjacentElement("afterend",P.settingEl))}else v||(l.imageProperty=void 0,P&&(P.settingEl.remove(),P=null))})),l.imageProperty&&(P=new N.Setting(o).setName("Image Property").setDesc("The frontmatter property that contains the image/cover (e.g., image, cover, coverImage, thumbnail, featuredImage). Leave blank if not applicable.").addText(m=>{let v=a?this.frontmatterAnalyzer.autoDetectImageProperty(a.frontmatter):null;m.setPlaceholder(v||"image").setValue(l.imageProperty||"").onChange(x=>{l.imageProperty=x.trim()||void 0})}),P.settingEl.remove(),y.settingEl.insertAdjacentElement("afterend",P.settingEl)),o.createEl("h4",{text:"Template"}),o.createEl("p",{text:'Edit the template that will be used when creating new files of this content type. Use {{title}} and {{date}} as variables. Note: {{title}} should be in quotes (e.g., title: "{{title}}"), while {{date}} should not be in quotes (e.g., date: {{date}}).'}),!l.template){let m=s.name==="Posts";l.template=this.generateDefaultTemplate(l,m,a)}let b=o.createEl("textarea",{cls:"template-editor",attr:{rows:"10",style:"width: 100%; font-family: monospace;",spellcheck:"false"}});b.value=l.template||"",b.addEventListener("input",m=>{let v=m.target;l.template=v.value})}}generateDefaultTemplate(n,i,r){let s=`---
`;if(r&&r.rawYaml){let o=r.rawYaml.split(`
`),a=new Set,l=!1;if(n.titleProperty){for(let c of o){let p=c.trim();if(!p||p.startsWith("#"))continue;let d=p.indexOf(":");if(d>0){let f=p.substring(0,d).trim();if(f===n.titleProperty){s+=`${n.titleProperty}: "{{title}}"
`,l=!0,a.add(f);continue}}}l||(s+=`${n.titleProperty}: "{{title}}"
`)}for(let c of o){let p=c.trim();if(!p||p.startsWith("#"))continue;let d=p.indexOf(":");if(d>0){let f=p.substring(0,d).trim();if(a.has(f)||f===n.titleProperty)continue;if(f===n.dateProperty&&n.dateProperty){s+=`${n.dateProperty}: {{date}}
`,a.add(f);continue}if(f===n.descriptionProperty){s+=`${n.descriptionProperty}: ""
`,a.add(f);continue}let h=r.frontmatter[f];h==null?s+=`${f}:
`:Array.isArray(h)?s+=`${f}: []
`:typeof h=="boolean"?s+=`${f}: ${h}
`:typeof h=="number"?s+=`${f}: ${h}
`:typeof h=="string"?/^\d{4}-\d{2}-\d{2}/.test(h)&&f.toLowerCase().includes("date")?s+=`${f}: {{date}}
`:s+=`${f}: ""
`:typeof h=="object"&&(Array.isArray(h)?s+=`${f}: []
`:s+=`${f}:
`),a.add(f)}}}else if(n.titleProperty&&(s+=`${n.titleProperty}: "{{title}}"
`),n.dateProperty&&(s+=`${n.dateProperty}: {{date}}
`),n.descriptionProperty&&(s+=`${n.descriptionProperty}: ""
`),n.tagsProperty&&(s+=`${n.tagsProperty}: []
`),n.draftProperty){let o=n.draftLogic==="false-draft"?"false":"true";s+=`${n.draftProperty}: ${o}
`}return s+=`---
`,s}validate(){return!0}getTitle(){return"Frontmatter Properties"}getDescription(){return"Map frontmatter properties"}};var on=require("obsidian");var ke=class extends T{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"WYSIWYG Editing Toolbar"}),t.createEl("p",{text:"Do you want to use the WYSIWYG editing toolbar?"}),t.createEl("p",{text:"This enables a visual editing toolbar for formatting text. The toolbar can be toggled on/off via command."}),new on.Setting(t).setName("Enable WYSIWYG Toolbar").setDesc("Show the editing toolbar command in the page header").addToggle(n=>n.setValue(this.state.enableWYSIWYG).onChange(i=>{this.state.enableWYSIWYG=i}))}validate(){return!0}getTitle(){return"WYSIWYG Preference"}getDescription(){return"Configure editing toolbar preference"}};var je=class extends T{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Bases CMS Configuration"}),t.createEl("p",{text:"Bases CMS views will be automatically created for each enabled content type using your mapped frontmatter properties."});let n=this.state.contentTypes.filter(r=>r.enabled);if(n.length===0){t.createEl("p",{text:"No content types enabled. Please go back and enable at least one content type."});return}t.createEl("h3",{text:"Views to be created:"});let i=t.createEl("ul");for(let r of n){let s=this.state.frontmatterProperties[r.id];if(s){let o=[];s.titleProperty&&o.push(`title: ${s.titleProperty}`),s.dateProperty&&o.push(`date: ${s.dateProperty}`),s.descriptionProperty&&o.push(`description: ${s.descriptionProperty}`),s.tagsProperty&&o.push(`tags: ${s.tagsProperty}`),s.imageProperty&&o.push(`image: ${s.imageProperty}`),s.draftProperty&&o.push(`draft: ${s.draftProperty}`);let a=o.length>0?o.join(", "):"default properties";i.createEl("li",{text:`${r.name}: ${a}`})}}t.createEl("p",{text:"You can customize these views later in the Bases CMS settings."})}validate(){return this.state.contentTypes.some(t=>t.enabled)}getTitle(){return"Bases CMS Configuration"}getDescription(){return"Configure Bases CMS views"}};var Me=class extends T{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Astro Composer Configuration"}),t.createEl("p",{text:"Astro Composer will be configured with your content types and frontmatter properties."});let n=this.state.contentTypes.filter(r=>r.enabled);if(n.length===0){t.createEl("p",{text:"No content types enabled."});return}t.createEl("h3",{text:"Content types to configure:"});let i=t.createEl("ul");for(let r of n)if(this.state.frontmatterProperties[r.id]){let o=r.fileOrganization==="folder"?"folder-based":"file-based";i.createEl("li",{text:`${r.name} (${r.folder}): ${o}`})}this.state.projectDetection&&(this.state.projectDetection.projectRoot&&t.createEl("p",{text:`Project root: ${this.state.projectDetection.projectRoot}`}),this.state.projectDetection.configFilePath&&t.createEl("p",{text:`Config file: ${this.state.projectDetection.configFilePath}`}))}validate(){return!0}getTitle(){return"Astro Composer Configuration"}getDescription(){return"Configure Astro Composer"}};var an=require("obsidian");var Le=class extends T{display(){var p;let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"SEO Plugin Configuration"}),t.createEl("p",{text:"SEO plugin will be configured using your mapped frontmatter properties."});let n=this.state.contentTypes.filter(d=>d.enabled),i=n[0],r=i?this.state.frontmatterProperties[i.id]:void 0,s=new Set,o=new Set;for(let d of n){let f=this.state.frontmatterProperties[d.id];f&&(f.titleProperty&&s.add(f.titleProperty),f.descriptionProperty&&o.add(f.descriptionProperty))}if(s.size>1||o.size>1){let d=t.createDiv({cls:"vault-cms-warning"});d.style.padding="10px",d.style.backgroundColor="var(--background-modifier-border)",d.style.borderLeft="3px solid var(--text-warning)",d.style.marginBottom="15px",d.createEl("p",{text:"\u26A0\uFE0F Warning: Different content types use different properties for title or description.",attr:{style:"margin: 0 0 5px 0; font-weight: bold;"}}),d.createEl("p",{text:"The SEO plugin will use the first content type's properties. You may need to manually configure SEO settings for other content types.",attr:{style:"margin: 0;"}})}if(r){t.createEl("h3",{text:"Configuration:"}),t.createEl("p",{text:`Title property: ${r.titleProperty||"(using filename)"}`}),r.descriptionProperty&&t.createEl("p",{text:`Description property: ${r.descriptionProperty}`});let d=n.map(f=>f.folder).join(", ");t.createEl("p",{text:`Scan directories: ${d}`})}let a=this.state.contentTypes.filter(d=>d.enabled).map(d=>d.folder).join(","),l=(p=this.state.seoConfig)==null?void 0:p.scanDirectories,c=l&&l.trim()?l:a;(!this.state.seoConfig.scanDirectories||!this.state.seoConfig.scanDirectories.trim())&&(this.state.seoConfig.scanDirectories=c),new an.Setting(t).setName("Scan Directories").setDesc("Comma-separated list of directories to scan (you can customize this)").addText(d=>d.setValue(c).onChange(f=>{this.state.seoConfig&&(this.state.seoConfig.scanDirectories=f)}))}validate(){return!0}getTitle(){return"SEO Configuration"}getDescription(){return"Configure SEO plugin"}};var ft=require("obsidian"),ue=require("obsidian");var se=class{constructor(t){this.app=t}async enablePlugin(t){let n=this.app.plugins;if(!n)return;let i=n.plugins[t];i&&!i.enabled&&await n.enablePlugin(t)}async disablePlugin(t){let n=this.app.plugins;if(!n)return;let i=n.plugins[t];i&&i.enabled&&await n.disablePlugin(t)}async setPluginStates(t,n){for(let i of n)await this.disablePlugin(i);for(let i of t)await this.enablePlugin(i)}getPresetPlugins(t){let n=["astro-composer","bases-cms","homepage","new-tab-default-page","seo","property-over-file-name","settings-search","statusbar-organizer","zenmode","cmdr","editing-toolbar","simple-focus","tag-wrangler"],i=["insert-unsplash-image","custom-save","title-only-tab","obsidian-paste-image-rename","obsidian42-brat","obsidian-hider","disable-tabs","obsidian-style-settings","mdx-as-md-obsidian"],r=["obsidian-oxygen","obsidian-style-settings"];return t==="vanilla"?{enabled:[...n,...i.filter(s=>!r.includes(s))],disabled:r}:t==="opinionated"?{enabled:[...n,...i],disabled:[]}:{enabled:[],disabled:[]}}};var Re=class extends T{constructor(n,i,r,s,o,a){super(n,i,r,s,o,a);this.pluginManager=new se(n)}display(){var c,p,d,f,h,u,g,y,P,b;let{containerEl:n}=this;n.empty(),n.createEl("h2",{text:"Plugin Configuration"}),n.createEl("p",{text:"Review and configure your installed plugins. Essential plugins are recommended for the core Vault CMS experience."});let i=[{id:"astro-composer",name:"Astro Composer",category:"essential"},{id:"bases-cms",name:"Bases CMS",category:"essential"},{id:"cmdr",name:"Commander",category:"essential"},{id:"new-tab-default-page",name:"Default New Tab Page",category:"essential"},{id:"editing-toolbar",name:"Editing Toolbar",category:"essential"},{id:"homepage",name:"Homepage",category:"essential"},{id:"obsidian-paste-image-rename",name:"Paste Image Rename",category:"essential"},{id:"property-over-file-name",name:"Property Over File Name",category:"essential"},{id:"seo",name:"SEO",category:"essential"},{id:"simple-focus",name:"Simple Focus",category:"essential"},{id:"statusbar-organizer",name:"Status Bar Organizer",category:"essential"},{id:"zenmode",name:"Zen Mode",category:"essential"},{id:"iconic",name:"Iconic",category:"nice-to-have"},{id:"settings-search",name:"Settings Search",category:"nice-to-have"},{id:"simple-banner",name:"Simple Banner",category:"nice-to-have"},{id:"tag-wrangler",name:"Tag Wrangler",category:"nice-to-have"},{id:"insert-unsplash-image",name:"Image Inserter",category:"nice-to-have"},{id:"paste-image-into-property",name:"Paste Image Into Property",category:"nice-to-have"}],r=this.app.plugins,s=r!=null&&r.plugins?Object.keys(r.plugins):[],o=["obsidian42-brat","astro-modular-settings","alias-file-name-history","folder-notes","disable-tabs","vault-cms"],a=i.filter(m=>m.category==="essential"&&s.includes(m.id)&&!o.includes(m.id)),l=i.filter(m=>m.category==="nice-to-have"&&s.includes(m.id)&&!o.includes(m.id));if(a.length>0){n.createEl("h3",{text:"Essential Plugins",cls:"vault-cms-section-header"}),n.createEl("p",{text:"These plugins are recommended for the core Vault CMS experience.",cls:"vault-cms-section-desc"});for(let m of a){let v=(c=r==null?void 0:r.plugins)==null?void 0:c[m.id],x=!!v,F=(h=(f=(d=(p=r==null?void 0:r.enabledPlugins)==null?void 0:p.has)==null?void 0:d.call(p,m.id))!=null?f:v==null?void 0:v.enabled)!=null?h:!1;console.log(`Plugin ${m.id}: installed=${x}, enabled=${F}`),x&&F?(this.state.enabledPlugins.includes(m.id)||this.state.enabledPlugins.push(m.id),this.state.disabledPlugins=this.state.disabledPlugins.filter(R=>R!==m.id)):x&&!F&&(this.state.enabledPlugins=this.state.enabledPlugins.filter(R=>R!==m.id),this.state.disabledPlugins.includes(m.id)||this.state.disabledPlugins.push(m.id));let A=new ft.Setting(n).setName(m.name).setDesc(x?F?"Installed and enabled":"Installed but disabled":"Not installed").controlEl.createDiv({cls:"vault-cms-plugin-status"});x&&F?((0,ue.setIcon)(A,"lucide-check-circle-2"),A.style.color="var(--text-success)"):((0,ue.setIcon)(A,"lucide-x-circle"),A.style.color="var(--text-error)")}}if(l.length>0){n.createEl("h3",{text:"Nice to Have Plugins",cls:"vault-cms-section-header"}),n.createEl("p",{text:"These plugins can be helpful depending on your theme's capabilities and workflow needs.",cls:"vault-cms-section-desc"});for(let m of l){let v=(u=r==null?void 0:r.plugins)==null?void 0:u[m.id],x=!!v,F=(b=(P=(y=(g=r==null?void 0:r.enabledPlugins)==null?void 0:g.has)==null?void 0:y.call(g,m.id))!=null?P:v==null?void 0:v.enabled)!=null?b:!1;console.log(`Plugin ${m.id}: installed=${x}, enabled=${F}`),x&&F?(this.state.enabledPlugins.includes(m.id)||this.state.enabledPlugins.push(m.id),this.state.disabledPlugins=this.state.disabledPlugins.filter(R=>R!==m.id)):x&&!F&&(this.state.enabledPlugins=this.state.enabledPlugins.filter(R=>R!==m.id),this.state.disabledPlugins.includes(m.id)||this.state.disabledPlugins.push(m.id));let A=new ft.Setting(n).setName(m.name).setDesc(x?F?"Installed and enabled":"Installed but disabled":"Not installed").controlEl.createDiv({cls:"vault-cms-plugin-status"});x&&F?((0,ue.setIcon)(A,"lucide-check-circle-2"),A.style.color="var(--text-success)"):((0,ue.setIcon)(A,"lucide-x-circle"),A.style.color="var(--text-error)")}}a.length===0&&l.length===0&&n.createEl("p",{text:"No Vault CMS plugins detected. Make sure you have installed the recommended plugins."})}validate(){return!0}getTitle(){return"Optional Plugins"}getDescription(){return"Configure optional plugins"}};var dt=require("obsidian");var _e=require("obsidian");var Be=class{constructor(t){this.app=t,this.pathResolver=new V(t)}async createOrUpdateBaseFile(t,n,i,r){let s="bases/Home.base";if(!this.app.vault.getAbstractFileByPath("bases"))try{await this.app.vault.createFolder("bases")}catch(h){(!h.message||!h.message.includes("already exists"))&&console.warn("BasesCMSConfig: Could not create bases folder:",h)}let a=this.app.vault.getAbstractFileByPath(s),l=null;if(a&&a instanceof _e.TFile)try{let h=await this.app.vault.read(a);l=Ne(h)}catch(h){console.error("BasesCMSConfig: Failed to parse existing base file:",h)}let c=t.filter(h=>h.enabled);console.log("BasesCMSConfig: Generating base content for",t.length,"content types"),console.log("BasesCMSConfig: Enabled content types:",c.map(h=>h.name));let p=this.generateBaseContent(t,n,i,l,r),d=p.match(/^\s*-\s+type:\s+bases-cms/gm),f=d?d.length:0;if(console.log("BasesCMSConfig: Generated",f,"views in base content"),a=this.app.vault.getAbstractFileByPath(s),a&&a instanceof _e.TFile){console.log("BasesCMSConfig: Modifying existing Home.base file");try{await this.app.vault.modify(a,p),console.log("BasesCMSConfig: Successfully modified Home.base file");return}catch(h){throw console.error("BasesCMSConfig: Failed to modify file:",h),h}}console.log("BasesCMSConfig: Creating new Home.base file");try{await this.app.vault.create(s,p),console.log("BasesCMSConfig: Successfully created Home.base file")}catch(h){if(h.message&&(h.message.includes("already exists")||h.message.includes("File already exists"))){console.log("BasesCMSConfig: File existed, attempting direct modify via path");try{let u=this.app.vault.adapter;if(u&&typeof u.write=="function")await u.write(s,p),console.log("BasesCMSConfig: Successfully wrote Home.base file via adapter");else{console.log("BasesCMSConfig: Adapter write not available, retrying getAbstractFileByPath");for(let g=0;g<10;g++){await new Promise(P=>setTimeout(P,200));let y=this.app.vault.getAbstractFileByPath(s);if(y&&y instanceof _e.TFile){await this.app.vault.modify(y,p),console.log(`BasesCMSConfig: Successfully modified Home.base file on retry ${g+1}`);return}}throw console.error("BasesCMSConfig: File exists but cannot be found after all retries"),new Error("File exists but cannot be accessed. Please try again or manually edit bases/Home.base")}}catch(u){throw console.error("BasesCMSConfig: Failed to write file via adapter:",u),u}}else throw console.error("BasesCMSConfig: Failed to create base file:",h),h}}generateBaseContent(t,n,i,r,s){var h;let o=[];if(r!=null&&r.formulas){o.push("formulas:");for(let[u,g]of Object.entries(r.formulas))if(typeof g=="string"){o.push(`  ${u}: |-`);let y=g.split(`
`);for(let P of y)o.push(`    ${P}`)}o.push("")}o.push("filters:"),o.push("  and:"),o.push('    - file.ext == "md"'),o.push("");let a=new Set;for(let u of t){let g=n[u.id];g&&(a.add(`note.${g.titleProperty}`),a.add(`note.${g.dateProperty}`),g.descriptionProperty&&a.add(`note.${g.descriptionProperty}`),g.tagsProperty&&a.add(`note.${g.tagsProperty}`),g.draftProperty&&a.add(`note.${g.draftProperty}`),g.imageProperty&&a.add(`note.${g.imageProperty}`))}if(a.add("note.title"),a.add("note.date"),a.add("note.pubDate"),a.add("note.draft"),a.add("file.name"),r!=null&&r.properties)for(let u of Object.keys(r.properties))u.startsWith("formula.")&&a.add(u);if(a.size>0){o.push("properties:");let u=(r==null?void 0:r.properties)||{};for(let g of Array.from(a).sort())if(o.push(`  ${g}:`),(h=u[g])!=null&&h.displayName)o.push(`    displayName: ${u[g].displayName}`);else{let y=g.replace("note.","").replace("file.","");o.push(`    displayName: ${this.capitalizeFirst(y)}`)}o.push("")}o.push("views:");let l=i?t.find(u=>u.id===i&&u.enabled):null,c=(r==null?void 0:r.views)||[],p=new Set(t.filter(u=>u.enabled).map(u=>u.name)),d=c.find(u=>u.name==="Guide"),f=c.filter(u=>u.name!=="All Content"&&u.name!=="Guide"&&!p.has(u.name));if(l){let u=n[l.id];if(u){let g=this.pathResolver.getBasesCMSFolderPath(l.folder,s);o.push("  - type: bases-cms"),o.push(`    name: ${l.name}`),o.push("    filters:"),o.push("      and:"),o.push(`        - file.folder.startsWith("${g}")`),o.push("    imageFormat: cover"),u.titleProperty?o.push(`    titleProperty: note.${u.titleProperty}`):o.push("    titleProperty: file.name"),u.dateProperty?o.push(`    dateProperty: note.${u.dateProperty}`):o.push("    dateProperty: file.ctime"),u.descriptionProperty&&o.push(`    descriptionProperty: note.${u.descriptionProperty}`),u.imageProperty&&o.push(`    imageProperty: note.${u.imageProperty}`),o.push(`    showTags: ${u.tagsProperty?"true":"false"}`),u.tagsProperty&&o.push(`    tagsProperty: note.${u.tagsProperty}`),o.push("    showDate: true"),o.push(`    showDraftStatus: ${u.draftProperty?"true":"false"}`),u.draftProperty&&o.push(`    draftStatusProperty: note.${u.draftProperty}`),o.push("    customizeNewButton: true"),o.push(`    newNoteLocation: "${g}"`),o.push("    fallbackToEmbeds: if-empty"),o.push("    propertyDisplay1: file.name"),o.push("    showTextPreview: true"),o.push("    propertyLabels: above"),o.push("    sort:"),o.push(`      - property: ${u.dateProperty?`note.${u.dateProperty}`:"file.ctime"}`),o.push("        direction: DESC")}}for(let u of t){if(!u.enabled||u.name==="All Content"||l&&u.id===l.id)continue;let g=n[u.id];if(!g)continue;let y=this.pathResolver.getBasesCMSFolderPath(u.folder,s);o.push("  - type: bases-cms"),o.push(`    name: ${u.name}`),o.push("    filters:"),o.push("      and:"),o.push(`        - file.folder.startsWith("${y}")`),o.push("    imageFormat: cover"),g.titleProperty?o.push(`    titleProperty: note.${g.titleProperty}`):o.push("    titleProperty: file.name"),g.dateProperty?o.push(`    dateProperty: note.${g.dateProperty}`):o.push("    dateProperty: file.ctime"),g.descriptionProperty&&o.push(`    descriptionProperty: note.${g.descriptionProperty}`),g.imageProperty&&o.push(`    imageProperty: note.${g.imageProperty}`),o.push(`    showTags: ${g.tagsProperty?"true":"false"}`),g.tagsProperty&&o.push(`    tagsProperty: note.${g.tagsProperty}`),o.push("    showDate: true"),o.push(`    showDraftStatus: ${g.draftProperty?"true":"false"}`),g.draftProperty&&o.push(`    draftStatusProperty: note.${g.draftProperty}`),o.push("    customizeNewButton: true"),o.push(`    newNoteLocation: "${y}"`),o.push("    fallbackToEmbeds: if-empty"),o.push("    propertyDisplay1: file.name"),o.push("    showTextPreview: true"),o.push("    propertyLabels: above"),o.push("    sort:"),o.push(`      - property: ${g.dateProperty?`note.${g.dateProperty}`:"file.ctime"}`),o.push("        direction: DESC")}for(let u of f)o.push(...this.serializeView(u));return d&&o.push(...this.serializeView(d)),o.join(`
`)}capitalizeFirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}serializeView(t){let n=[];if(n.push("  - type: bases-cms"),n.push(`    name: ${t.name}`),t.filters&&(n.push("    filters:"),t.filters.and)){n.push("      and:");for(let r of t.filters.and)if(typeof r=="string")n.push(`        - ${r}`);else if(typeof r=="object")for(let[s,o]of Object.entries(r))n.push(`        - ${s}: ${typeof o=="string"?`"${o}"`:o}`)}if(t.groupBy&&(n.push("    groupBy:"),typeof t.groupBy=="object"&&(t.groupBy.property&&n.push(`      property: ${t.groupBy.property}`),t.groupBy.direction&&n.push(`      direction: ${t.groupBy.direction}`))),t.order){n.push("    order:");for(let r of t.order)n.push(`      - ${r}`)}if(t.sort){n.push("    sort:");for(let r of t.sort)typeof r=="object"&&r.property&&(n.push(`      - property: ${r.property}`),n.push(`        direction: ${r.direction||"ASC"}`))}let i=["type","name","filters","groupBy","order","sort"];for(let r of Object.keys(t)){if(i.includes(r)||t[r]===void 0)continue;let s=t[r];typeof s=="boolean"?n.push(`    ${r}: ${s}`):typeof s=="number"?n.push(`    ${r}: ${s}`):typeof s=="string"&&(r.includes("Property")&&(s.startsWith("note.")||s.startsWith("file."))?n.push(`    ${r}: ${s}`):r==="newNoteLocation"?n.push(`    ${r}: ${s}`):n.push(`    ${r}: "${s}"`))}return n}};var $e=class{constructor(t){this.app=t}generateSEOConfig(t,n){let i=t.find(o=>o.enabled),r=i?n[i.id]:void 0;return{titleProperty:(r==null?void 0:r.titleProperty)||"title",descriptionProperty:r==null?void 0:r.descriptionProperty,scanDirectories:t.filter(o=>o.enabled).map(o=>o.folder).join(","),keywordProperty:"targetKeyword",useFilenameAsTitle:!1,useFilenameAsSlug:!0}}async saveConfig(t){let i=".obsidian/plugins/seo/data.json";try{let r=this.app.vault.getAbstractFileByPath(i);if(r){let o={...JSON.parse(await this.app.vault.read(r)),...t};await this.app.vault.modify(r,JSON.stringify(o,null,2))}}catch(r){console.error("Failed to save SEO config:",r)}}};var he=require("obsidian"),ze=class{constructor(t){this.app=t}generateCommanderConfig(t){return{pageHeaderCommands:[]}}async toggleEditingToolbarCommand(t,n){var i,r,s;console.log(`CommanderConfig: toggleEditingToolbarCommand called with enable=${n}`);try{let o=t.plugins;if(!o){console.warn("CommanderConfig: Plugins API not available");return}let a=(i=o.plugins)==null?void 0:i["editing-toolbar"];if(!a){console.warn("CommanderConfig: Editing Toolbar plugin not found");return}if(console.log(`CommanderConfig: Editing Toolbar plugin found, enabled=${a.enabled}`),console.log("CommanderConfig: Plugin settings available:",!!a.settings),a.settings&&console.log("CommanderConfig: Current cMenuVisibility:",a.settings.cMenuVisibility),n&&!a.enabled?(console.log("CommanderConfig: Enabling editing-toolbar plugin"),await o.enablePlugin("editing-toolbar")):!n&&a.enabled&&(console.log("CommanderConfig: Disabling editing-toolbar plugin"),await o.disablePlugin("editing-toolbar")),a.settings&&typeof a.saveSettings=="function"){console.log("CommanderConfig: Using plugin.saveSettings() method");let l=a.settings.cMenuVisibility;if(a.settings.cMenuVisibility=n,console.log(`CommanderConfig: Set cMenuVisibility from ${l} to ${n}`),await a.saveSettings(),console.log("CommanderConfig: Successfully saved editing-toolbar via plugin.saveSettings()"),a.settings.cMenuVisibility===n?console.log(`CommanderConfig: Verified cMenuVisibility is now ${a.settings.cMenuVisibility}`):console.error(`CommanderConfig: ERROR - cMenuVisibility is ${a.settings.cMenuVisibility}, expected ${n}`),n){console.log("CommanderConfig: Waiting for settings to persist..."),await new Promise(c=>setTimeout(c,500)),typeof a.loadSettings=="function"&&(console.log("CommanderConfig: Reloading editing toolbar plugin settings"),await a.loadSettings()),typeof a.refresh=="function"&&(console.log("CommanderConfig: Refreshing editing toolbar plugin"),a.refresh()),console.log("CommanderConfig: Executing editing-toolbar:hide-show-menu command");try{for(let c=0;c<3;c++){let p=(s=(r=t.commands)==null?void 0:r.commands)==null?void 0:s["editing-toolbar:hide-show-menu"];console.log(`CommanderConfig: Command found (attempt ${c+1}):`,!!p),p?(setTimeout(()=>{t.commands.executeCommandById("editing-toolbar:hide-show-menu")},c*500),console.log(`CommanderConfig: Scheduled hide-show-menu command (attempt ${c+1})`)):console.warn(`CommanderConfig: Command editing-toolbar:hide-show-menu not found (attempt ${c+1})`)}}catch(c){console.error("CommanderConfig: Failed to execute editing toolbar show command:",c)}}return}else console.log("CommanderConfig: Plugin saveSettings not available, using fallback");await this.toggleEditingToolbarCommandFallback(t,n)}catch(o){console.error("CommanderConfig: Failed to toggle editing toolbar plugin:",o);try{await this.toggleEditingToolbarCommandFallback(t,n)}catch(a){console.error("CommanderConfig: Failed to toggle editing toolbar via fallback:",a)}}}async toggleEditingToolbarCommandFallback(t,n){var a;let i="editing-toolbar",r=`.obsidian/plugins/${i}/data.json`,s={},o=t.vault.getAbstractFileByPath(r);if(o&&o instanceof he.TFile)try{s=JSON.parse(await t.vault.read(o))}catch(l){console.warn("Failed to parse existing editing-toolbar data.json, starting fresh:",l),s={}}if(s.cMenuVisibility=n,o&&o instanceof he.TFile)await t.vault.modify(o,JSON.stringify(s,null,2)),console.log("CommanderConfig: Successfully saved editing-toolbar via file modify");else{let l=`.obsidian/plugins/${i}`;if(!t.vault.getAbstractFileByPath(l))try{await t.vault.createFolder(l)}catch(p){if(p.message&&!p.message.includes("already exists")&&!p.message.includes("File already exists")&&!p.message.includes("Folder already exists"))throw p}try{await t.vault.create(r,JSON.stringify(s,null,2)),console.log("CommanderConfig: Successfully created editing-toolbar data.json")}catch(p){if(p.message&&(p.message.includes("already exists")||p.message.includes("File already exists"))){let d=t.vault.getAbstractFileByPath(r);if(d&&d instanceof he.TFile)await t.vault.modify(d,JSON.stringify(s,null,2)),console.log("CommanderConfig: Successfully saved editing-toolbar via retry modify");else{await new Promise(h=>setTimeout(h,200));let f=t.vault.getAbstractFileByPath(r);if(f&&f instanceof he.TFile)await t.vault.modify(f,JSON.stringify(s,null,2)),console.log("CommanderConfig: Successfully saved editing-toolbar via delayed retry modify");else throw p}}else throw p}}if(n)try{await((a=t.commands)==null?void 0:a.executeCommandById("editing-toolbar:hide-show-menu"))}catch(l){console.warn("Failed to execute editing toolbar show command:",l)}}async saveConfig(t){let i=".obsidian/plugins/cmdr/data.json";try{let r=this.app.vault.getAbstractFileByPath(i);if(r){let s=JSON.parse(await this.app.vault.read(r)),o=s.pageHeader||[],a={id:"editing-toolbar:hide-show-menu",icon:"lucide-chevrons-up-down",name:"Toggle editing toolbar",mode:"desktop"},l=o.filter(p=>p.id!=="editing-toolbar:hide-show-menu");t.pageHeaderCommands.length>0&&l.push(a);let c={...s,pageHeader:l};await this.app.vault.modify(r,JSON.stringify(c,null,2))}}catch(r){console.error("Failed to save Commander config:",r)}}};var We=class{constructor(t){this.app=t}async saveConfig(t){let i=".obsidian/plugins/property-over-file-name/data.json";try{let r=this.app.vault.getAbstractFileByPath(i);if(r){let o={...JSON.parse(await this.app.vault.read(r)),...t};await this.app.vault.modify(r,JSON.stringify(o,null,2))}}catch(r){console.error("Failed to save Property Over File Name config:",r)}}};var Ye=require("obsidian"),He=class{constructor(t){this.app=t}async saveConfig(t,n){var s;let i="insert-unsplash-image",r=`.obsidian/plugins/${i}/data.json`;try{let o=this.app.plugins,a=(s=o==null?void 0:o.plugins)==null?void 0:s[i];if(a&&a.settings){let l=a.settings;if(l.frontmatter||(l.frontmatter={}),t.valueFormat&&(l.frontmatter.valueFormat=t.valueFormat),n&&(l.frontmatter.key=n),typeof a.saveSettings=="function"){await a.saveSettings(),console.log("ImageInserterConfig: Successfully saved via plugin.saveSettings()");return}}await this.saveConfigFallback(t,n)}catch(o){console.error("Failed to save Image Inserter config:",o);try{await this.saveConfigFallback(t,n)}catch(a){console.error("Failed to save Image Inserter config via fallback:",a)}}}async saveConfigFallback(t,n){let i="insert-unsplash-image",r=`.obsidian/plugins/${i}/data.json`,s={},o=this.app.vault.getAbstractFileByPath(r);if(o&&o instanceof Ye.TFile)try{s=JSON.parse(await this.app.vault.read(o))}catch(l){console.warn("Failed to parse existing Image Inserter data.json, starting fresh:",l),s={}}let a={...s};if(a.frontmatter||(a.frontmatter={}),t.valueFormat&&(a.frontmatter.valueFormat=t.valueFormat),n&&(a.frontmatter.key=n),o&&o instanceof Ye.TFile)await this.app.vault.modify(o,JSON.stringify(a,null,2));else{let l=`.obsidian/plugins/${i}`;if(!this.app.vault.getAbstractFileByPath(l))try{await this.app.vault.createFolder(l)}catch(p){if(!p.message||!p.message.includes("already exists")&&!p.message.includes("File already exists"))throw p}try{await this.app.vault.create(r,JSON.stringify(a,null,2))}catch(p){if(p.message&&(p.message.includes("already exists")||p.message.includes("File already exists"))){let d=this.app.vault.getAbstractFileByPath(r);if(d&&d instanceof Ye.TFile)await this.app.vault.modify(d,JSON.stringify(a,null,2));else throw p}else throw p}}}};var Ve=require("obsidian"),Ue=class{constructor(t){this.app=t}async saveConfig(t){var r;let n="simple-banner",i=`.obsidian/plugins/${n}/data.json`;try{let s=this.app.plugins,o=(r=s==null?void 0:s.plugins)==null?void 0:r[n];if(o&&o.settings&&(o.settings.properties||(o.settings.properties={}),o.settings.properties.image=t,typeof o.saveSettings=="function")){await o.saveSettings(),console.log("SimpleBannerConfig: Successfully saved via plugin.saveSettings()");return}await this.saveConfigFallback(t)}catch(s){console.error("Failed to save Simple Banner config:",s);try{await this.saveConfigFallback(t)}catch(o){console.error("Failed to save Simple Banner config via fallback:",o)}}}async saveConfigFallback(t){let n="simple-banner",i=`.obsidian/plugins/${n}/data.json`,r={},s=this.app.vault.getAbstractFileByPath(i);if(s&&s instanceof Ve.TFile)try{r=JSON.parse(await this.app.vault.read(s))}catch(o){console.warn("Failed to parse existing Simple Banner data.json, starting fresh:",o),r={}}if(r.properties||(r.properties={}),r.properties.image=t,s&&s instanceof Ve.TFile)await this.app.vault.modify(s,JSON.stringify(r,null,2));else{let o=`.obsidian/plugins/${n}`;if(!this.app.vault.getAbstractFileByPath(o))try{await this.app.vault.createFolder(o)}catch(l){if(!l.message||!l.message.includes("already exists")&&!l.message.includes("File already exists"))throw l}try{await this.app.vault.create(i,JSON.stringify(r,null,2))}catch(l){if(l.message&&(l.message.includes("already exists")||l.message.includes("File already exists"))){let c=this.app.vault.getAbstractFileByPath(i);if(c&&c instanceof Ve.TFile)await this.app.vault.modify(c,JSON.stringify(r,null,2));else throw l}else throw l}}}};var Ge=class extends T{constructor(n,i,r,s,o,a){super(n,i,r,s,o,a);this.applied=!1;this.pluginManager=new se(n),this.basesCMSConfigurator=new Be(n),this.astroComposerConfigurator=new ee(n),this.seoConfigurator=new $e(n),this.commanderConfigurator=new ze(n),this.propertyOverFileNameConfigurator=new We(n),this.imageInserterConfigurator=new He(n),this.simpleBannerConfigurator=new Ue(n)}display(){let{containerEl:n}=this;n.empty(),n.createEl("h2",{text:"Finalize Configuration"}),n.createEl("p",{text:'Review your configuration and click "Apply" to save all settings:'});let i=n.createEl("div",{cls:"finalize-summary"});i.createEl("h3",{text:"Summary"});let r=this.state.contentTypes.filter(p=>p.enabled);i.createEl("p",{text:`Content Types: ${r.length}`}),i.createEl("p",{text:`WYSIWYG Toolbar: ${this.state.enableWYSIWYG?"Enabled":"Disabled"}`});let s=r.length;i.createEl("p",{text:`Bases CMS Views: ${s} new view${s!==1?"s":""} to be created`});let o=r.map(p=>p.folder),a=o.length;i.createEl("p",{text:`SEO Scan Directories: ${a} director${a!==1?"ies":"y"} (${o.join(", ")})`});let l=n.createDiv();l.style.marginBottom="30px",l.createEl("button",{text:"Apply Configuration",cls:"mod-cta"}).addEventListener("click",async()=>{await this.applyConfiguration()})}async applyConfiguration(){if(!this.applied)try{if(console.log("FinalizeStep: Starting configuration application"),console.log("FinalizeStep: Enabled content types:",this.state.contentTypes.filter(a=>a.enabled).map(a=>a.name)),console.log("FinalizeStep: Configuring plugin states"),await this.pluginManager.setPluginStates(this.state.enabledPlugins,this.state.disabledPlugins),console.log("FinalizeStep: Configuring Bases CMS"),await this.basesCMSConfigurator.createOrUpdateBaseFile(this.state.contentTypes,this.state.frontmatterProperties,this.state.defaultContentTypeId,this.state.projectDetection),console.log("FinalizeStep: Bases CMS configuration complete"),this.state.projectDetection){let a=await this.astroComposerConfigurator.configureAstroComposer(this.state.contentTypes,this.state.frontmatterProperties,this.state.projectDetection.projectRoot,this.state.projectDetection.configFilePath,this.state.defaultContentTypeId,this.state.projectDetection);this.state.astroComposerConfig=a,await this.astroComposerConfigurator.saveConfig(a)}let n=this.seoConfigurator.generateSEOConfig(this.state.contentTypes,this.state.frontmatterProperties);this.state.seoConfig=n,await this.seoConfigurator.saveConfig(n),console.log(`FinalizeStep: Configuring editing toolbar, enableWYSIWYG=${this.state.enableWYSIWYG}`),await this.commanderConfigurator.toggleEditingToolbarCommand(this.app,this.state.enableWYSIWYG);let i=this.commanderConfigurator.generateCommanderConfig(this.state.enableWYSIWYG);this.state.commanderConfig=i,await this.commanderConfigurator.saveConfig(i);let r=this.state.contentTypes.find(a=>a.enabled),s=r?this.state.frontmatterProperties[r.id]:void 0;s&&s.titleProperty&&(this.state.propertyOverFileName.propertyKey=s.titleProperty,await this.propertyOverFileNameConfigurator.saveConfig(this.state.propertyOverFileName));let o=s==null?void 0:s.imageProperty;if(o&&this.state.enabledPlugins.includes("simple-banner")&&await this.simpleBannerConfigurator.saveConfig(o),o&&this.state.enabledPlugins.includes("insert-unsplash-image")){let a={...this.state.imageInserter};if(this.state.attachmentHandlingMode==="same-folder")a.valueFormat="[[{image-url}]]",a.insertFormat="[[{image-url}]]";else{let l=this.state.attachmentFolderName||"attachments";a.valueFormat=`[[${l}/{image-url}]]`,a.insertFormat=`[[${l}/{image-url}]]`}await this.imageInserterConfigurator.saveConfig(a,o)}if(this.state.defaultContentTypeId){let a=this.state.contentTypes.find(l=>l.id===this.state.defaultContentTypeId);if(a){console.log("FinalizeStep: Configuring Obsidian settings for default content type:",a.name);let l=this.app,c="./";if(this.state.attachmentHandlingMode==="same-folder"?c="./":this.state.attachmentHandlingMode==="subfolder"?c=`./${this.state.attachmentFolderName||"attachments"}`:this.state.attachmentHandlingMode==="specified-folder"&&(c=this.state.attachmentFolderName||"attachments"),l.setting&&typeof l.setting.set=="function")console.log("FinalizeStep: Using app.setting API"),await l.setting.set("newFileLocation","folder"),await l.setting.set("newFileFolderPath",a.folder),await l.setting.set("attachmentFolderPath",c),await l.setting.set("newLinkFormat","relative"),typeof l.setting.save=="function"&&(await l.setting.save(),console.log("FinalizeStep: Obsidian settings saved via app.setting.save()"));else{console.log("FinalizeStep: Using vault.config API");let p=this.app.vault.config;p?(p.newFileLocation="folder",p.newFileFolderPath=a.folder,p.attachmentFolderPath=c,p.newLinkFormat="relative",typeof this.app.vault.saveConfig=="function"?(await this.app.vault.saveConfig(),console.log("FinalizeStep: Obsidian settings saved via vault.saveConfig()")):console.error("FinalizeStep: vault.saveConfig() is not available")):console.error("FinalizeStep: vault.config is not available")}}}this.applied=!0,new dt.Notice("Configuration applied successfully!")}catch(n){console.error("Failed to apply configuration:",n),new dt.Notice("Failed to apply configuration. Please check the console for details.")}}validate(){return!0}getTitle(){return"Finalize"}getDescription(){return"Review and apply configuration"}};var q=class extends sn.Modal{constructor(n,i,r){var o,a,l,c,p,d,f,h,u,g,y,P,b,m,v,x,F,I;super(n);this.currentStepIndex=0;this.currentStepInstance=null;this.pluginInstance=r;let s=(i==null?void 0:i.projectDetection)||((o=r==null?void 0:r.settings)!=null&&o.projectRoot&&((a=r==null?void 0:r.settings)!=null&&a.configFilePath)?{projectRoot:r.settings.projectRoot,configFilePath:r.settings.configFilePath,vaultLocation:"content"}:void 0);this.state={currentStep:0,contentTypes:(i==null?void 0:i.contentTypes)||((l=r==null?void 0:r.settings)==null?void 0:l.contentTypes)||[],frontmatterProperties:(i==null?void 0:i.frontmatterProperties)||((c=r==null?void 0:r.settings)==null?void 0:c.frontmatterProperties)||{},projectDetection:s,defaultContentTypeId:(i==null?void 0:i.defaultContentTypeId)||((p=r==null?void 0:r.settings)==null?void 0:p.defaultContentTypeId),attachmentHandlingMode:(i==null?void 0:i.attachmentHandlingMode)||"subfolder",attachmentFolderName:i==null?void 0:i.attachmentFolderName,preset:(i==null?void 0:i.preset)||((d=r==null?void 0:r.settings)==null?void 0:d.preset)||"vanilla",enableWYSIWYG:(u=(h=i==null?void 0:i.enableWYSIWYG)!=null?h:(f=r==null?void 0:r.settings)==null?void 0:f.enableWYSIWYG)!=null?u:!1,enabledPlugins:(i==null?void 0:i.enabledPlugins)||((g=r==null?void 0:r.settings)==null?void 0:g.enabledPlugins)||[],disabledPlugins:(i==null?void 0:i.disabledPlugins)||((y=r==null?void 0:r.settings)==null?void 0:y.disabledPlugins)||[],theme:(i==null?void 0:i.theme)||((P=r==null?void 0:r.settings)==null?void 0:P.theme)||"",basesCMSConfig:(i==null?void 0:i.basesCMSConfig)||((b=r==null?void 0:r.settings)==null?void 0:b.basesCMSConfig)||{views:[]},astroComposerConfig:(i==null?void 0:i.astroComposerConfig)||((m=r==null?void 0:r.settings)==null?void 0:m.astroComposerConfig)||{customContentTypes:[],defaultTemplate:"",configFilePath:"",terminalProjectRootPath:""},seoConfig:(i==null?void 0:i.seoConfig)||((v=r==null?void 0:r.settings)==null?void 0:v.seoConfig)||{titleProperty:"title",scanDirectories:"",useFilenameAsTitle:!1,useFilenameAsSlug:!0},commanderConfig:(i==null?void 0:i.commanderConfig)||((x=r==null?void 0:r.settings)==null?void 0:x.commanderConfig)||{pageHeaderCommands:[]},propertyOverFileName:(i==null?void 0:i.propertyOverFileName)||((F=r==null?void 0:r.settings)==null?void 0:F.propertyOverFileName)||{propertyKey:"title"},imageInserter:(i==null?void 0:i.imageInserter)||((I=r==null?void 0:r.settings)==null?void 0:I.imageInserter)||{valueFormat:"[[attachments/{image-url}]]",insertFormat:"[[attachments/{image-url}]]"},...i},this.steps=[ye,ve,Pe,we,Ie,ke,je,Me,Le,Re,Ge]}onOpen(){let{contentEl:n}=this;n.empty(),this.displayCurrentStep().catch(i=>{console.error("Error displaying wizard step:",i)})}onClose(){let{contentEl:n}=this;n.empty()}async displayCurrentStep(){let{contentEl:n}=this;if(n.empty(),this.currentStepIndex>=this.steps.length){this.close();return}let i=this.steps[this.currentStepIndex],r=i.name||"Unknown";console.log(`SetupWizardModal: Displaying step ${this.currentStepIndex+1}/${this.steps.length}: ${r}`),this.currentStepInstance=new i(this.app,n,this.state,()=>this.nextStep(),()=>this.previousStep(),()=>this.close()),await this.currentStepInstance.display(),this.state.currentStep=this.currentStepIndex;let o=n.createDiv({cls:"wizard-footer"}).createDiv({cls:"wizard-buttons"});if(o.style.display="flex",o.style.gap="10px",this.currentStepIndex>0&&o.createEl("button",{text:"Previous",cls:"mod-button"}).addEventListener("click",async()=>{await this.previousStep()}),this.currentStepIndex<this.steps.length-1){o.createEl("button",{text:"Next",cls:"mod-button mod-cta"}).addEventListener("click",async()=>{this.currentStepInstance&&this.currentStepInstance.validate()&&(await this.saveCurrentStepState(),await this.nextStep())});let l=o.createEl("button",{text:"Skip",cls:"mod-button"});l.style.opacity="0.6",l.addEventListener("click",async()=>{await this.nextStep()})}else o.createEl("button",{text:"Complete Setup",cls:"mod-button mod-cta"}).addEventListener("click",async()=>{this.currentStepInstance&&this.currentStepInstance.validate()&&(await this.saveStateIfNeeded(),this.close())})}async nextStep(){this.currentStepIndex<this.steps.length-1?(this.currentStepIndex++,await this.displayCurrentStep()):(await this.saveStateIfNeeded(),this.close())}async saveCurrentStepState(){var n,i;try{this.saveCallback&&this.pluginInstance&&(this.pluginInstance.settings.projectRoot=((n=this.state.projectDetection)==null?void 0:n.projectRoot)||"",this.pluginInstance.settings.configFilePath=((i=this.state.projectDetection)==null?void 0:i.configFilePath)||"",this.pluginInstance.settings.contentTypes=this.state.contentTypes,this.pluginInstance.settings.frontmatterProperties=this.state.frontmatterProperties,this.pluginInstance.settings.defaultContentTypeId=this.state.defaultContentTypeId,this.pluginInstance.settings.preset=this.state.preset,this.pluginInstance.settings.enableWYSIWYG=this.state.enableWYSIWYG,this.pluginInstance.settings.enabledPlugins=this.state.enabledPlugins,this.pluginInstance.settings.disabledPlugins=this.state.disabledPlugins,this.pluginInstance.settings.theme=this.state.theme,this.pluginInstance.settings.basesCMSConfig=this.state.basesCMSConfig,this.pluginInstance.settings.astroComposerConfig=this.state.astroComposerConfig,this.pluginInstance.settings.seoConfig=this.state.seoConfig,this.pluginInstance.settings.commanderConfig=this.state.commanderConfig,this.pluginInstance.settings.propertyOverFileName=this.state.propertyOverFileName,this.pluginInstance.settings.imageInserter=this.state.imageInserter,await this.pluginInstance.saveSettings())}catch(r){console.error("Error saving current step state:",r)}}async previousStep(){this.currentStepIndex>0&&(this.currentStepIndex--,await this.displayCurrentStep())}getState(){return this.state}setSaveCallback(n){this.saveCallback=n}async saveStateIfNeeded(){this.saveCallback&&this.currentStepIndex===this.steps.length-1&&await this.saveCallback(this.state)}};var qe=class extends ge.PluginSettingTab{constructor(n,i){super(n,i);this.plugin=i}display(){let{containerEl:n}=this;n.empty(),new ge.Setting(n).setName("Open Setup Wizard").setDesc("Launch the setup wizard to configure Vault CMS").addButton(i=>i.setButtonText("Open Wizard").setCta().onClick(()=>{new q(this.app,this.plugin.settings,this.plugin).open()})),new ge.Setting(n).setName("Run Wizard on Startup").setDesc("Automatically open the wizard when the plugin loads").addToggle(i=>i.setValue(this.plugin.settings.runWizardOnStartup).onChange(async r=>{this.plugin.settings.runWizardOnStartup=r,await this.plugin.saveSettings()}))}};function ln(e){e.addCommand({id:"vault-cms-open-wizard",name:"Open Setup Wizard",callback:()=>{let t=new q(e.app,e.settings,e);t.setSaveCallback(async n=>{var i,r;e.settings.projectRoot=((i=n.projectDetection)==null?void 0:i.projectRoot)||"",e.settings.configFilePath=((r=n.projectDetection)==null?void 0:r.configFilePath)||"",e.settings.contentTypes=n.contentTypes,e.settings.frontmatterProperties=n.frontmatterProperties,e.settings.defaultContentTypeId=n.defaultContentTypeId,e.settings.preset=n.preset,e.settings.enableWYSIWYG=n.enableWYSIWYG,e.settings.enabledPlugins=n.enabledPlugins,e.settings.disabledPlugins=n.disabledPlugins,e.settings.theme=n.theme,e.settings.basesCMSConfig=n.basesCMSConfig,e.settings.astroComposerConfig=n.astroComposerConfig,e.settings.seoConfig=n.seoConfig,e.settings.commanderConfig=n.commanderConfig,e.settings.propertyOverFileName=n.propertyOverFileName,e.settings.imageInserter=n.imageInserter,e.settings.wizardCompleted=!0,await e.saveSettings()}),t.open()}})}var Ke=class extends cn.Plugin{async onload(){await this.loadSettings(),ln(this),this.addSettingTab(new qe(this.app,this)),this.settings.runWizardOnStartup&&this.app.workspace.onLayoutReady(()=>{this.startupTimeoutId=window.setTimeout(async()=>{if(await this.loadSettings(),this.settings.runWizardOnStartup){let n=new q(this.app,this.settings,this);n.setSaveCallback(async i=>{var r,s;this.settings.projectRoot=((r=i.projectDetection)==null?void 0:r.projectRoot)||"",this.settings.configFilePath=((s=i.projectDetection)==null?void 0:s.configFilePath)||"",this.settings.contentTypes=i.contentTypes,this.settings.frontmatterProperties=i.frontmatterProperties,this.settings.defaultContentTypeId=i.defaultContentTypeId,this.settings.preset=i.preset,this.settings.enableWYSIWYG=i.enableWYSIWYG,this.settings.enabledPlugins=i.enabledPlugins,this.settings.disabledPlugins=i.disabledPlugins,this.settings.theme=i.theme,this.settings.basesCMSConfig=i.basesCMSConfig,this.settings.astroComposerConfig=i.astroComposerConfig,this.settings.seoConfig=i.seoConfig,this.settings.commanderConfig=i.commanderConfig,this.settings.propertyOverFileName=i.propertyOverFileName,this.settings.imageInserter=i.imageInserter,this.settings.wizardCompleted=!0,await this.saveSettings()}),n.open()}},2e3)})}onunload(){this.startupTimeoutId&&window.clearTimeout(this.startupTimeoutId)}async loadSettings(){this.settings=Object.assign({},ht,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.1 https://github.com/nodeca/js-yaml @license MIT *)
*/
