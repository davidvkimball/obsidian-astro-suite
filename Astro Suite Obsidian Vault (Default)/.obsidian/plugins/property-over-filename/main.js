/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var I=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var Q=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var A=(u,p)=>{for(var e in p)I(u,e,{get:p[e],enumerable:!0})},N=(u,p,e,i)=>{if(p&&typeof p=="object"||typeof p=="function")for(let t of Q(p))!P.call(u,t)&&t!==e&&I(u,t,{get:()=>p[t],enumerable:!(i=E(p,t))||i.enumerable});return u};var R=u=>N(I({},"__esModule",{value:!0}),u);var z={};A(z,{default:()=>b});module.exports=R(z);var g=require("obsidian");var D={propertyKey:"title",enableForLinking:!0,enableForQuickSwitcher:!0,includeFilenameInSearch:!0,includeAliasesInSearch:!0,enableForDragDrop:!0};var k=require("obsidian");function y(u,p){let e=0,i=u.toLowerCase(),t=p.toLowerCase();for(let n of t)if(e=i.indexOf(n,e)+1,e===0)return!1;return!0}function M(u,p,e,i){let t=0,n=u.toLowerCase(),s=e.toLowerCase(),o=p.toLowerCase();n===o?t+=1e3:s===o?t+=900:n.startsWith(o)?t+=100:i&&s.startsWith(o)?t+=80:n.includes(o)?t+=50:i&&s.includes(o)&&(t+=30);let a=new RegExp(`\\b${o}`,"i");a.test(n)&&(t+=20),i&&a.test(s)&&(t+=15);let l=Math.max(0,(u.length-p.length)*.1);return t-=l,Math.max(0,t)}function S(u,p,e){let i=new Map;return u.forEach(t=>{let n=p.getFileCache(t),s=n==null?void 0:n.frontmatter,o=t.basename,a=!1,l=[];if(s&&s[e]!==void 0&&s[e]!==null){let r=String(s[e]).trim();r!==""&&(o=r,a=!0)}s!=null&&s.aliases&&(l=Array.isArray(s.aliases)?s.aliases:[s.aliases],l=l.map(r=>String(r).trim()).filter(r=>r!=="")),i.set(t.path,{file:t,displayName:o,aliases:l,lastModified:t.stat.mtime,isCustomDisplay:a})}),i}var F=class extends k.EditorSuggest{constructor(e){super(e.app);this.fileCache=new Map;this.searchTimeout=null;this.matchReasons=new Map;this.plugin=e,this.buildFileCache()}open(){super.open();let e=this.suggestEl;if(e&&(e.addClass("property-over-filename-suggestion"),!e.querySelector(".prompt-instructions"))){let i=e.createDiv({cls:"prompt-instructions"});i.createDiv({cls:"prompt-instruction"}).setText("Type # to link heading"),i.createDiv({cls:"prompt-instruction"}).setText("Type ^ to link blocks"),i.createDiv({cls:"prompt-instruction"}).setText("Type | to change display text")}this.addKeyboardNavigation()}addKeyboardNavigation(){let e=this.suggestEl;e&&e.addEventListener("keydown",i=>{i.key==="Escape"&&(this.close(),i.preventDefault(),i.stopPropagation())})}onTrigger(e,i,t){if(!this.plugin.settings.enableForLinking)return null;let n=i.getLine(e.line).substring(0,e.ch),s=/\[\[([^#^|\]]*)$/.exec(n);return s?{start:{line:e.line,ch:n.lastIndexOf("[[")},end:e,query:s[1]}:null}buildFileCache(){this.fileCache=S(this.app.vault.getMarkdownFiles(),this.app.metadataCache,this.plugin.settings.propertyKey)}updateFileCache(e){let i=this.app.metadataCache.getFileCache(e),t=i==null?void 0:i.frontmatter,n=e.basename,s=!1,o=[];if(t&&t[this.plugin.settings.propertyKey]!==void 0&&t[this.plugin.settings.propertyKey]!==null){let a=String(t[this.plugin.settings.propertyKey]).trim();a!==""&&(n=a,s=!0)}t!=null&&t.aliases&&(o=Array.isArray(t.aliases)?t.aliases:[t.aliases],o=o.map(a=>String(a).trim()).filter(a=>a!=="")),this.fileCache.set(e.path,{file:e,displayName:n,aliases:o,lastModified:e.stat.mtime,isCustomDisplay:s})}getSuggestions(e){let i=e.query.trim();return this.performSearch(i)}performSearch(e){let i=[],t=new Set;this.matchReasons.clear();for(let n of this.fileCache.values()){let{file:s,displayName:o,aliases:a,isCustomDisplay:l}=n,r={matchedInTitle:!1,matchedInFilename:!1,matchedInAlias:!1},c=!1;(!e||y(o,e))&&(c=!0,r.matchedInTitle=!0),this.plugin.settings.includeFilenameInSearch&&s.basename!==o&&y(s.basename,e)&&(c=!0,r.matchedInFilename=!0),this.plugin.settings.includeAliasesInSearch&&a.length>0&&a.some(m=>y(m,e))&&(c=!0,r.matchedInAlias=!0),c&&(i.push({file:s,display:o,isCustomDisplay:l}),t.add(s.basename.toLowerCase()),this.matchReasons.set(s.path,r))}return i.length===0&&e&&i.push({display:"No match found",isCustomDisplay:!1,isNoMatch:!0}),this.sortSuggestions(i,e)}sortSuggestions(e,i){return e.sort((t,n)=>{var a,l,r,c;let s=M(t.display,i,(l=(a=t.file)==null?void 0:a.basename)!=null?l:"",this.plugin.settings.includeFilenameInSearch);return M(n.display,i,(c=(r=n.file)==null?void 0:r.basename)!=null?c:"",this.plugin.settings.includeFilenameInSearch)-s||t.display.localeCompare(n.display)})}renderSuggestion(e,i){if(i.empty(),e.isNoMatch){i.setText(e.display);return}if(e.file){let t=this.matchReasons.get(e.file.path);if(t&&(t.matchedInTitle||t.matchedInFilename||t.matchedInAlias)){i.addClass("mod-complex");let s=i.createDiv({cls:"suggestion-content"});s.createDiv({cls:"suggestion-title"}).setText(e.display),s.createDiv({cls:"suggestion-note"}).setText(e.file.path.replace(".md",""));let r=i.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":this.getIconLabel(t)}});t.matchedInTitle?r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-type"><polyline points="4 7 4 4 20 4 20 7"></polyline><line x1="9" y1="20" x2="15" y2="20"></line><line x1="12" y1="4" x2="12" y2="20"></line></svg>':t.matchedInFilename?r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-file-text"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14,2 14,8 20,8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10,9 9,9 8,9"></polyline></svg>':t.matchedInAlias&&(r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-forward"><polyline points="15 17 20 12 15 7"></polyline><path d="M4 18v-2a4 4 0 0 1 4-4h12"></path></svg>')}else{let s=i.createDiv({cls:"suggestion-content"});s.createDiv({cls:"suggestion-title",text:e.display}),s.createDiv({cls:"suggestion-note",text:e.file.path.replace(".md","")})}}}getIconLabel(e){return e.matchedInTitle?"Title/Property Match":e.matchedInFilename?"Filename Match":e.matchedInAlias?"Alias Match":"Match"}isUsingCustomProperty(e){let i=this.app.metadataCache.getFileCache(e),t=i==null?void 0:i.frontmatter,n=t==null?void 0:t[this.plugin.settings.propertyKey];return n!=null&&String(n).trim()!==""}isUsingAlias(e){let i=this.app.metadataCache.getFileCache(e),t=i==null?void 0:i.frontmatter,n=t==null?void 0:t.aliases;return n?!this.isUsingCustomProperty(e)&&n:!1}async selectSuggestion(e,i){var m;if(e.isNoMatch)return;let t=this.app.workspace.getActiveViewOfType(k.MarkdownView);if(!t||!this.context)return;let n=t.editor,{start:s,end:o}=this.context,a=n.getLine(s.line),l=o;a.slice(o.ch,o.ch+2)==="]]"&&(l={line:o.line,ch:o.ch+2});let r=(m=this.app.vault.getConfig("useMarkdownLinks"))!=null?m:!1,c;r?c=`[${e.display}](${encodeURI(e.file.path)})`:c=`[[${e.file.basename}|${e.display}]]`,n.replaceRange(c,{line:s.line,ch:s.ch},l);let h=s.ch+c.length;try{n.setCursor({line:s.line,ch:h})}catch(w){console.error("Error setting cursor:",w),new k.Notice("Error setting cursor position. Please check console for details.")}}};var d=require("obsidian");var v=class extends d.FuzzySuggestModal{constructor(e,i){super(e);this.fileCache=new Map;this.recentFiles=[];this.searchTimeout=null;this.matchReasons=new Map;this.plugin=i,this.limit=10,this.plugin.settings.enableForQuickSwitcher?this.setPlaceholder("Type to search notes by title or filename..."):this.setPlaceholder("Type to search files..."),this.buildFileCache(),this.updateRecentFiles(),this.addKeyboardNavigation(),this.addFooter(),this.plugin.settings.enableForQuickSwitcher&&this.containerEl.addClass("property-over-filename-modal")}addKeyboardNavigation(){this.inputEl.addEventListener("keydown",e=>{e.key==="Escape"&&(this.close(),e.preventDefault(),e.stopPropagation())})}addFooter(){let e=this.containerEl.querySelector(".prompt");if(e){let i=e.createDiv({cls:"prompt-instructions"});i.innerHTML='<div class="prompt-instruction"><span class="prompt-instruction-command">\u2191\u2193</span><span>to navigate</span></div><div class="prompt-instruction"><span class="prompt-instruction-command">\u21B5</span><span>to open</span></div><div class="prompt-instruction"><span class="prompt-instruction-command">ctrl \u21B5</span><span>to open in new tab</span></div><div class="prompt-instruction"><span class="prompt-instruction-command">ctrl alt \u21B5</span><span>to open to the right</span></div><div class="prompt-instruction"><span class="prompt-instruction-command">shift \u21B5</span><span>to create</span></div><div class="prompt-instruction"><span class="prompt-instruction-command">esc</span><span>to dismiss</span></div>'}}buildFileCache(){this.fileCache=S(this.app.vault.getMarkdownFiles(),this.app.metadataCache,this.plugin.settings.propertyKey)}updateFileCache(e){let i=this.app.metadataCache.getFileCache(e),t=i==null?void 0:i.frontmatter,n=e.basename,s=!1,o=[];if(t&&t[this.plugin.settings.propertyKey]!==void 0&&t[this.plugin.settings.propertyKey]!==null){let a=String(t[this.plugin.settings.propertyKey]).trim();a!==""&&(n=a,s=!0)}t!=null&&t.aliases&&(o=Array.isArray(t.aliases)?t.aliases:[t.aliases],o=o.map(a=>String(a).trim()).filter(a=>a!=="")),this.fileCache.set(e.path,{file:e,displayName:n,aliases:o,lastModified:e.stat.mtime,isCustomDisplay:s})}updateRecentFiles(){var t;let e=[],i=this.app.workspace;if((t=i.recentFileTracker)!=null&&t.getLastOpenFiles&&(e=i.recentFileTracker.getLastOpenFiles().map(s=>this.app.vault.getAbstractFileByPath(s)).filter(s=>s instanceof d.TFile).slice(0,10)),e.length===0){if(e=[...this.app.workspace.getLeavesOfType("markdown").map(s=>s.view).filter(s=>s instanceof d.MarkdownView).map(s=>s.file).filter(s=>s!==null).filter((s,o,a)=>a.indexOf(s)===o)],e.length<10){let s=this.app.vault.getMarkdownFiles(),o=10-e.length,a=s.filter(l=>!e.includes(l)).slice(0,o);e.push(...a)}e=e.slice(0,10)}this.recentFiles=e}getItems(){return this.app.vault.getMarkdownFiles()}getItemText(e){return"isNewNote"in e?e.newName:this.plugin.settings.enableForQuickSwitcher?this.getDisplayName(e):e.basename}getDisplayName(e){let i=this.app.metadataCache.getFileCache(e),t=i==null?void 0:i.frontmatter,n=t==null?void 0:t[this.plugin.settings.propertyKey];if(n!=null){let s=String(n).trim();if(s!=="")return s}return e.basename}getSuggestions(e){var t;if(!this.plugin.settings.enableForQuickSwitcher){let n=e.trim();if(!n)return this.getRecentFilesResults();let s=this.app.vault.getMarkdownFiles(),o=(0,d.prepareFuzzySearch)(n),a=[];for(let l of s){let r=(t=o(l.basename))!=null?t:{score:0,matches:[]};r.matches.length>0&&a.push({item:l,match:r})}return a.sort((l,r)=>{let c=r.match.score-l.match.score;return c!==0?c:l.item instanceof d.TFile&&r.item instanceof d.TFile?l.item.basename.localeCompare(r.item.basename):0}),a.slice(0,this.limit)}let i=e.trim();return this.searchTimeout&&clearTimeout(this.searchTimeout),i?this.performSearch(i):this.getRecentFilesResults()}getRecentFilesResults(){return this.updateRecentFiles(),this.recentFiles.map(e=>({item:e,match:{score:1e3,matches:[]}}))}performSearch(e){var n;let i=(0,d.prepareFuzzySearch)(e),t=[];this.matchReasons.clear();for(let s of this.fileCache.values()){let{file:o,displayName:a,aliases:l}=s,r=this.getItemText(o),c=(n=i(r))!=null?n:{score:0,matches:[]},h={matchedInTitle:!1,matchedInFilename:!1,matchedInAlias:!1};c.matches.length>0&&(h.matchedInTitle=!0),this.plugin.settings.includeFilenameInSearch&&o.basename!==a&&y(o.basename,e)&&(h.matchedInFilename=!0);let m=!1;this.plugin.settings.includeAliasesInSearch&&l.length>0&&(m=l.some(w=>y(w,e)),m&&(h.matchedInAlias=!0)),(c.matches.length>0||m)&&(t.push({item:o,match:c.matches.length>0?c:{score:-.1,matches:[[0,e.length]]}}),this.matchReasons.set(o.path,h))}try{t.sort((a,l)=>{let r=l.match.score-a.match.score;return r!==0?r:this.getItemText(a.item).localeCompare(this.getItemText(l.item))});let s=e.toLowerCase(),o=t.some(a=>{var l;return a.item instanceof d.TFile&&(this.getDisplayName(a.item).toLowerCase()===s||this.plugin.settings.includeFilenameInSearch&&a.item.basename.toLowerCase()===s||this.plugin.settings.includeAliasesInSearch&&((l=this.fileCache.get(a.item.path))==null?void 0:l.aliases.some(r=>r.toLowerCase()===s)))});if(t.length===0){let a={isNewNote:!0,newName:e};t.push({item:a,match:{score:1e3,matches:[[0,e.length]]}})}return t.slice(0,this.limit)}catch(s){return console.error("Error generating suggestions:",s),new d.Notice("Error updating Quick Switcher suggestions. Please check console for details."),[]}}renderSuggestion(e,i){let{item:t}=e,n=this.getItemText(t);if("isNewNote"in t){i.empty(),i.addClass("mod-complex"),i.createDiv({cls:"suggestion-content"}).createDiv({cls:"suggestion-title"}).setText(n),i.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-action"}).setText("Enter to create");return}if(!this.plugin.settings.enableForQuickSwitcher)t instanceof d.TFile?i.setText(t.path.replace(".md","")):i.setText(n);else{let s=this.matchReasons.get(t.path);if(s&&(s.matchedInTitle||s.matchedInFilename||s.matchedInAlias)){i.addClass("mod-complex");let a=i.createDiv({cls:"suggestion-content"});a.createDiv({cls:"suggestion-title"}).setText(n),t instanceof d.TFile&&a.createDiv({cls:"suggestion-note"}).setText(t.path.replace(".md",""));let c=i.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":this.getIconLabel(s)}});s.matchedInTitle?c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-type"><polyline points="4 7 4 4 20 4 20 7"></polyline><line x1="9" y1="20" x2="15" y2="20"></line><line x1="12" y1="4" x2="12" y2="20"></line></svg>':s.matchedInFilename?c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-file-text"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14,2 14,8 20,8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10,9 9,9 8,9"></polyline></svg>':s.matchedInAlias&&(c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-forward"><polyline points="15 17 20 12 15 7"></polyline><path d="M4 18v-2a4 4 0 0 1 4-4h12"></path></svg>')}else t instanceof d.TFile?i.setText(t.path.replace(".md","")):i.setText(n)}}getIconLabel(e){return e.matchedInTitle?"Title/Property Match":e.matchedInFilename?"Filename Match":e.matchedInAlias?"Alias Match":"Match"}isUsingCustomProperty(e){let i=this.app.metadataCache.getFileCache(e),t=i==null?void 0:i.frontmatter,n=t==null?void 0:t[this.plugin.settings.propertyKey];return n!=null&&String(n).trim()!==""}isUsingAlias(e){let i=this.app.metadataCache.getFileCache(e),t=i==null?void 0:i.frontmatter,n=t==null?void 0:t.aliases;return n?!this.isUsingCustomProperty(e)&&n:!1}onChooseItem(e,i){"isNewNote"in e?this.app.vault.create(`${e.newName}.md`,"").then(t=>{this.app.workspace.getLeaf().openFile(t)}).catch(t=>{new d.Notice(`Error creating note: ${t.message}`)}):i instanceof KeyboardEvent?i.ctrlKey&&i.altKey?(this.app.workspace.splitActiveLeaf("horizontal"),this.app.workspace.getLeaf().openFile(e)):i.ctrlKey?this.app.workspace.getLeaf().openFile(e):i.shiftKey?this.app.workspace.getLeaf().openFile(e):this.app.workspace.getLeaf().openFile(e):this.app.workspace.getLeaf().openFile(e)}};var f=require("obsidian"),C=class extends f.PluginSettingTab{constructor(e,i){super(e,i);this.plugin=i}display(){let{containerEl:e}=this;e.empty(),e.addClass("property-over-filename-settings"),new f.Setting(e).setName("Property key").setDesc("The property to use as the display title.").addText(i=>i.setPlaceholder("title").setValue(this.plugin.settings.propertyKey).onChange(async t=>{this.plugin.settings.propertyKey=t.trim()||"title",await this.plugin.saveData(this.plugin.settings),this.plugin.updateLinkSuggester()})),new f.Setting(e).setName("When linking notes").setDesc("Enable property-based titles in the link suggester.").addToggle(i=>i.setValue(this.plugin.settings.enableForLinking).onChange(async t=>{this.plugin.settings.enableForLinking=t,await this.plugin.saveData(this.plugin.settings),this.plugin.updateLinkSuggester()})),new f.Setting(e).setName("In Quick Switcher").setDesc("Enable property-based titles in the quick switcher.").addToggle(i=>i.setValue(this.plugin.settings.enableForQuickSwitcher).onChange(async t=>{let n=this.plugin.settings.enableForQuickSwitcher;this.plugin.settings.enableForQuickSwitcher=t,await this.plugin.saveSettings(n)})),new f.Setting(e).setName("Include filename in fuzzy searches").setDesc("Include note filenames in fuzzy search results for link suggester and quick switcher.").addToggle(i=>i.setValue(this.plugin.settings.includeFilenameInSearch).onChange(async t=>{this.plugin.settings.includeFilenameInSearch=t,await this.plugin.saveData(this.plugin.settings)})),new f.Setting(e).setName("Include aliases in fuzzy searches").setDesc("Include property aliases in fuzzy search results for link suggester and quick switcher.").addToggle(i=>i.setValue(this.plugin.settings.includeAliasesInSearch).onChange(async t=>{this.plugin.settings.includeAliasesInSearch=t,await this.plugin.saveData(this.plugin.settings)})),new f.Setting(e).setName("When dragging notes").setDesc("Use property-based titles when dragging notes from the file explorer.").addToggle(i=>i.setValue(this.plugin.settings.enableForDragDrop).onChange(async t=>{this.plugin.settings.enableForDragDrop=t,await this.plugin.saveData(this.plugin.settings)}))}};var b=class extends g.Plugin{constructor(){super(...arguments);this.isCommandOverridden=!1}async onload(){await this.loadSettings(),setTimeout(()=>{this.updateLinkSuggester(),this.updateQuickSwitcher()},1e3),this.registerEvent(this.app.vault.on("modify",e=>{e instanceof g.TFile&&e.extension==="md"&&this.invalidateCache(e)})),this.registerEvent(this.app.vault.on("rename",(e,i)=>{e instanceof g.TFile&&e.extension==="md"&&this.invalidateCache(e)})),this.registerEvent(this.app.vault.on("delete",e=>{e instanceof g.TFile&&e.extension==="md"&&this.invalidateCache(e)})),this.registerEvent(this.app.metadataCache.on("changed",e=>{e instanceof g.TFile&&e.extension==="md"&&this.rebuildCache()})),this.registerEvent(this.app.metadataCache.on("resolved",()=>{this.rebuildCache()})),this.registerEvent(this.app.workspace.on("editor-drop",(e,i)=>{this.settings.enableForDragDrop&&this.handleDragDrop(e,i)})),this.registerDomEvent(document,"drop",e=>{this.settings.enableForDragDrop&&this.handleDOMDrop(e)}),g.Platform.isMobile&&this.registerEvent(this.app.workspace.on("quick-preview",(e,i)=>{if(this.settings.enableForQuickSwitcher)return new v(this.app,this).open(),!1})),this.addCommand({id:"open-quick-switcher",name:"Open Quick Switcher (Property-based)",callback:()=>{new v(this.app,this).open()}}),this.addCommand({id:"toggle-linking",name:"Toggle property-based linking",callback:async()=>{this.settings.enableForLinking=!this.settings.enableForLinking,await this.saveData(this.settings),this.updateLinkSuggester(),new g.Notice(`Property-based linking ${this.settings.enableForLinking?"enabled":"disabled"}`)}}),this.addCommand({id:"toggle-quick-switcher",name:"Toggle property-based Quick Switcher",callback:async()=>{let e=this.settings.enableForQuickSwitcher;this.settings.enableForQuickSwitcher=!this.settings.enableForQuickSwitcher,await this.saveSettings(e),new g.Notice(`Property-based Quick Switcher ${this.settings.enableForQuickSwitcher?"enabled":"disabled"}`)}}),this.addCommand({id:"rebuild-cache",name:"Rebuild file cache",callback:()=>{this.rebuildCache(),new g.Notice("File cache rebuilt")}}),this.addCommand({id:"toggle-drag-drop",name:"Toggle property-based drag and drop",callback:async()=>{this.settings.enableForDragDrop=!this.settings.enableForDragDrop,await this.saveData(this.settings),new g.Notice(`Property-based drag and drop ${this.settings.enableForDragDrop?"enabled":"disabled"}`)}}),this.addSettingTab(new C(this.app,this))}invalidateCache(e){this.suggest&&this.suggest.updateFileCache(e)}rebuildCache(){this.suggest&&this.suggest.buildFileCache()}handleDragDrop(e,i){if(!e.dataTransfer||!e.dataTransfer.files.length)return;let t=e.dataTransfer.getData("text/plain");if(!t||!t.endsWith(".md"))return;let n=this.app.vault.getAbstractFileByPath(t);if(!n||!(n instanceof g.TFile))return;let s=this.app.metadataCache.getFileCache(n),o=s==null?void 0:s.frontmatter,a=n.basename;if(o&&o[this.settings.propertyKey]!==void 0&&o[this.settings.propertyKey]!==null){let l=String(o[this.settings.propertyKey]).trim();l!==""&&(a=l)}setTimeout(()=>{this.replaceLastInsertedLink(n,a,i)},50)}handleDOMDrop(e){var r;let i=e.target;if(!i||!i.closest(".cm-editor"))return;let t=(r=e.dataTransfer)==null?void 0:r.getData("text/plain");if(!t)return;let n=t;if(t.startsWith("obsidian://open?")){let h=new URL(t).searchParams.get("file");if(h)n=decodeURIComponent(h)+".md";else return}else if(!t.endsWith(".md"))return;let s=this.app.vault.getAbstractFileByPath(n);if(!s||!(s instanceof g.TFile))return;let o=this.app.metadataCache.getFileCache(s),a=o==null?void 0:o.frontmatter,l=s.basename;if(a&&a[this.settings.propertyKey]!==void 0&&a[this.settings.propertyKey]!==null){let c=String(a[this.settings.propertyKey]).trim();c!==""&&(l=c)}setTimeout(()=>{let c=this.app.workspace.getActiveViewOfType(g.MarkdownView);c&&c.editor&&this.replaceLastInsertedLink(s,l,c.editor)},50)}replaceLastInsertedLink(e,i,t){let n=t.getValue(),s=t.getCursor(),a=n.split(`
`)[s.line],l=/\[\[([^\]]+)\]\]/g,r=/\[([^\]]+)\]\(([^)]+)\)/g,c,h=null;for(;(c=l.exec(a))!==null;)h=c;if(h){let w=`[[${h[1]}|${i}]]`,T={line:s.line,ch:h.index},x={line:s.line,ch:h.index+h[0].length};t.replaceRange(w,T,x);return}for(r.lastIndex=0;(c=r.exec(a))!==null;)h=c;if(h){let m=h[1],w=h[2],T=`[${i}](${w})`,x={line:s.line,ch:h.index},L={line:s.line,ch:h.index+h[0].length};t.replaceRange(T,x,L)}}updateLinkSuggester(){let e=this.app.workspace.editorSuggest;e&&(this.suggest&&(e.suggests=e.suggests.filter(i=>i!==this.suggest),this.suggest=void 0),this.settings.enableForLinking&&(this.suggest=new F(this),this.registerEditorSuggest(this.suggest),e.suggests=e.suggests.filter(i=>!i.constructor.name.includes("LinkSuggest")),e.suggests.unshift(this.suggest)))}updateQuickSwitcher(){this.isCommandOverridden||this.overrideQuickSwitcherCommand()}overrideQuickSwitcherCommand(){let e=this.app.commands.commands;if(e["switcher:open"]&&!this.originalSwitcherCommand){let i=e["switcher:open"];this.originalSwitcherCommand={id:i.id,name:i.name,icon:i.icon,hotkeys:i.hotkeys?[...i.hotkeys]:[],callback:i.callback}}e["switcher:open"]&&delete e["switcher:open"],this.addCommand({id:"switcher:open",name:"Quick Switcher",hotkeys:[{modifiers:["Mod"],key:"o"}],callback:()=>{this.settings.enableForQuickSwitcher?(document.querySelectorAll(".modal").forEach(t=>{t instanceof HTMLElement&&t.style.display!=="none"&&(t.style.display="none")}),new v(this.app,this).open()):this.originalSwitcherCommand&&this.originalSwitcherCommand.callback?this.originalSwitcherCommand.callback():this.app.commands.executeCommandById("switcher:open")}}),this.isCommandOverridden=!0}restoreOriginalCommand(){if(!this.originalSwitcherCommand)return;let e=this.app.commands.commands;e["switcher:open"]&&delete e["switcher:open"],e["switcher:open"]={id:this.originalSwitcherCommand.id,name:this.originalSwitcherCommand.name,icon:this.originalSwitcherCommand.icon,hotkeys:this.originalSwitcherCommand.hotkeys,callback:this.originalSwitcherCommand.callback},this.isCommandOverridden=!1}openDefaultQuickSwitcher(){var e;console.log("=== OPENING DEFAULT QUICK SWITCHER ===");try{let i=this.app.internalPlugins,t=(e=i==null?void 0:i.plugins)==null?void 0:e.switcher;if(t!=null&&t.instance){console.log("Found quick-switcher plugin instance");let o=t.instance;if(o.QuickSwitcherModal){console.log("Creating QuickSwitcherModal instance");let a=o.QuickSwitcherModal,l=[()=>new a(this.app,!1),()=>new a(this.app,!0),()=>new a(this.app,!1,!1),()=>new a(this.app,!0,!1),()=>new a(this.app)];for(let r=0;r<l.length;r++)try{console.log(`Trying constructor signature ${r+1}`),l[r]().open(),console.log(`QuickSwitcherModal opened successfully with signature ${r+1}`);return}catch(c){console.log(`Constructor signature ${r+1} failed:`,c.message)}}if(typeof o.openQuickSwitcher=="function"){console.log("Trying instance.openQuickSwitcher"),o.openQuickSwitcher();return}if(typeof o.open=="function"){console.log("Trying instance.open"),o.open();return}}let n=this.app.workspace;if(typeof n.openQuickSwitcher=="function"){console.log("Using workspace.openQuickSwitcher"),n.openQuickSwitcher();return}console.log("Trying to find QuickSwitcherModal in global scope");let s=window;if(s.QuickSwitcherModal)try{new s.QuickSwitcherModal(this.app,!1).open(),console.log("Global QuickSwitcherModal opened successfully");return}catch(o){console.log("Global QuickSwitcherModal failed:",o.message)}console.log("Falling back to command palette"),this.app.commands.executeCommandById("app:open-quick-switcher")}catch(i){console.error("Error opening default Quick Switcher:",i),new g.Notice("Error opening Quick Switcher. Please check console for details.")}}onunload(){let e=this.app.workspace.editorSuggest;e&&this.suggest&&(e.suggests=e.suggests.filter(i=>i!==this.suggest)),this.isCommandOverridden&&this.restoreOriginalCommand()}async loadSettings(){this.settings=Object.assign({},D,await this.loadData())}async saveSettings(e){await this.saveData(this.settings),e!==void 0&&e!==this.settings.enableForQuickSwitcher&&(console.log("Quick Switcher setting changed, updating command"),this.updateQuickSwitcher())}};
