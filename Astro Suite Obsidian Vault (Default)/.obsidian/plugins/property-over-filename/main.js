/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var x=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var Q=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var z=(p,g)=>{for(var e in g)x(p,e,{get:g[e],enumerable:!0})},A=(p,g,e,i)=>{if(g&&typeof g=="object"||typeof g=="function")for(let t of Q(g))!$.call(p,t)&&t!==e&&x(p,t,{get:()=>g[t],enumerable:!(i=P(g,t))||i.enumerable});return p};var K=p=>A(x({},"__esModule",{value:!0}),p);var V={};z(V,{default:()=>T});module.exports=K(V);var h=require("obsidian");var L={propertyKey:"title",enableForLinking:!0,enableForQuickSwitcher:!0,includeFilenameInSearch:!0,includeAliasesInSearch:!0,enableForDragDrop:!0};var k=require("obsidian");function S(p,g){let e=0,i=p.toLowerCase(),t=g.toLowerCase();for(let n of t)if(e=i.indexOf(n,e)+1,e===0)return!1;return!0}function E(p,g,e,i){let t=0,n=p.toLowerCase(),s=e.toLowerCase(),a=g.toLowerCase();n===a?t+=1e3:s===a?t+=900:n.startsWith(a)?t+=100:i&&s.startsWith(a)?t+=80:n.includes(a)?t+=50:i&&s.includes(a)&&(t+=30);let r=new RegExp(`\\b${a}`,"i");r.test(n)&&(t+=20),i&&r.test(s)&&(t+=15);let l=Math.max(0,(p.length-g.length)*.1);return t-=l,Math.max(0,t)}function F(p,g,e){let i=new Map;return p.forEach(t=>{let n=g.getFileCache(t),s=n==null?void 0:n.frontmatter,a=t.basename,r=!1,l=[];if(s&&s[e]!==void 0&&s[e]!==null){let o=String(s[e]).trim();o!==""&&(a=o,r=!0)}s!=null&&s.aliases&&(l=Array.isArray(s.aliases)?s.aliases:[s.aliases],l=l.map(o=>String(o).trim()).filter(o=>o!=="")),i.set(t.path,{file:t,displayName:a,aliases:l,lastModified:t.stat.mtime,isCustomDisplay:r})}),i}var C=class extends k.EditorSuggest{constructor(e){super(e.app);this.fileCache=new Map;this.searchTimeout=null;this.plugin=e,this.buildFileCache()}open(){super.open();let e=this.suggestEl;if(e&&!e.querySelector(".prompt-instructions")){let i=e.createDiv({cls:"prompt-instructions"});i.createDiv({cls:"prompt-instruction"}).setText("Type # to link heading"),i.createDiv({cls:"prompt-instruction"}).setText("Type ^ to link blocks"),i.createDiv({cls:"prompt-instruction"}).setText("Type | to change display text")}this.addKeyboardNavigation()}addKeyboardNavigation(){let e=this.suggestEl;e&&e.addEventListener("keydown",i=>{i.key==="Escape"&&(this.close(),i.preventDefault(),i.stopPropagation())})}onTrigger(e,i,t){if(!this.plugin.settings.enableForLinking)return null;let n=i.getLine(e.line).substring(0,e.ch),s=/\[\[([^#^|\]]*)$/.exec(n);return s?{start:{line:e.line,ch:n.lastIndexOf("[[")},end:e,query:s[1]}:null}buildFileCache(){this.fileCache=F(this.app.vault.getMarkdownFiles(),this.app.metadataCache,this.plugin.settings.propertyKey)}updateFileCache(e){let i=this.app.metadataCache.getFileCache(e),t=i==null?void 0:i.frontmatter,n=e.basename,s=!1,a=[];if(t&&t[this.plugin.settings.propertyKey]!==void 0&&t[this.plugin.settings.propertyKey]!==null){let r=String(t[this.plugin.settings.propertyKey]).trim();r!==""&&(n=r,s=!0)}t!=null&&t.aliases&&(a=Array.isArray(t.aliases)?t.aliases:[t.aliases],a=a.map(r=>String(r).trim()).filter(r=>r!=="")),this.fileCache.set(e.path,{file:e,displayName:n,aliases:a,lastModified:e.stat.mtime,isCustomDisplay:s})}getSuggestions(e){let i=e.query.trim();return this.performSearch(i)}performSearch(e){let i=[],t=new Set;for(let n of this.fileCache.values()){let{file:s,displayName:a,aliases:r,isCustomDisplay:l}=n,o=!e||S(a,e);this.plugin.settings.includeFilenameInSearch&&(o=o||S(s.basename,e)),this.plugin.settings.includeAliasesInSearch&&r.length>0&&(o=o||r.some(c=>S(c,e))),o&&(i.push({file:s,display:a,isCustomDisplay:l}),t.add(s.basename.toLowerCase()))}return e&&!t.has(e.toLowerCase())&&i.unshift({display:e,isCustomDisplay:!1,isNewNote:!0}),this.sortSuggestions(i,e)}sortSuggestions(e,i){return e.sort((t,n)=>{var r,l,o,c;let s=E(t.display,i,(l=(r=t.file)==null?void 0:r.basename)!=null?l:"",this.plugin.settings.includeFilenameInSearch),a=E(n.display,i,(c=(o=n.file)==null?void 0:o.basename)!=null?c:"",this.plugin.settings.includeFilenameInSearch);return t.isNewNote?-1:n.isNewNote?1:a-s||t.display.localeCompare(n.display)})}renderSuggestion(e,i){i.empty();let t=i.createDiv({cls:"suggestion-content"});t.createDiv({cls:"suggestion-title",text:e.display}),e.file&&t.createDiv({cls:"suggestion-note",text:e.file.path.replace(".md","")})}async selectSuggestion(e,i){var m;let t=this.app.workspace.getActiveViewOfType(k.MarkdownView);if(!t||!this.context)return;let n=t.editor,{start:s,end:a}=this.context,r=n.getLine(s.line),l=a;r.slice(a.ch,a.ch+2)==="]]"&&(l={line:a.line,ch:a.ch+2});let o=(m=this.app.vault.getConfig("useMarkdownLinks"))!=null?m:!1,c;if(e.isNewNote){let d=await this.app.vault.create(`${e.display}.md`,"");c=o?`[${e.display}](${encodeURI(d.path)})`:`[[${d.basename}]]`,this.app.workspace.activeLeaf&&await this.app.workspace.activeLeaf.openFile(d)}else o?c=`[${e.display}](${encodeURI(e.file.path)})`:c=`[[${e.file.basename}|${e.display}]]`;n.replaceRange(c,{line:s.line,ch:s.ch},l);let u=s.ch+c.length;try{n.setCursor({line:s.line,ch:u})}catch(d){console.error("Error setting cursor:",d),new k.Notice("Error setting cursor position. Please check console for details.")}}};var f=require("obsidian");var b=class extends f.FuzzySuggestModal{constructor(e,i){super(e);this.fileCache=new Map;this.recentFiles=[];this.searchTimeout=null;this.plugin=i,this.limit=100,this.setPlaceholder("Type to search notes by title or filename..."),this.buildFileCache(),this.updateRecentFiles(),this.addKeyboardNavigation()}addKeyboardNavigation(){this.inputEl.addEventListener("keydown",e=>{e.key==="Escape"&&(this.close(),e.preventDefault(),e.stopPropagation())})}buildFileCache(){this.fileCache=F(this.app.vault.getMarkdownFiles(),this.app.metadataCache,this.plugin.settings.propertyKey)}updateFileCache(e){let i=this.app.metadataCache.getFileCache(e),t=i==null?void 0:i.frontmatter,n=e.basename,s=!1,a=[];if(t&&t[this.plugin.settings.propertyKey]!==void 0&&t[this.plugin.settings.propertyKey]!==null){let r=String(t[this.plugin.settings.propertyKey]).trim();r!==""&&(n=r,s=!0)}t!=null&&t.aliases&&(a=Array.isArray(t.aliases)?t.aliases:[t.aliases],a=a.map(r=>String(r).trim()).filter(r=>r!=="")),this.fileCache.set(e.path,{file:e,displayName:n,aliases:a,lastModified:e.stat.mtime,isCustomDisplay:s})}updateRecentFiles(){let e=this.app.workspace.getLeavesOfType("markdown").map(i=>i.view).filter(i=>i instanceof f.MarkdownView).map(i=>i.file).filter(i=>i!==null).filter((i,t,n)=>n.indexOf(i)===t).slice(0,10);this.recentFiles=e}getItems(){return this.app.vault.getMarkdownFiles()}getItemText(e){if("isNewNote"in e)return`Create new note: ${e.newName}`;let i=this.getDisplayName(e);return i+(this.plugin.settings.includeFilenameInSearch&&i!==e.basename?` (${e.basename})`:"")}getDisplayName(e){let i=this.app.metadataCache.getFileCache(e),t=i==null?void 0:i.frontmatter,n=t==null?void 0:t[this.plugin.settings.propertyKey];if(n!=null){let s=String(n).trim();if(s!=="")return s}return e.basename}getSuggestions(e){if(!this.plugin.settings.enableForQuickSwitcher)return[];let i=e.trim();return this.searchTimeout&&clearTimeout(this.searchTimeout),i?this.performSearch(i):this.getRecentFilesResults()}getRecentFilesResults(){return this.updateRecentFiles(),this.recentFiles.map(e=>({item:e,match:{score:1e3,matches:[]}}))}performSearch(e){var n;let i=(0,f.prepareFuzzySearch)(e),t=[];for(let s of this.fileCache.values()){let{file:a,displayName:r,aliases:l}=s,o=this.getItemText(a),c=(n=i(o))!=null?n:{score:0,matches:[]},u=!1;this.plugin.settings.includeAliasesInSearch&&l.length>0&&(u=l.some(m=>S(m,e))),u&&c.matches.length===0?t.push({item:a,match:{score:-.1,matches:[[0,e.length]]}}):c.matches.length>0&&t.push({item:a,match:c})}try{t.sort((r,l)=>{let o=l.match.score-r.match.score;return o!==0?o:this.getItemText(r.item).localeCompare(this.getItemText(l.item))});let s=e.toLowerCase();if(!t.some(r=>{var l;return r.item instanceof f.TFile&&(this.getDisplayName(r.item).toLowerCase()===s||this.plugin.settings.includeFilenameInSearch&&r.item.basename.toLowerCase()===s||this.plugin.settings.includeAliasesInSearch&&((l=this.fileCache.get(r.item.path))==null?void 0:l.aliases.some(o=>o.toLowerCase()===s)))})){let r={isNewNote:!0,newName:e};t.unshift({item:r,match:{score:1e3,matches:[[0,e.length]]}})}return t.slice(0,this.limit)}catch(s){return console.error("Error generating suggestions:",s),new f.Notice("Error updating Quick Switcher suggestions. Please check console for details."),[]}}renderSuggestion(e,i){let{item:t,match:n}=e,s=this.inputEl.value.trim(),a=this.getItemText(t),r=i.createDiv({cls:"suggestion-content"});if("isNewNote"in t){r.setText(a);return}if(s&&n.matches.length>0){let l=0,o=document.createDocumentFragment();for(let c of n.matches){o.appendText(a.slice(l,c[0]));let u=document.createElement("span");u.className="suggestion-highlight",u.appendText(a.slice(c[0],c[1])),o.appendChild(u),l=c[1]}o.appendText(a.slice(l)),r.appendChild(o)}else r.setText(a);t instanceof f.TFile&&r.createDiv({cls:"suggestion-note",text:t.path.replace(".md","")})}onChooseItem(e,i){"isNewNote"in e?this.app.vault.create(`${e.newName}.md`,"").then(t=>{this.app.workspace.getLeaf().openFile(t)}).catch(t=>{new f.Notice(`Error creating note: ${t.message}`)}):this.app.workspace.getLeaf().openFile(e)}};var w=require("obsidian"),D=class extends w.PluginSettingTab{constructor(e,i){super(e,i);this.plugin=i}display(){let{containerEl:e}=this;e.empty(),new w.Setting(e).setName("Property key").setDesc("The property to use as the display title.").addText(i=>i.setPlaceholder("title").setValue(this.plugin.settings.propertyKey).onChange(async t=>{this.plugin.settings.propertyKey=t.trim()||"title",await this.plugin.saveSettings(this.plugin.settings.enableForQuickSwitcher)})),new w.Setting(e).setName("When linking notes").setDesc("Enable property-based titles in the link suggester.").addToggle(i=>i.setValue(this.plugin.settings.enableForLinking).onChange(async t=>{this.plugin.settings.enableForLinking=t,await this.plugin.saveSettings(this.plugin.settings.enableForQuickSwitcher)})),new w.Setting(e).setName("In Quick Switcher").setDesc("Enable property-based titles in the quick switcher.").addToggle(i=>i.setValue(this.plugin.settings.enableForQuickSwitcher).onChange(async t=>{let n=this.plugin.settings.enableForQuickSwitcher;this.plugin.settings.enableForQuickSwitcher=t,await this.plugin.saveSettings(n)})),new w.Setting(e).setName("Include filename in fuzzy searches").setDesc("Include note filenames in fuzzy search results for link suggester and quick switcher.").addToggle(i=>i.setValue(this.plugin.settings.includeFilenameInSearch).onChange(async t=>{this.plugin.settings.includeFilenameInSearch=t,await this.plugin.saveSettings(this.plugin.settings.enableForQuickSwitcher)})),new w.Setting(e).setName("Include aliases in fuzzy searches").setDesc("Include property aliases in fuzzy search results for link suggester and quick switcher.").addToggle(i=>i.setValue(this.plugin.settings.includeAliasesInSearch).onChange(async t=>{this.plugin.settings.includeAliasesInSearch=t,await this.plugin.saveSettings(this.plugin.settings.enableForQuickSwitcher)})),new w.Setting(e).setName("When dragging notes").setDesc("Use property-based titles when dragging notes from the file explorer.").addToggle(i=>i.setValue(this.plugin.settings.enableForDragDrop).onChange(async t=>{this.plugin.settings.enableForDragDrop=t,await this.plugin.saveSettings(this.plugin.settings.enableForQuickSwitcher)}))}};var T=class extends h.Plugin{async onload(){await this.loadSettings(),setTimeout(()=>{this.updateLinkSuggester(),this.updateQuickSwitcher()},1e3),this.registerEvent(this.app.vault.on("modify",e=>{e instanceof h.TFile&&e.extension==="md"&&this.invalidateCache(e)})),this.registerEvent(this.app.vault.on("rename",(e,i)=>{e instanceof h.TFile&&e.extension==="md"&&this.invalidateCache(e)})),this.registerEvent(this.app.vault.on("delete",e=>{e instanceof h.TFile&&e.extension==="md"&&this.invalidateCache(e)})),this.registerEvent(this.app.metadataCache.on("changed",e=>{e instanceof h.TFile&&e.extension==="md"&&this.rebuildCache()})),this.registerEvent(this.app.metadataCache.on("resolved",()=>{this.rebuildCache()})),this.registerEvent(this.app.workspace.on("editor-drop",(e,i)=>{this.settings.enableForDragDrop&&this.handleDragDrop(e,i)})),this.registerDomEvent(document,"drop",e=>{this.settings.enableForDragDrop&&this.handleDOMDragDrop(e)}),h.Platform.isMobile&&this.registerEvent(this.app.workspace.on("quick-preview",(e,i)=>{if(this.settings.enableForQuickSwitcher)return new b(this.app,this).open(),!1})),this.addCommand({id:"open-quick-switcher",name:"Open Quick Switcher (Property-based)",callback:()=>{new b(this.app,this).open()}}),this.addCommand({id:"toggle-linking",name:"Toggle property-based linking",callback:async()=>{this.settings.enableForLinking=!this.settings.enableForLinking,await this.saveSettings(),new h.Notice(`Property-based linking ${this.settings.enableForLinking?"enabled":"disabled"}`)}}),this.addCommand({id:"toggle-quick-switcher",name:"Toggle property-based Quick Switcher",callback:async()=>{this.settings.enableForQuickSwitcher=!this.settings.enableForQuickSwitcher,await this.saveSettings(),new h.Notice(`Property-based Quick Switcher ${this.settings.enableForQuickSwitcher?"enabled":"disabled"}`)}}),this.addCommand({id:"rebuild-cache",name:"Rebuild file cache",callback:()=>{this.rebuildCache(),new h.Notice("File cache rebuilt")}}),this.addCommand({id:"toggle-drag-drop",name:"Toggle property-based drag and drop",callback:async()=>{this.settings.enableForDragDrop=!this.settings.enableForDragDrop,await this.saveSettings(),new h.Notice(`Property-based drag and drop ${this.settings.enableForDragDrop?"enabled":"disabled"}`)}}),this.addSettingTab(new D(this.app,this))}invalidateCache(e){this.suggest&&this.suggest.updateFileCache(e)}rebuildCache(){this.suggest&&this.suggest.buildFileCache()}handleDragDrop(e,i){var c;if(!e.dataTransfer||!e.dataTransfer.files.length)return;let t=e.dataTransfer.getData("text/plain");if(!t||!t.endsWith(".md"))return;let n=this.app.vault.getAbstractFileByPath(t);if(!n||!(n instanceof h.TFile))return;let s=n.basename;if(this.suggest){let u=this.suggest.fileCache.get(n.path);if(u)s=u.displayName;else{let m=this.app.metadataCache.getFileCache(n),d=m==null?void 0:m.frontmatter;if(d&&d[this.settings.propertyKey]!==void 0&&d[this.settings.propertyKey]!==null){let v=String(d[this.settings.propertyKey]).trim();v!==""&&(s=v)}}}e.preventDefault(),e.stopPropagation();let a=i.getCursor(),r=(c=this.app.vault.getConfig("useMarkdownLinks"))!=null?c:!1,l;r?l=`[${s}](${encodeURI(n.path)})`:l=`[[${n.basename}|${s}]]`,i.replaceRange(l,a,a);let o={line:a.line,ch:a.ch+l.length};i.setCursor(o)}handleDOMDragDrop(e){var r;let i=e.target;if(!i||!i.closest(".cm-editor"))return;let t=(r=e.dataTransfer)==null?void 0:r.getData("text/plain");if(!t||!t.startsWith("obsidian://open?")&&!t.endsWith(".md"))return;let n;if(t.startsWith("obsidian://open?")){let o=new URL(t).searchParams.get("file");if(o)n=decodeURIComponent(o)+".md";else return}else if(t.endsWith(".md"))n=t;else return;let s=this.app.vault.getAbstractFileByPath(n);if(!s||!(s instanceof h.TFile))return;let a=s.basename;if(this.suggest){let l=this.suggest.fileCache.get(s.path);if(l)a=l.displayName;else{let o=this.app.metadataCache.getFileCache(s),c=o==null?void 0:o.frontmatter;if(c&&c[this.settings.propertyKey]!==void 0&&c[this.settings.propertyKey]!==null){let u=String(c[this.settings.propertyKey]).trim();u!==""&&(a=u)}}}setTimeout(()=>{this.replaceLastInsertedLink(s,a)},100)}replaceLastInsertedLink(e,i){var d;let t=this.app.workspace.getActiveViewOfType(h.MarkdownView);if(!t||!t.editor)return;let n=t.editor,s=n.getValue(),a=(d=this.app.vault.getConfig("useMarkdownLinks"))!=null?d:!1,r;a?r=`[${i}](${encodeURI(e.path)})`:r=`[[${e.basename}|${i}]]`;let l=e.basename.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),o=e.path.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),c=e.path.replace(".md","").replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),u=a?new RegExp(`\\[${l}\\]\\(${c}\\)`):new RegExp(`\\[\\[(?:/)?${c}\\]\\]`),m=s.match(u);if(m){let v=s.indexOf(m[0]);if(v!==-1){let y=s.substring(0,v).split(`
`),I={line:y.length-1,ch:y[y.length-1].length},N={line:y.length-1,ch:y[y.length-1].length+m[0].length};n.replaceRange(r,I,N);let M={line:I.line,ch:I.ch+r.length};try{n.setCursor(M)}catch(W){}}}}updateLinkSuggester(){let e=this.app.workspace.editorSuggest;e&&(this.suggest&&(e.suggests=e.suggests.filter(i=>i!==this.suggest),this.suggest=void 0),this.settings.enableForLinking&&(this.suggest=new C(this),this.registerEditorSuggest(this.suggest),e.suggests=e.suggests.filter(i=>!i.constructor.name.includes("LinkSuggest")),e.suggests.unshift(this.suggest)))}updateQuickSwitcher(){let e=this.app.commands.commands["switcher:open"];if(!e){console.error("Failed to find switcher:open command"),new h.Notice("Failed to override Quick Switcher. Please ensure the core Quick Switcher is enabled.");return}this.originalSwitcherCallback&&(e.callback=this.originalSwitcherCallback,this.originalSwitcherCallback=void 0),this.settings.enableForQuickSwitcher&&(this.originalSwitcherCallback=e.callback,e.callback=()=>{new b(this.app,this).open()})}onunload(){let e=this.app.workspace.editorSuggest;e&&this.suggest&&(e.suggests=e.suggests.filter(t=>t!==this.suggest));let i=this.app.commands.commands["switcher:open"];i&&this.originalSwitcherCallback&&(i.callback=this.originalSwitcherCallback)}async loadSettings(){this.settings=Object.assign({},L,await this.loadData())}async saveSettings(e){await this.saveData(this.settings),this.updateLinkSuggester(),this.updateQuickSwitcher()}};
