/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var D=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var $=(w,f)=>{for(var s in f)D(w,s,{get:f[s],enumerable:!0})},I=(w,f,s,e)=>{if(f&&typeof f=="object"||typeof f=="function")for(let t of A(f))!M.call(w,t)&&t!==s&&D(w,t,{get:()=>f[t],enumerable:!(e=k(f,t))||e.enumerable});return w};var N=w=>I(D({},"__esModule",{value:!0}),w);var S={};$(S,{default:()=>x});module.exports=N(S);var i=require("obsidian"),Y={enableUnderscorePrefix:!1,defaultTemplate:`---
title: "{{title}}"
date: {{date}}
tags: []
---
`,linkBasePath:"/blog/",postsFolder:"posts",automatePostCreation:!0,autoInsertProperties:!0,creationMode:"file",indexFileName:"index",dateFormat:"YYYY-MM-DD",excludedDirectories:"",onlyAutomateInPostsFolder:!1},x=class extends i.Plugin{async onload(){await this.loadSettings(),this.app.workspace.onLayoutReady(()=>{this.registerCreateEvent()}),this.addCommand({id:"standardize-properties",name:"Standardize Properties",icon:"file-check",editorCallback:(s,e)=>{e.file instanceof i.TFile&&this.standardizeProperties(e.file)}}),this.addCommand({id:"convert-wikilinks-astro",name:"Convert internal links for Astro",icon:"link-2",editorCallback:(s,e)=>{e.file instanceof i.TFile&&this.convertWikilinksForAstro(s,e.file)}}),this.addSettingTab(new E(this.app,this))}registerCreateEvent(){if(this.createEvent&&this.app.vault.off("create",this.createEvent),this.settings.automatePostCreation){let s=0,e=500;this.createEvent=async t=>{let r=Date.now();if(!(r-s<e)&&(s=r,t instanceof i.TFile&&t.extension==="md")){let d=t.path,n=this.settings.postsFolder||"",l=await this.app.vault.adapter.stat(t.path),u=(l==null?void 0:l.mtime)&&r-l.mtime<1e3,p=(await this.app.vault.read(t)).trim()==="";if(!u||!p)return;if(this.settings.onlyAutomateInPostsFolder){if(!n||d.startsWith(n+"/")||d===n){let c=this.app.metadataCache.getCache(t.path);(!c||!c.sections||c.sections.length===0)&&new v(this.app,t,this).open()}}else if(!this.settings.excludedDirectories.split("|").map(g=>g.trim()).filter(g=>g.length>0).some(g=>d.startsWith(g+"/")||d===g)){let g=this.app.metadataCache.getCache(t.path);(!g||!g.sections||g.sections.length===0)&&new v(this.app,t,this).open()}}},this.registerEvent(this.app.vault.on("create",this.createEvent))}}toKebabCase(s){return s.toLowerCase().replace(/[^a-z0-9\s-]/g,"").trim().replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}async createPostFile(s,e){if(!e)return new i.Notice("Title is required to create a post."),null;let t=this.toKebabCase(e),r=this.settings.enableUnderscorePrefix?"_":"",d=this.settings.postsFolder||"";if(d&&(this.app.vault.getAbstractFileByPath(d)instanceof i.TFolder||await this.app.vault.createFolder(d)),this.settings.creationMode==="folder"){let n=`${r}${t}`,l=d?`${d}/${n}`:n;try{this.app.vault.getAbstractFileByPath(l)instanceof i.TFolder||await this.app.vault.createFolder(l)}catch(c){}let u=`${this.settings.indexFileName}.md`,a=`${l}/${u}`;if(this.app.vault.getAbstractFileByPath(a)instanceof i.TFile)return new i.Notice(`File already exists at ${a}.`),null;try{await this.app.vault.rename(s,a);let c=this.app.vault.getAbstractFileByPath(a);return c instanceof i.TFile?(setTimeout(()=>{let g=this.app.workspace.getLeavesOfType("file-explorer")[0];if(g&&g.view){let o=g.view.tree;o&&c instanceof i.TFile&&o.revealFile(c)}},200),await this.app.workspace.getLeaf(!1).openFile(c),this.settings.autoInsertProperties&&await this.addPropertiesToFile(c,e),c):null}catch(c){return new i.Notice(`Failed to create folder structure: ${c.message}.`),null}}else{let n=`${r}${t}.md`,l=d?`${d}/${n}`:n,u=this.app.vault.getAbstractFileByPath(l);if(u instanceof i.TFile&&u!==s)return new i.Notice(`File with name "${n}" already exists.`),null;try{await this.app.vault.rename(s,l);let a=this.app.vault.getAbstractFileByPath(l);return a instanceof i.TFile?(await this.app.workspace.getLeaf(!1).openFile(a),this.settings.autoInsertProperties&&await this.addPropertiesToFile(a,e),a):null}catch(a){return new i.Notice(`Failed to rename file: ${a.message}.`),null}}}async addPropertiesToFile(s,e,t){let r=new Date,d=window.moment(r).format(this.settings.dateFormat),n=this.settings.defaultTemplate;n=n.replace(/\{\{title\}\}/g,e),n=n.replace(/\{\{date\}\}/g,d),await this.app.vault.modify(s,n)}async standardizeProperties(s){if(!(s instanceof i.TFile)){new i.Notice("No active file.");return}await new Promise(o=>setTimeout(o,100));let e=await this.app.vault.read(s),t=s.basename.replace(/^_/,""),r=0,d="",n={};if(e.startsWith("---")){r=e.indexOf(`
---`,3),r===-1?r=e.length:r+=4,d=e.slice(4,r-4).trim();try{let o=null;d.split(`
`).forEach(F=>{let b=F.match(/^(\w+):\s*(.+)?$/);if(b){let[,m,C]=b;o=m,m==="tags"?n[m]=[]:C&&(n[m]=[C.trim()])}else if(o==="tags"&&F.trim().startsWith("- ")){let m=F.trim().replace(/^-\s*/,"");m&&n.tags.push(m)}}),d.includes("tags:")&&!n.tags.length&&(n.tags=[])}catch(o){new i.Notice("Falling back to template due to parsing error.")}}let l=this.settings.defaultTemplate.split(`
`),u=[],a={},p=!1;for(let o=0;o<l.length;o++){let F=l[o].trim();if(F==="---"){if(p=!p,!p)break;continue}if(p){let b=F.match(/^(\w+):\s*(.+)?$/);if(b){let[,m,C]=b;if(u.push(m),m==="tags")if(C&&C.startsWith("[")){let P=C.replace(/[\[\]]/g,"").split(",").map(y=>y.trim()).filter(y=>y);a[m]=P.length?P:[]}else{a[m]=[];for(let P=o+1;P<l.length;P++){let y=l[P].trim();if(y.startsWith("- ")){let T=y.replace(/^-\s*/,"").trim();T&&a[m].push(T)}else if(y==="---")break}}else C&&(a[m]=[C.replace(/\{\{title\}\}/g,t).replace(/\{\{date\}\}/g,window.moment(new Date).format(this.settings.dateFormat))])}}}let c={...n};for(let o of u)if(!(o in n))c[o]=a[o]||[];else if(o==="tags"&&a[o]&&a[o].length>0){let F=[...n[o],...a[o].filter(b=>!n[o].includes(b))];c[o]=F}let h=`---
`;for(let o in c)(c[o].length>0||o==="tags"&&d.includes("tags:"))&&(o==="tags"?(h+=`tags:
`,c[o].length>0&&c[o].forEach(F=>{h+=`  - ${F}
`})):h+=`${o}: ${c[o][0]}
`);h+="---";let g=e.slice(r);h+=g,await this.app.vault.modify(s,h),new i.Notice("Properties standardized using template.")}async convertWikilinksForAstro(s,e){if(!(e instanceof i.TFile)){new i.Notice("No active file.");return}let r=s.getValue(),d=/\.(png|jpg|jpeg|gif|svg)$/i;r=r.replace(/\[\[([^\]|]+)(\|([^\]]+))?\]\]/g,(n,l,u,a)=>{if(d.test(l))return n;let p=a||l.replace(/\.md$/,""),c=this.toKebabCase(l.replace(/\.md$/,"")),h=this.settings.linkBasePath;return h.startsWith("/")||(h="/"+h),h.endsWith("/")||(h=h+"/"),`[${p}](${h}${c}/)`}),r=r.replace(/\[([^\]]+)\]\(([^)]+\.md)\)/g,(n,l,u)=>{if(d.test(u)||u.match(/^https?:\/\//))return n;let a=this.toKebabCase(u.replace(/\.md$/,"")),p=this.settings.linkBasePath;return p.startsWith("/")||(p="/"+p),p.endsWith("/")||(p=p+"/"),`[${l}](${p}${a}/)`}),r=r.replace(/!\[(.*?)\]\(([^)]+)\)/g,n=>n),r=r.replace(/\{\{([^}]+)\}\}/g,(n,l)=>{if(d.test(l))return n;let u=this.toKebabCase(l.replace(".md","")),a=this.settings.linkBasePath;return a.startsWith("/")||(a="/"+a),a.endsWith("/")||(a=a+"/"),`[Embedded: ${l}](${a}${u}/)`}),s.setValue(r),new i.Notice("All internal links converted for Astro.")}async loadSettings(){this.settings=Object.assign({},Y,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},v=class extends i.Modal{constructor(s,e,t){super(s);this.file=e,this.plugin=t}onOpen(){let{contentEl:s}=this;s.empty(),s.createEl("h2",{text:"New Blog Post"}),s.createEl("p",{text:"Enter a title for your blog post:"}),this.titleInput=s.createEl("input",{type:"text",placeholder:"My Awesome Blog Post",cls:"astro-composer-title-input"}),this.titleInput.focus();let e=s.createDiv({cls:"astro-composer-button-container"}),t=e.createEl("button",{text:"Cancel",cls:"astro-composer-cancel-button"});t.onclick=()=>this.close();let r=e.createEl("button",{text:"Create",cls:["astro-composer-create-button","mod-cta"]});r.onclick=()=>this.createPost(),this.titleInput.addEventListener("keypress",d=>{d.key==="Enter"&&this.createPost()})}async createPost(){let s=this.titleInput.value.trim();if(!s){new i.Notice("Please enter a title.");return}try{let e=await this.plugin.createPostFile(this.file,s);e&&this.plugin.settings.autoInsertProperties&&await this.plugin.addPropertiesToFile(e,s)}catch(e){new i.Notice(`Error creating post: ${e.message}.`)}this.close()}onClose(){let{contentEl:s}=this;s.empty()}},E=class extends i.PluginSettingTab{constructor(s,e){super(s,e);this.autoRenameContainer=null;this.postsFolderContainer=null;this.onlyAutomateContainer=null;this.creationModeContainer=null;this.indexFileContainer=null;this.excludedDirsContainer=null;this.underscorePrefixContainer=null;this.autoInsertContainer=null;this.plugin=e}display(){let{containerEl:s}=this;s.empty(),new i.Setting(s).setName("Automate post creation").setDesc("Automatically show title dialog for new .md files, rename them based on the title, and insert properties if enabled.").addToggle(e=>e.setValue(this.plugin.settings.automatePostCreation).onChange(async t=>{this.plugin.settings.automatePostCreation=t,this.plugin.settings.autoInsertProperties=t,await this.plugin.saveSettings(),this.plugin.registerCreateEvent(),this.updateConditionalFields()})),this.autoRenameContainer=s.createDiv({cls:"auto-rename-fields"}),this.autoRenameContainer.style.display=this.plugin.settings.automatePostCreation?"block":"none",this.autoInsertContainer=this.autoRenameContainer.createDiv(),new i.Setting(this.autoInsertContainer).setName("Auto-insert properties").setDesc("Automatically insert the properties template when creating new files (requires 'Automate post creation' to be enabled).").addToggle(e=>e.setValue(this.plugin.settings.autoInsertProperties).setDisabled(!this.plugin.settings.automatePostCreation).onChange(async t=>{this.plugin.settings.autoInsertProperties=t,await this.plugin.saveSettings()})),this.postsFolderContainer=this.autoRenameContainer.createDiv(),new i.Setting(this.postsFolderContainer).setName("Posts folder").setDesc("Folder name for blog posts (leave blank to use the vault folder). You can specify the default location for new notes in Obsidian's 'Files and links' settings.").addText(e=>e.setPlaceholder("Enter folder path").setValue(this.plugin.settings.postsFolder).onChange(async t=>{this.plugin.settings.postsFolder=t,await this.plugin.saveSettings()})),this.onlyAutomateContainer=this.autoRenameContainer.createDiv(),new i.Setting(this.onlyAutomateContainer).setName("Only automate in this folder").setDesc("When enabled, automation will only trigger for new .md files within the specified Posts folder and subfolders.").addToggle(e=>e.setValue(this.plugin.settings.onlyAutomateInPostsFolder).onChange(async t=>{this.plugin.settings.onlyAutomateInPostsFolder=t,await this.plugin.saveSettings(),this.updateExcludedDirsField()})),this.excludedDirsContainer=this.autoRenameContainer.createDiv({cls:"excluded-dirs-field"}),this.excludedDirsContainer.style.display=this.plugin.settings.onlyAutomateInPostsFolder?"none":"block",new i.Setting(this.excludedDirsContainer).setName("Excluded directories").setDesc("Directories to exclude from automatic post creation (e.g., pages|posts/example). Excluded directories and their child folders will be ignored. Use '|' to separate multiple directories.").addText(e=>e.setPlaceholder("pages|posts/example").setValue(this.plugin.settings.excludedDirectories).onChange(async t=>{this.plugin.settings.excludedDirectories=t,await this.plugin.saveSettings()})),this.creationModeContainer=this.autoRenameContainer.createDiv(),new i.Setting(this.creationModeContainer).setName("Creation mode").setDesc("How to create new posts: file-based or folder-based with index.md.").addDropdown(e=>e.addOption("file","File-based (post-title.md)").addOption("folder","Folder-based (post-title/index.md)").setValue(this.plugin.settings.creationMode).onChange(async t=>{this.plugin.settings.creationMode=t,await this.plugin.saveSettings(),this.updateIndexFileField()})),this.indexFileContainer=this.autoRenameContainer.createDiv({cls:"index-file-field"}),this.indexFileContainer.style.display=this.plugin.settings.creationMode==="folder"?"block":"none",new i.Setting(this.indexFileContainer).setName("Index file name").setDesc("Name for the main file in folder-based mode (without .md extension).").addText(e=>e.setPlaceholder("index").setValue(this.plugin.settings.indexFileName).onChange(async t=>{this.plugin.settings.indexFileName=t||"index",await this.plugin.saveSettings()})),this.underscorePrefixContainer=this.autoRenameContainer.createDiv(),new i.Setting(this.underscorePrefixContainer).setName("Use underscore prefix for drafts").setDesc("Add an underscore prefix (_post-title) to new notes by default when enabled. This hides them from Astro, which can be helpful for post drafts. Disable to skip prefixing.").addToggle(e=>e.setValue(this.plugin.settings.enableUnderscorePrefix).onChange(async t=>{this.plugin.settings.enableUnderscorePrefix=t,await this.plugin.saveSettings()})),new i.Setting(s).setName("Link base path").setDesc("Base path for converted links (e.g., /blog/, leave blank for root domain).").addText(e=>e.setPlaceholder("/blog/").setValue(this.plugin.settings.linkBasePath).onChange(async t=>{this.plugin.settings.linkBasePath=t,await this.plugin.saveSettings()})),new i.Setting(s).setName("Date format").setDesc("Format for the date in properties (e.g., YYYY-MM-DD, MMMM D, YYYY, YYYY-MM-DD HH:mm).").addText(e=>e.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.dateFormat).onChange(async t=>{this.plugin.settings.dateFormat=t||"YYYY-MM-DD",await this.plugin.saveSettings()})),new i.Setting(s).setName("Properties template").addTextArea(e=>{let t=this.plugin;return e.setPlaceholder(`---
title: "{{title}}"
date: {{date}}
tags: []
---
`).setValue(t.settings.defaultTemplate).onChange(async r=>{t.settings.defaultTemplate=r,await t.saveSettings()}),e.inputEl.classList.add("astro-composer-template-textarea"),e}).then(e=>{e.descEl.empty();let t=e.descEl.createEl("div");t.innerHTML="Used for new posts and when standardizing properties.<br />Variables include {{title}} and {{date}}.<br />Do not wrap {{date}} in quotes as it represents a datetime value, not a string.<br />The 'standardize properties' command ignores anything below the second '---' line."}),this.updateConditionalFields(),this.updateIndexFileField(),this.updateExcludedDirsField()}updateConditionalFields(){this.autoRenameContainer&&(this.autoRenameContainer.style.display=this.plugin.settings.automatePostCreation?"block":"none")}updateIndexFileField(){this.indexFileContainer&&(this.indexFileContainer.style.display=this.plugin.settings.creationMode==="folder"?"block":"none")}updateExcludedDirsField(){this.excludedDirsContainer&&(this.excludedDirsContainer.style.display=this.plugin.settings.onlyAutomateInPostsFolder?"none":"block")}};
