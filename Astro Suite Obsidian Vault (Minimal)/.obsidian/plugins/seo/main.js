/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var M=Object.defineProperty;var ge=Object.getOwnPropertyDescriptor;var he=Object.getOwnPropertyNames;var pe=Object.prototype.hasOwnProperty;var H=(r,n)=>()=>(r&&(n=r(r=0)),n);var V=(r,n)=>{for(var t in n)M(r,t,{get:n[t],enumerable:!0})},de=(r,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of he(n))!pe.call(r,s)&&s!==t&&M(r,s,{get:()=>n[s],enumerable:!(e=ge(n,s))||e.enumerable});return r};var fe=r=>de(M({},"__esModule",{value:!0}),r);function O(r){return r.replace(/```[\s\S]*?```/g,"").replace(/~~~[\s\S]*?~~~/g,"").replace(/`[^`\n]+`/g,"").replace(/<[^>]*>/g,"").replace(/^---\n[\s\S]*?\n---\n/,"")}function ye(r){return r.replace(/```[\s\S]*?```/g,"").replace(/~~~[\s\S]*?~~~/g,"").replace(/`[^`\n]+`/g,"").replace(/<[^>]*>/g,"").replace(/^---\n[\s\S]*?\n---\n/,"")}async function K(r,n,t){let e=[],s=O(r),i=s.match(/!\[([^\]]*)\]\([^)]+\)/g);if(i){let o=i.filter(u=>{var g;let c=(g=u.match(/!\[([^\]]*)\]/))==null?void 0:g[1];return!c||c.trim()===""});if(o.length>0){let u=o.length,c=u>1;e.push({passed:!1,message:`${u} image${c?"s are":" is"} missing alt text`,suggestion:"Add descriptive alt text for accessibility",severity:"error"})}}let a=s.match(/!\[\[([^\]]+)\]\]/g);if(a){let o=a.filter(u=>!u.includes("|"));if(o.length>0){let u=o.length,c=u>1;e.push({passed:!1,message:`${u} wikilink image${c?"s are":" is"} missing alt text`,suggestion:"Add alt text using ![[image.png|alt text]] syntax or consider using standard markdown image syntax",severity:"error"})}}let l=s.match(/<img[^>]*>/g);if(l){let o=l.filter(u=>!u.includes("alt="));if(o.length>0){let u=o.length,c=u>1;e.push({passed:!1,message:`${u} HTML image${c?"s are":" is"} missing alt attribute`,suggestion:"Add alt attribute to HTML img tags",severity:"error"})}}return e.length===0&&(i&&i.length>0||l&&l.length>0||a&&a.length>0?e.push({passed:!0,message:"All images have alt text",severity:"info"}):e.push({passed:!0,message:"No images in this post",severity:"info"})),e}async function U(r,n,t){let e=[],i=ye(r).match(/(?<!\]\()https?:\/\/[^\s\)]+/g);return i&&i.forEach((a,l)=>{e.push({passed:!1,message:`Naked link found: ${a}`,suggestion:"Convert to markdown link format: [link text](url)",severity:"warning"})}),e.length===0&&e.push({passed:!0,message:"No naked links found",severity:"info"}),e}async function z(r,n,t){let e=[],s=r.replace(/^---\n[\s\S]*?\n---\n/,"");s=s.replace(/```[\s\S]*?```/g,""),s=s.replace(/~~~[\s\S]*?~~~/g,"");let i=s.split(`
`),a=null,l=!1;for(let o=0;o<i.length;o++){let c=i[o].match(/^(#{1,6})\s+(.+)/);if(c){l=!0;let g=c[1].length,h=c[2].trim();if(a===null){a=g;continue}g>a+1&&e.push({passed:!1,message:`"${h}" (H${g}) skips heading level(s) after H${a}`,suggestion:"Use heading levels in order (H1 \u2192 H2 \u2192 H3, etc.)",severity:"warning"}),a=g}}return l?e.length===0&&e.push({passed:!0,message:"Heading structure is correct",severity:"info"}):e.push({passed:!0,message:"No heading structure issues found",severity:"info"}),e}async function q(r,n,t){let e=[];if(!t.keywordProperty)return[];let s=r.match(/^---\n([\s\S]*?)\n---/);if(!s)return[];let a=s[1].match(new RegExp(`^${t.keywordProperty}:\\s*(.+)$`,"m"));if(!a)return[];let l=a[1].trim(),o=r.replace(/^---\n[\s\S]*?\n---\n/,""),u=o.split(/\s+/).filter(h=>h.length>0).length,c=(o.toLowerCase().match(new RegExp(l.toLowerCase(),"g"))||[]).length,g=u>0?c/u*100:0;return c===0?e.push({passed:!1,message:`Target keyword "${l}" not found in content`,suggestion:"Include your target keyword naturally in the content",severity:"warning"}):g<t.keywordDensityMin?e.push({passed:!1,message:`Keyword density too low: ${g.toFixed(1)}% (${c} uses in ${u} words)`,suggestion:`Aim for ${t.keywordDensityMin}-${t.keywordDensityMax}% density`,severity:"warning"}):g>t.keywordDensityMax?e.push({passed:!1,message:`Keyword density too high: ${g.toFixed(1)}% (${c} uses in ${u} words)`,suggestion:`Aim for ${t.keywordDensityMin}-${t.keywordDensityMax}% density`,severity:"warning"}):e.push({passed:!0,message:`Good keyword density: ${g.toFixed(1)}% (${c} uses in ${u} words)`,severity:"info"}),e}async function Z(r,n,t,e){var l;let s=[],i=O(r),a=[...i.match(/\[\[([^\]]+)\]\]/g)||[],...i.match(/\[([^\]]+)\]\(([^)]+)\)/g)||[]];for(let o of a){let u="";if(o.startsWith("[["))u=(((l=o.match(/\[\[([^\]]+)\]\]/))==null?void 0:l[1])||"").split("|")[0];else{let c=o.match(/\[([^\]]+)\]\(([^)]+)\)/);u=(c==null?void 0:c[2])||""}if(u&&!u.startsWith("http")){let c=o.startsWith("[["),g=u.match(/\.(png|jpg|jpeg|gif|svg|webp)$/i);c||g?e!=null&&e.metadataCache.getFirstLinkpathDest(u,n.path)||s.push({passed:!1,message:`Broken link: ${u}`,suggestion:g?"Verify the image path exists or check if it's a relative path":"Check if the wikilink target exists or create the target note",severity:"error"}):e!=null&&e.vault.getAbstractFileByPath(u)||s.push({passed:!1,message:`Broken internal link: ${u}`,suggestion:"Check the link path or create the target file",severity:"error"})}}return s.length===0&&s.push({passed:!0,message:"No broken links found",severity:"info"}),s}async function _(r,n,t,e){var l;let s=[],i=O(r),a=[...i.match(/\[\[([^\]]+)\]\]/g)||[],...i.match(/\[([^\]]+)\]\(([^)]+)\)/g)||[]];for(let o of a){let u="";if(o.startsWith("[["))u=(((l=o.match(/\[\[([^\]]+)\]\]/))==null?void 0:l[1])||"").split("|")[0];else{let c=o.match(/\[([^\]]+)\]\(([^)]+)\)/);u=(c==null?void 0:c[2])||""}if(u&&!u.startsWith("http")){let c=o.startsWith("[["),g=u.match(/\.(png|jpg|jpeg|gif|svg|webp)$/i);(c||g)&&(e!=null&&e.metadataCache.getFirstLinkpathDest(u,n.path))&&c&&s.push({passed:!1,message:`Potentially broken link: ${u}`,suggestion:"Wikilinks may not work on the web - consider converting to standard markdown links",severity:"warning"})}}return s.length===0&&s.push({passed:!0,message:"No potentially broken links found",severity:"info"}),s}async function X(r,n,t){let e=[];if(!t.descriptionProperty)return[];let s=r.match(/^---\n([\s\S]*?)\n---/);if(!s)return e.push({passed:!1,message:"No frontmatter found",suggestion:"Add frontmatter with description property",severity:"warning"}),e;let a=s[1].match(new RegExp(`^${t.descriptionProperty}:\\s*(.+)$`,"m"));if(!a)return e.push({passed:!1,message:`No ${t.descriptionProperty} found in frontmatter`,suggestion:`Add ${t.descriptionProperty} to frontmatter`,severity:"warning"}),e;let o=a[1].trim().length;return o<120?e.push({passed:!1,message:`Description too short: ${o} characters`,suggestion:"Aim for 120-160 characters",severity:"warning"}):o>160?e.push({passed:!1,message:`Description too long: ${o} characters`,suggestion:"Aim for 120-160 characters",severity:"warning"}):e.push({passed:!0,message:`Good description length: ${o} characters`,severity:"info"}),e}async function Y(r,n,t){let e=[];if(!t.titleProperty)return[];let s="",i=r.match(/^---\n([\s\S]*?)\n---/);if(i){let o=i[1].match(new RegExp(`^${t.titleProperty}:\\s*(.+)$`,"m"));o&&(s=o[1].trim())}if(!s&&t.useFilenameAsTitle&&(s=n.basename),!s)return[];let a=s.length;return a<30?e.push({passed:!1,message:`Title too short: ${a} characters`,suggestion:"Aim for 30-60 characters.",severity:"warning"}):a>60?e.push({passed:!1,message:`Title too long: ${a} characters`,suggestion:"Aim for 30-60 characters.",severity:"warning"}):e.push({passed:!0,message:`Good title length: ${a} characters`,severity:"info"}),e}async function J(r,n,t){let e=[];if(!t.checkContentLength)return[{passed:!0,message:"Content length check disabled",severity:"info"}];let s=r.replace(/^---\n[\s\S]*?\n---\n/,"");s=s.replace(/```[\s\S]*?```/g,""),s=s.replace(/~~~[\s\S]*?~~~/g,"");let i=s.split(/\s+/).filter(a=>a.length>0).length;return i<t.minContentLength?e.push({passed:!1,message:`Content too short: ${i} words`,suggestion:`Aim for at least ${t.minContentLength} words for better SEO`,severity:"warning"}):e.push({passed:!0,message:`Good content length: ${i} words`,severity:"info"}),e}async function Q(r,n,t){let e=[];if(!t.checkImageNaming)return[{passed:!0,message:"Image naming check disabled",severity:"info"}];let i=O(r).match(/!\[[^\]]*\]\(([^)]+)\)/g);return i&&i.forEach((a,l)=>{var u;let o=(u=a.match(/!\[[^\]]*\]\(([^)]+)\)/))==null?void 0:u[1];if(o){let c=o.split("/").pop()||"";c.includes(" ")||c.includes("%20")?e.push({passed:!1,message:`Image ${l+1} has spaces in filename: ${c}`,suggestion:"Use kebab-case or underscores instead of spaces",severity:"warning"}):c.match(/^[a-f0-9]{8,}$/)?e.push({passed:!1,message:`Image ${l+1} has random filename: ${c}`,suggestion:"Use descriptive filenames for better SEO",severity:"warning"}):c.toLowerCase().includes("pasted")||c.toLowerCase().includes("image")||c.toLowerCase().includes("untitled")||c.toLowerCase().includes("screenshot")||c.toLowerCase().includes("photo")?e.push({passed:!1,message:`Image ${l+1} has generic filename: ${c}`,suggestion:"Use descriptive filenames for better SEO",severity:"warning"}):(c.length<5||c.length>50)&&e.push({passed:!1,message:`Image ${l+1} has inappropriate filename length: ${c}`,suggestion:"Use descriptive filenames between 5-50 characters",severity:"warning"})}}),e.length===0&&e.push({passed:!0,message:"All images have good filenames",severity:"info"}),e}async function ee(r,n,t){let e=[];if(!t.checkDuplicateContent)return[];let s=globalThis.app;if(!s)return e;let i;if(t.scanDirectories.trim()){let c=t.scanDirectories.split(",").map(g=>g.trim());i=s.vault.getMarkdownFiles().filter(g=>c.some(h=>g.path.startsWith(h+"/")||g.path.startsWith(h+"\\")))}else i=s.vault.getMarkdownFiles();let a=i.filter(c=>c.path!==n.path);if(a.length===0)return e.push({passed:!0,message:"No other files to compare against",severity:"info"}),e;let o=O(r).split(`

`).filter(c=>c.trim().length>100).map(c=>c.trim().toLowerCase().replace(/\s+/g," "));if(o.length===0)return e.push({passed:!0,message:"No substantial content to check",severity:"info"}),e;let u=[];for(let c of o){let g=[];for(let h of a)try{let f=await s.vault.read(h);O(f).split(`

`).filter(d=>d.trim().length>100).map(d=>d.trim().toLowerCase().replace(/\s+/g," ")).includes(c)&&g.push(h.path)}catch(f){continue}g.length>0&&u.push({paragraph:c,duplicateFiles:g})}if(u.length>0){let c=u.length,g=[...new Set(u.flatMap(h=>h.duplicateFiles))];e.push({passed:!1,message:`Found ${c} paragraph(s) duplicated in other files`,suggestion:`Duplicate content found. Review and rewrite duplicate content to improve SEO.<br><br>${g.map(h=>`\u2022 ${h}`).join("<br>")}`,severity:"warning"})}else e.push({passed:!0,message:"No duplicate content found across vault",severity:"info"});return e}async function te(r,n,t){let e=[];if(!t.checkReadingLevel)return[{passed:!0,message:"Reading level check disabled",severity:"info"}];let s=r.replace(/^---\n[\s\S]*?\n---\n/,"");s=s.replace(/```[\s\S]*?```/g,"").replace(/~~~[\s\S]*?~~~/g,"").replace(/`[^`\n]+`/g,"").replace(/https?:\/\/[^\s]+/g,"").trim();let i=s.split(/[.!?]+/).filter(h=>h.trim().length>10),a=s.split(/\s+/).filter(h=>h.length>0&&/^[a-zA-Z]/.test(h)),l=a.reduce((h,f)=>h+ke(f),0);if(i.length===0||a.length<10)return e.push({passed:!0,message:"Not enough content for reading level analysis",severity:"info"}),e;let o=a.length/i.length,u=l/a.length,c=206.835-1.015*o-84.6*u,g;return c>=90?g=5:c>=80?g=6:c>=70?g=7:c>=60?g=8:c>=50?g=9:c>=30?g=10:g=12,g>15?e.push({passed:!1,message:`Reading level too high: ${g.toFixed(1)} (Graduate level)`,suggestion:"Consider simplifying language for broader audience",severity:"warning"}):g<4?e.push({passed:!1,message:`Reading level too low: ${g.toFixed(1)} (Elementary level)`,suggestion:"Consider using more sophisticated language",severity:"warning"}):e.push({passed:!0,message:`Good reading level: ${g.toFixed(1)} (${we(g)})`,severity:"info"}),e}async function se(r,n,t){let e=[];if(!t.showNotices)return[{passed:!0,message:"Notices check disabled",severity:"info"}];let s=r.match(/\[\[([^\]]+)\]\]/g);if(s){let a=s.map(l=>{let o=l.match(/\[\[([^\]]+)\]\]/);return o?o[1]:l});e.push({passed:!1,message:`Found ${s.length} wikilink(s) that may not render on web`,suggestion:`Consider converting to markdown links for web publishing:<br><br>${a.map(l=>`\u2022 ${l}`).join("<br>")}`,severity:"warning"})}let i=r.match(/!\[[^\]]*\]\([^)]+\)/g);if(i){let a=i.map(l=>{let o=l.match(/!\[[^\]]*\]\(([^)]+)\)/);return o?o[1]:l});e.push({passed:!1,message:`Found ${i.length} embedded image(s) that may not work on web`,suggestion:`Ensure images are properly linked and accessible:<br><br>${a.map(l=>`\u2022 ${l}`).join("<br>")}`,severity:"warning"})}return e.length===0&&e.push({passed:!0,message:"No web compatibility issues found",severity:"info"}),e}function ke(r){if(r=r.toLowerCase(),r.length<=3)return 1;let n="aeiouy",t=0,e=!1;for(let s=0;s<r.length;s++){let i=n.includes(r[s]);i&&!e&&t++,e=i}return r.endsWith("e")&&t--,t===0&&(t=1),t}function we(r){return r<6?"Elementary":r<8?"Middle School":r<10?"High School":r<12?"College Prep":"College"}async function ne(r,n,t){let e=[];if(!t.titleProperty||!t.keywordProperty)return[];let s="",i="",a=r.match(/^---\n([\s\S]*?)\n---/);if(a){let g=a[1],h=g.match(new RegExp(`^${t.titleProperty}:\\s*(.+)$`,"m"));h&&(s=h[1].trim());let f=g.match(new RegExp(`^${t.keywordProperty}:\\s*(.+)$`,"m"));f&&(i=f[1].trim())}if(!s&&t.useFilenameAsTitle&&(s=n.basename),!s||!i)return[];let l=s.toLowerCase();return i.toLowerCase().split(/\s+/).filter(g=>g.length>0).every(g=>l.includes(g))?e.push({passed:!0,message:`Target keyword "${i}" found in title`,severity:"info"}):e.push({passed:!1,message:`Target keyword "${i}" not found in title`,suggestion:"Include your target keyword in the title for better SEO",severity:"warning"}),e}var ie=H(()=>{});var C={};V(C,{clearAllCache:()=>Pe,clearCache:()=>xe,clearCacheForFile:()=>Fe,getCacheStats:()=>Oe,runSEOCheck:()=>Ee});async function Ee(r,n){let t=[];for(let e of n)try{let s=be(e,r);if(s){t.push(s);continue}let i=await r.app.vault.read(e),a=await Ce(r,e,i);Te(e,a,r),t.push(a)}catch(s){console.error(`Error checking file ${e.path}:`,s)}return t}async function Ce(r,n,t){let e={titleLength:await Y(t,n,r.settings),metaDescription:await X(t,n,r.settings),keywordInTitle:await ne(t,n,r.settings),keywordDensity:await q(t,n,r.settings),headingOrder:await z(t,n,r.settings),contentLength:await J(t,n,r.settings),duplicateContent:await ee(t,n,r.settings),altText:await K(t,n,r.settings),imageNaming:await Q(t,n,r.settings),brokenLinks:await Z(t,n,r.settings,r.app),potentiallyBrokenLinks:await _(t,n,r.settings,r.app),nakedLinks:await U(t,n,r.settings),readingLevel:await te(t,n,r.settings),notices:await se(t,n,r.settings)},s=Object.values(e).flat(),i=s.filter(o=>o.severity==="error").length,a=s.filter(o=>o.severity==="warning").length,l;if(s.length===0)l=100;else{let o=0,u=0;s.forEach(p=>{let d=1,m=0;p.message.includes("Broken link")&&!p.passed||p.message.includes("title")&&!p.passed?(d=10,m=0):p.message.includes("alt text")&&!p.passed||p.message.includes("meta description")&&!p.passed?(d=5,m=0):p.message.includes("content length")&&!p.passed||p.message.includes("reading level")&&!p.passed?(d=3,m=0):p.severity==="warning"&&!p.passed?(d=1,m=0):p.passed&&(m=100),o+=m*d,u+=d});let c=u>0?o/u:100,g=0,h=s.filter(p=>p.severity==="error"&&!p.passed&&p.message.includes("Broken link")).length;g+=Math.min(h*2,10);let f=s.filter(p=>p.severity==="error"&&!p.passed&&p.message.includes("alt text")).length;g+=Math.min(f*1,5);let v=s.filter(p=>p.severity==="warning"&&!p.passed).length;g+=Math.min(v*.5,5),g=Math.min(g,20),l=Math.max(40,Math.min(100,c-g))}return{file:n.path,checks:e,overallScore:l,issuesCount:i,warningsCount:a}}async function Se(r,n){try{let t=await n.vault.read(r),e=await n.vault.adapter.stat(r.path);return`${t.length}-${e.mtime}`}catch(t){return`${Date.now()}`}}function re(r){let n={keywordProperty:r.keywordProperty||"",keywordDensityMin:r.keywordDensityMin,keywordDensityMax:r.keywordDensityMax,descriptionProperty:r.descriptionProperty||"",titleProperty:r.titleProperty||"",useFilenameAsTitle:r.useFilenameAsTitle,checkContentLength:r.checkContentLength,minContentLength:r.minContentLength,checkDuplicateContent:r.checkDuplicateContent,scanDirectories:r.scanDirectories||""};return JSON.stringify(n)}function be(r,n){let t=x.get(r.path);if(!t)return null;let s=Date.now()-t.timestamp>ve,i=re(n.settings),a=t.settingsHash!==i;return s||a?(x.delete(r.path),null):t.result}async function Te(r,n,t){let e=await Se(r,t.app),s=re(t.settings);x.set(r.path,{result:n,timestamp:Date.now(),fileHash:e,settingsHash:s})}function xe(){x.clear()}function Oe(){return{size:x.size}}function Fe(r){x.delete(r)}function Pe(){x.clear()}var x,ve,S=H(()=>{ie();x=new Map,ve=24*60*60*1e3});var Re={};V(Re,{default:()=>A});module.exports=fe(Re);var le=require("obsidian");var G={scanDirectories:"",keywordProperty:"",descriptionProperty:"",titleProperty:"",useFilenameAsTitle:!1,checkContentLength:!0,checkImageNaming:!0,checkDuplicateContent:!0,checkReadingLevel:!0,showNotices:!0,defaultSort:"warnings-desc",minContentLength:300,keywordDensityMin:1,keywordDensityMax:2,duplicateThreshold:80,cachedGlobalResults:[],lastScanTimestamp:0};var me=require("obsidian");function W(r){r.addCommand({id:"seo-open-current",name:"Open current note audit",callback:()=>{r.openCurrentPanel()}}),r.addCommand({id:"seo-open-global",name:"Open vault audit",callback:()=>{r.openGlobalPanel()}})}var k=require("obsidian"),P=class extends k.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Scope"}),new k.Setting(t).setName("Scan directories").setDesc("Comma-separated list of directory names to scan. Leave blank to scan all directories.").addText(e=>e.setPlaceholder("e.g., blog, posts, public").setValue(this.plugin.settings.scanDirectories).onChange(async s=>{this.plugin.settings.scanDirectories=s,await this.plugin.saveSettings()})),t.createEl("h2",{text:"Property Names"}),new k.Setting(t).setName("Keyword property").setDesc("Frontmatter property name for target keyword (e.g., targetKeyword, seo, keyword)").addText(e=>e.setPlaceholder("targetKeyword").setValue(this.plugin.settings.keywordProperty).onChange(async s=>{this.plugin.settings.keywordProperty=s,await this.plugin.saveSettings()})),new k.Setting(t).setName("Description property").setDesc("Frontmatter property name for meta description").addText(e=>e.setPlaceholder("description").setValue(this.plugin.settings.descriptionProperty).onChange(async s=>{this.plugin.settings.descriptionProperty=s,await this.plugin.saveSettings()})),new k.Setting(t).setName("Title property").setDesc("Frontmatter property name for title (leave blank to skip title checks)").addText(e=>e.setPlaceholder("title").setValue(this.plugin.settings.titleProperty).onChange(async s=>{this.plugin.settings.titleProperty=s,await this.plugin.saveSettings()})),new k.Setting(t).setName("Use filename as title fallback").setDesc("Use filename as title when title property is not set").addToggle(e=>e.setValue(this.plugin.settings.useFilenameAsTitle).onChange(async s=>{this.plugin.settings.useFilenameAsTitle=s,await this.plugin.saveSettings()})),t.createEl("h2",{text:"Check Options"}),new k.Setting(t).setName("Check content length").setDesc("Enable content length checking").addToggle(e=>e.setValue(this.plugin.settings.checkContentLength).onChange(async s=>{this.plugin.settings.checkContentLength=s,await this.plugin.saveSettings()})),new k.Setting(t).setName("Check image naming").setDesc("Enable image filename checking").addToggle(e=>e.setValue(this.plugin.settings.checkImageNaming).onChange(async s=>{this.plugin.settings.checkImageNaming=s,await this.plugin.saveSettings()})),new k.Setting(t).setName("Check duplicate content").setDesc("Enable duplicate content detection").addToggle(e=>e.setValue(this.plugin.settings.checkDuplicateContent).onChange(async s=>{this.plugin.settings.checkDuplicateContent=s,await this.plugin.saveSettings()})),new k.Setting(t).setName("Check reading level").setDesc("Enable reading level analysis").addToggle(e=>e.setValue(this.plugin.settings.checkReadingLevel).onChange(async s=>{this.plugin.settings.checkReadingLevel=s,await this.plugin.saveSettings()})),new k.Setting(t).setName("Show notices").setDesc("Show web compatibility notices (wikilinks, embedded images)").addToggle(e=>e.setValue(this.plugin.settings.showNotices).onChange(async s=>{this.plugin.settings.showNotices=s,await this.plugin.saveSettings()})),t.createEl("h2",{text:"Thresholds"}),new k.Setting(t).setName("Minimum content length").setDesc("Minimum word count for content length check").addText(e=>e.setPlaceholder("300").setValue(this.plugin.settings.minContentLength.toString()).onChange(async s=>{let i=parseInt(s);isNaN(i)||(this.plugin.settings.minContentLength=i,await this.plugin.saveSettings())})),new k.Setting(t).setName("Keyword density minimum").setDesc("Minimum keyword density percentage").addText(e=>e.setPlaceholder("1").setValue(this.plugin.settings.keywordDensityMin.toString()).onChange(async s=>{let i=parseFloat(s);isNaN(i)||(this.plugin.settings.keywordDensityMin=i,await this.plugin.saveSettings())})),new k.Setting(t).setName("Keyword density maximum").setDesc("Maximum keyword density percentage").addText(e=>e.setPlaceholder("2").setValue(this.plugin.settings.keywordDensityMax.toString()).onChange(async s=>{let i=parseFloat(s);isNaN(i)||(this.plugin.settings.keywordDensityMax=i,await this.plugin.saveSettings())})),new k.Setting(t).setName("Duplicate content threshold").setDesc("Similarity percentage threshold for duplicate content detection").addText(e=>e.setPlaceholder("80").setValue(this.plugin.settings.duplicateThreshold.toString()).onChange(async s=>{let i=parseInt(s);isNaN(i)||(this.plugin.settings.duplicateThreshold=i,await this.plugin.saveSettings())}))}};var ae=require("obsidian");var E="seo-current-panel",T="seo-global-panel";function B(r){let n=r.split("/");return n.length<=2?r:n.slice(-2).join("/")}function j(r){return!r||r.trim()===""?"Vault folders: all":`Vault folders: ${r.split(",").map(t=>t.trim()).filter(t=>t.length>0).join(", ")}`}var w=require("obsidian");var R=class{constructor(n,t,e){this.app=n;this.plugin=t;this.panelType=e}async runInitialScan(){try{let n=await this.plugin.getFilesToCheck();if(n.length===0)return[];let{runSEOCheck:t}=await Promise.resolve().then(()=>(S(),C)),e=await t(this.plugin,n);return this.plugin.settings.cachedGlobalResults=e,this.plugin.settings.lastScanTimestamp=Date.now(),await this.plugin.saveSettings(),new w.Notice(`SEO audit complete with ${e.length} files.`),e}catch(n){return console.error("Error running initial scan:",n),new w.Notice("Error analyzing files. Check console for details."),[]}}async checkCurrentNote(){let n=this.app.workspace.getActiveFile();if(!n||!n.path.endsWith(".md"))return new w.Notice("Please open a markdown file first."),null;try{let{clearCacheForFile:t}=await Promise.resolve().then(()=>(S(),C));t(n.path);let{runSEOCheck:e}=await Promise.resolve().then(()=>(S(),C)),s=await e(this.plugin,[n]);return s.length>0?(new w.Notice("SEO audit complete."),s[0]):null}catch(t){return console.error("Error checking current note:",t),new w.Notice("Error analyzing current note. Check console for details."),null}}async refreshGlobalResults(){try{let{clearAllCache:n}=await Promise.resolve().then(()=>(S(),C));n();let t=await this.plugin.getFilesToCheck();if(t.length===0)return new w.Notice("No markdown files found in configured directories."),[];let{runSEOCheck:e}=await Promise.resolve().then(()=>(S(),C)),s=await e(this.plugin,t);return this.plugin.settings.cachedGlobalResults=s,this.plugin.settings.lastScanTimestamp=Date.now(),await this.plugin.saveSettings(),new w.Notice(`SEO audit complete with ${s.length} files.`),s}catch(n){return console.error("Error checking all notes:",n),new w.Notice("Error analyzing files. Check console for details."),[]}}async openFile(n){if(this.app.vault.getAbstractFileByPath(n)){let e=this.app.workspace.getLeavesOfType("markdown").find(s=>s.view.getState().file===n);e?this.app.workspace.setActiveLeaf(e):(this.app.workspace.openLinkText(n,"",!0),setTimeout(()=>{let s=this.app.workspace.getLeavesOfType("markdown").find(i=>i.view.getState().file===n);s&&this.app.workspace.setActiveLeaf(s)},100))}}async openFileAndAudit(n){await this.openFile(n),this.plugin.openCurrentPanel(),setTimeout(()=>{let t=this.app.workspace.getLeavesOfType(E)[0];if(t){let e=t.view.containerEl.querySelector(".seo-top-btn");e&&e.click()}},200)}showSortMenu(n,t,e,s,i){let a=new w.Menu;a.addItem(l=>{l.setTitle("Warnings (high to low)").onClick(()=>{i("warnings-desc"),this.sortAndRenderFiles(t,e,(o,u)=>u.warningsCount-o.warningsCount)}),s==="warnings-desc"&&l.setIcon("check")}),a.addItem(l=>{l.setTitle("Warnings (low to high)").onClick(()=>{i("warnings-asc"),this.sortAndRenderFiles(t,e,(o,u)=>o.warningsCount-u.warningsCount)}),s==="warnings-asc"&&l.setIcon("check")}),a.addSeparator(),a.addItem(l=>{l.setTitle("Issues (high to low)").onClick(()=>{i("issues-desc"),this.sortAndRenderFiles(t,e,(o,u)=>u.issuesCount-o.issuesCount)}),s==="issues-desc"&&l.setIcon("check")}),a.addItem(l=>{l.setTitle("Issues (low to high)").onClick(()=>{i("issues-asc"),this.sortAndRenderFiles(t,e,(o,u)=>o.issuesCount-u.issuesCount)}),s==="issues-asc"&&l.setIcon("check")}),a.addSeparator(),a.addItem(l=>{l.setTitle("File name (A to Z)").onClick(()=>{i("filename-asc"),this.sortAndRenderFiles(t,e,(o,u)=>{let c=o.file.split("/").pop()||"",g=u.file.split("/").pop()||"",h=c.localeCompare(g);return h!==0?h:o.file.localeCompare(u.file)})}),s==="filename-asc"&&l.setIcon("check")}),a.addItem(l=>{l.setTitle("File name (Z to A)").onClick(()=>{i("filename-desc"),this.sortAndRenderFiles(t,e,(o,u)=>{let c=o.file.split("/").pop()||"",h=(u.file.split("/").pop()||"").localeCompare(c);return h!==0?h:u.file.localeCompare(o.file)})}),s==="filename-desc"&&l.setIcon("check")}),a.showAtPosition({x:n.clientX,y:n.clientY})}sortAndRenderFiles(n,t,e){let s=[...n].sort(e),i=t.querySelector(".seo-files-list-container");i&&(i.querySelectorAll(".seo-file-issue").forEach(a=>a.remove()),this.renderFilesList(s,i))}renderFilesList(n,t){n.forEach(e=>{let s=t.createEl("div",{cls:"seo-file-issue"});s.setAttribute("data-file-path",e.file),s.createEl("a",{text:this.getDisplayPath(e.file),cls:"seo-file-link",href:"#"}).addEventListener("click",o=>{o.preventDefault(),this.openFile(e.file)});let a=s.createEl("div",{cls:"seo-stats-container"});a.createEl("span",{text:`${e.issuesCount} issues, ${e.warningsCount} warnings`,cls:"seo-file-stats"});let l=a.createEl("button",{cls:"clickable-icon seo-audit-btn",attr:{"aria-label":"Audit this note"}});(0,w.setIcon)(l,"search-check"),l.addEventListener("click",async o=>{o.preventDefault(),o.stopPropagation(),await this.openFileAndAudit(e.file)})})}getDisplayPath(n){let t=n.split("/");return t.length<=2?n:t.slice(-2).join("/")}};var I=require("obsidian");var L=class{constructor(n,t,e){this.container=n;this.onFileClick=t;this.onFileAudit=e}renderResults(n){let t=this.container.createEl("div",{cls:"seo-score"}),e=t.createEl("span",{text:"Score: "}),s=t.createEl("span",{text:`${Math.round(n.overallScore)}%`});if(n.overallScore>=80?s.addClass("seo-score-excellent"):n.overallScore>=60?s.addClass("seo-score-good"):n.overallScore>=40?s.addClass("seo-score-fair"):s.addClass("seo-score-poor"),n.issuesCount>0||n.warningsCount>0){let a=t.createEl("span",{text:" ("}),l=a.createEl("span",{text:`${n.issuesCount} issues`,cls:"seo-issues-count-text"}),o=a.createEl("span",{text:", "}),u=a.createEl("span",{text:`${n.warningsCount} warnings`,cls:"seo-warnings-count-text"});a.createEl("span",{text:")"})}else t.createEl("span",{text:" (All checks passed!)",cls:"seo-success"});let i=this.container.createEl("div",{cls:"seo-checks"});Object.entries(n.checks).forEach(([a,l])=>{if(l.length===0)return;let o=l.some(y=>y.severity==="error"),u=l.some(y=>y.severity==="warning"),c=l.every(y=>y.severity==="info"),g="seo-passed";o?g="seo-error":u?g="seo-warning":c&&(g="seo-passed");let h=i.createEl("div",{cls:`seo-check ${g}`}),f=h.createEl("div",{cls:"seo-check-header seo-collapsible-header"}),v=a.replace(/([A-Z])/g," $1").trim().replace(/^./,y=>y.toUpperCase()),p=f.createEl("span",{cls:"seo-collapse-icon"});p.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6,9 12,15 18,9"/></svg>',f.createEl("span",{text:v});let d=f.createEl("span",{cls:"seo-status"}),m=l.some(y=>y.severity==="error"),ce=l.some(y=>y.severity==="warning");m?d.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>':ce?d.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>':d.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>';let D=h.createEl("ul",{cls:"seo-results"});l.forEach(y=>{let F=D.createEl("li",{cls:`seo-result seo-${y.severity}`,text:y.message});if(y.suggestion){let ue=F.createEl("div",{cls:"seo-suggestion"});ue.innerHTML=y.suggestion}}),f.addEventListener("click",()=>{let y=D.style.display==="none";D.style.display=y?"block":"none";let F=p.querySelector("svg");F&&(F.style.transform=y?"rotate(0deg)":"rotate(-90deg)")})})}renderGlobalResults(n){let t=this.container.createEl("div",{cls:"seo-vault-summary"}),e=n.length,s=n.reduce((d,m)=>d+m.issuesCount,0),i=n.reduce((d,m)=>d+m.warningsCount,0),a=Math.round(n.reduce((d,m)=>d+m.overallScore,0)/e),l=t.createEl("div",{cls:"seo-stats-grid"}),o=l.createEl("div",{cls:"seo-stat-item"});o.createEl("div",{cls:"seo-stat-number",text:e.toString()}),o.createEl("div",{cls:"seo-stat-label",text:"Files analyzed"});let u=l.createEl("div",{cls:"seo-stat-item"}),c=u.createEl("div",{cls:"seo-stat-number",text:`${a}%`}),g="Average score";a>=80?(c.addClass("seo-score-excellent"),g="Excellent"):a>=60?(c.addClass("seo-score-good"),g="Good"):a>=40?(c.addClass("seo-score-fair"),g="Fair"):(c.addClass("seo-score-poor"),g="Poor"),u.createEl("div",{cls:"seo-stat-label",text:g});let h=l.createEl("div",{cls:"seo-stat-item"}),f=h.createEl("div",{cls:"seo-stat-number",text:s.toString()});s>0&&f.addClass("seo-issues-count"),h.createEl("div",{cls:"seo-stat-label",text:"Issues"});let v=l.createEl("div",{cls:"seo-stat-item"}),p=v.createEl("div",{cls:"seo-stat-number",text:i.toString()});i>0&&p.addClass("seo-warnings-count"),v.createEl("div",{cls:"seo-stat-label",text:"Warnings"})}renderIssuesList(n,t,e,s){let i=n.filter(h=>h.issuesCount>0||h.warningsCount>0);if(i.length===0)return;let a=this.container.createEl("div",{cls:"seo-issues-list"}),l=a.createEl("div",{cls:"seo-issues-header-container seo-collapsible-header"}),o=l.createEl("span",{cls:"seo-collapse-icon"});o.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6,9 12,15 18,9"/></svg>',l.createEl("h4",{text:"Files with issues",cls:"seo-issues-header"});let u=l.createEl("button",{cls:"seo-sort-btn",attr:{"aria-label":"Sort files"}});(0,I.setIcon)(u,"arrow-up-narrow-wide"),u.addEventListener("click",s);let c=a.createEl("div",{cls:"seo-files-list-container"});this.sortFiles(i,t).forEach(h=>{let f=c.createEl("div",{cls:"seo-file-issue"});f.setAttribute("data-file-path",h.file),f.createEl("a",{text:B(h.file),cls:"seo-file-link",href:"#"}).addEventListener("click",async m=>{m.preventDefault(),await this.onFileClick(h.file)});let p=f.createEl("div",{cls:"seo-stats-container"});p.createEl("span",{text:`${h.issuesCount} issues, ${h.warningsCount} warnings`,cls:"seo-file-stats"});let d=p.createEl("button",{cls:"clickable-icon seo-audit-btn",attr:{"aria-label":"Audit this note"}});(0,I.setIcon)(d,"search-check"),d.addEventListener("click",async m=>{m.preventDefault(),m.stopPropagation(),await this.onFileAudit(h.file)})}),l.addEventListener("click",h=>{if(h.target.closest(".seo-sort-btn"))return;let f=c.style.display==="none";c.style.display=f?"block":"none";let v=o.querySelector("svg");v&&(v.style.transform=f?"rotate(0deg)":"rotate(-90deg)")})}sortFiles(n,t){let e=[...n];switch(t){case"warnings-desc":e.sort((s,i)=>i.warningsCount-s.warningsCount);break;case"warnings-asc":e.sort((s,i)=>s.warningsCount-i.warningsCount);break;case"issues-desc":e.sort((s,i)=>i.issuesCount-s.issuesCount);break;case"issues-asc":e.sort((s,i)=>s.issuesCount-i.issuesCount);break;case"filename-asc":e.sort((s,i)=>{let a=s.file.split("/").pop()||"",l=i.file.split("/").pop()||"",o=a.localeCompare(l);return o!==0?o:s.file.localeCompare(i.file)});break;case"filename-desc":e.sort((s,i)=>{let a=s.file.split("/").pop()||"",o=(i.file.split("/").pop()||"").localeCompare(a);return o!==0?o:i.file.localeCompare(s.file)});break}return e}};var b=class extends ae.ItemView{constructor(t,e="current",s){super(s||t.app.workspace.getLeaf());this.currentNoteResults=null;this.globalResults=[];this.panelType="current";this.hasRunInitialScan=!1;this.plugin=t,this.panelType=e,this.currentSort=t.settings.defaultSort,this.actions=new R(this.app,this.plugin,this.panelType),this.resultsDisplay=new L(this.containerEl,async i=>await this.actions.openFile(i),async i=>await this.actions.openFileAndAudit(i))}getViewType(){return this.panelType==="current"?E:T}getDisplayText(){return this.panelType==="current"?"SEO audit: current note":"SEO audit: vault"}getIcon(){return"search-check"}async onOpen(){try{this.panelType==="global"&&this.plugin.settings.cachedGlobalResults.length>0&&(this.globalResults=this.plugin.settings.cachedGlobalResults),this.forceIconRefresh(),this.render(),this.panelType==="global"&&!this.hasRunInitialScan&&this.globalResults.length===0&&(this.hasRunInitialScan=!0,await this.runInitialScan())}catch(t){console.error("Error opening SEO panel:",t)}}async onClose(){}cleanup(){}async runInitialScan(){let t=await this.actions.runInitialScan();t.length>0&&(this.globalResults=t,this.render())}forceIconRefresh(){this.leaf&&this.leaf.setViewState({type:this.getViewType(),state:this.leaf.view.getState()}),setTimeout(()=>{let t=this.containerEl.querySelector(".view-header-icon");t&&(t.innerHTML="",t.setAttribute("data-icon","search-check"),t.setAttribute("data-icon",""),t.offsetHeight,t.setAttribute("data-icon","search-check"));let e=this.containerEl.querySelector(".view-header");e&&(e.style.display="none",e.offsetHeight,e.style.display=""),this.app.workspace.trigger("layout-change")},50)}async updateCurrentNoteResults(t){if(!(!t||!t.path.endsWith(".md")))try{let e=await this.app.vault.read(t);this.render()}catch(e){console.error("Error updating current note results:",e)}}async updateResults(t){this.globalResults=t,this.render()}render(){try{let{containerEl:t}=this;t.empty(),t.addClass("seo-panel");let e=t.createEl("div",{cls:"seo-panel-header"});if(e.createEl("h2",{text:this.panelType==="current"?"SEO audit: current note":"SEO audit: vault"}),this.panelType==="current"){let s=this.app.workspace.getActiveFile();if(s&&s.path.endsWith(".md")){let i=e.createEl("div",{cls:"seo-filename"});i.textContent=`Target note: ${s.path}`}}else{let s=j(this.plugin.settings.scanDirectories),i=e.createEl("div",{cls:"seo-filename"});i.textContent=s}if(this.panelType==="current"){let s=t.createEl("button",{text:"Audit current note",cls:"mod-cta seo-btn seo-top-btn"});s.addEventListener("click",async()=>{s.textContent="Auditing...",s.disabled=!0;try{let i=await this.actions.checkCurrentNote();i&&(this.currentNoteResults=i,this.render())}finally{s.textContent="Audit current note",s.disabled=!1}})}this.panelType==="current"?this.currentNoteResults?this.resultsDisplay.renderResults(this.currentNoteResults):t.createEl("div",{cls:"seo-no-results"}).createEl("p",{text:'Open a markdown file and click "Audit current note" to audit it.'}):this.globalResults.length>0?this.renderGlobalResults(t):t.createEl("div",{cls:"seo-no-results"}).createEl("p",{text:'Click "Audit all notes" to audit your files in your configured directories.'})}catch(t){console.error("Error rendering SEO panel:",t),this.containerEl.createEl("div",{text:"Error loading SEO panel. Please try again."})}}renderGlobalResults(t){this.resultsDisplay.renderGlobalResults(this.globalResults);let e=t.createEl("button",{text:"Refresh",cls:"mod-cta seo-btn seo-refresh-btn"});e.addEventListener("click",async()=>{e.textContent="Refreshing...",e.disabled=!0;try{let s=await this.actions.refreshGlobalResults();s.length>0&&(this.globalResults=s,this.render())}finally{e.textContent="Refresh",e.disabled=!1}}),this.resultsDisplay.renderIssuesList(this.globalResults,this.currentSort,s=>{this.currentSort=s,this.plugin.settings.defaultSort=s,this.plugin.saveSettings()},s=>{let i=this.globalResults.filter(a=>a.issuesCount>0||a.warningsCount>0);this.actions.showSortMenu(s,i,t,this.currentSort,a=>{this.currentSort=a,this.plugin.settings.defaultSort=a,this.plugin.saveSettings()})})}};var oe=require("obsidian");var N=class{constructor(n,t){this.app=n;this.plugin=t}openCurrentPanel(){this.openPanel(E,"current")}openGlobalPanel(){this.openPanel(T,"global")}openPanel(n,t){let e=this.app.workspace.getLeavesOfType(n)[0];if(e)this.app.workspace.revealLeaf(e),this.app.workspace.setActiveLeaf(e),e.view instanceof b&&setTimeout(()=>e.view.forceIconRefresh(),100);else{let s=this.app.workspace.getRightLeaf(!1);if(s){let i=new b(this.plugin,t,s);i.forceIconRefresh(),s.open(i),this.app.workspace.setActiveLeaf(s)}}}async getFilesToCheck(){let{vault:n}=this.app,{scanDirectories:t}=this.plugin.settings;if(!t.trim())return n.getMarkdownFiles();let e=t.split(",").map(i=>i.trim()),s=[];for(let i of e){let a=n.getAbstractFileByPath(i);a&&a instanceof oe.TFolder&&s.push(...n.getMarkdownFiles().filter(l=>l.path.startsWith(i+"/")||l.path===i))}return s}};var $=class{constructor(n,t){this.app=n;this.plugin=t;this.timeoutId=null}registerRealTimeChecking(){this.plugin.registerEvent(this.app.workspace.on("editor-change",()=>{this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.checkCurrentNote()},2e3)}))}async checkCurrentNote(){let n=this.app.workspace.getActiveFile();if(!(!n||!n.path.endsWith(".md")))try{let{runSEOCheck:t}=await Promise.resolve().then(()=>(S(),C)),e=await t(this.plugin,[n])}catch(t){console.error("Error checking current note:",t)}}async runBulkCheck(){let{runSEOCheck:n}=await Promise.resolve().then(()=>(S(),C)),t=await this.plugin.getFilesToCheck();if(t.length!==0)try{let e=await n(this.plugin,t)}catch(e){console.error("Error running bulk check:",e)}}};var A=class extends le.Plugin{async onload(){await this.loadSettings(),this.panelManager=new N(this.app,this),this.realTimeChecker=new $(this.app,this),this.forceIconRefresh(),this.registerView(E,t=>new b(this,"current",t)),this.registerView(T,t=>new b(this,"global",t)),W(this),this.addSettingTab(new P(this.app,this)),this.realTimeChecker.registerRealTimeChecking(),this.addRibbonIcon("search-check","Open SEO audit panel",()=>{this.openGlobalPanel()})}onunload(){}async loadSettings(){this.settings=Object.assign({},G,await this.loadData())}async saveSettings(){await this.saveData(this.settings);let{clearAllCache:t}=await Promise.resolve().then(()=>(S(),C));t()}addStatusBar(){}removeStatusBar(){}openCurrentPanel(){this.panelManager.openCurrentPanel()}openGlobalPanel(){this.panelManager.openGlobalPanel()}async runBulkCheck(){await this.realTimeChecker.runBulkCheck()}async getFilesToCheck(){return this.panelManager.getFilesToCheck()}forceIconRefresh(){this.app.workspace.onLayoutReady(()=>{let t=this.app.workspace.getLeavesOfType(E),e=this.app.workspace.getLeavesOfType(T);[...t,...e].forEach(s=>{s.view instanceof b&&s.view.render()})})}};
